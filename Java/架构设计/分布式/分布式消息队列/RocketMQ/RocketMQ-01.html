<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>RocketMQ-学习笔记01 | 谢稳的个人博客</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/logo2.png">
    <script type="text/javascript" src="http://libs.baidu.com/jquery/2.1.4/jquery.min.js"></script>
    <script type="text/javascript" src="/js/visitor.js"></script>
    <link rel="stylesheet" href="/iconfont/font_20csbaofexh/iconfont.css">
    <link rel="stylesheet" href="/iconfont/font_cs5v8kb16mu/iconfont.css">
    <link rel="stylesheet" href="/iconfont/font_rb2ra212g7/iconfont.css">
    <link rel="stylesheet" href="/iconfont/font_tufiudzw9qd/iconfont.css">
    <link rel="stylesheet" href="/iconfont/font_a7q92la1f6s/iconfont.css">
    <link rel="stylesheet" href="/iconfont/font_zre4efrva2s/iconfont.css">
    <link rel="stylesheet" href="/iconfont/font_qw4wryn6ml/iconfont.css">
    <link rel="stylesheet" href="/iconfont/font_871awunxhy/iconfont.css">
    <link rel="stylesheet" href="/iconfont/font_y9b41xpetef/iconfont.css">
    <link rel="stylesheet" href="/iconfont/font_mo5yyv3yprm/iconfont.css">
    <link rel="stylesheet" href="/iconfont/font_zmhzcngpk2/iconfont.css">
    <link rel="stylesheet" href="/iconfont/font_j67xetcspme/iconfont.css">
    <link rel="stylesheet" href="/iconfont/font_2tttlrelpoh/iconfont.css">
    <link rel="stylesheet" href="/iconfont/font_c103gbzvyng/iconfont.css">
    <link rel="stylesheet" href="/iconfont/font_iju5isejpxc/iconfont.css">
    <link rel="stylesheet" href="/iconfont/font_3nnhx9n8ea/iconfont.css">
    <link rel="stylesheet" href="/iconfont/font_6oyf4j0cvmu/iconfont.css">
    <link rel="stylesheet" href="/iconfont/font_tmecser0ml/iconfont.css">
    <link rel="stylesheet" href="/iconfont/font_o3x7o929hi/iconfont.css">
    <meta name="description" content="描述">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    
    <link rel="preload" href="/assets/css/0.styles.350c6f84.css" as="style"><link rel="preload" href="/assets/js/app.66712d02.js" as="script"><link rel="preload" href="/assets/js/11.42113752.js" as="script"><link rel="preload" href="/assets/js/1.dd01b019.js" as="script"><link rel="preload" href="/assets/js/20.074ba45e.js" as="script"><link rel="preload" href="/assets/js/49.36f82c23.js" as="script"><link rel="prefetch" href="/assets/js/10.b4c877fc.js"><link rel="prefetch" href="/assets/js/100.f54625a3.js"><link rel="prefetch" href="/assets/js/101.d9380148.js"><link rel="prefetch" href="/assets/js/102.968961de.js"><link rel="prefetch" href="/assets/js/103.88dd396f.js"><link rel="prefetch" href="/assets/js/104.64860067.js"><link rel="prefetch" href="/assets/js/105.617b71ee.js"><link rel="prefetch" href="/assets/js/106.fd078911.js"><link rel="prefetch" href="/assets/js/107.880e80ef.js"><link rel="prefetch" href="/assets/js/108.f340515d.js"><link rel="prefetch" href="/assets/js/109.15f4d5e8.js"><link rel="prefetch" href="/assets/js/110.84d47373.js"><link rel="prefetch" href="/assets/js/111.7d04f087.js"><link rel="prefetch" href="/assets/js/112.95952375.js"><link rel="prefetch" href="/assets/js/113.97e50938.js"><link rel="prefetch" href="/assets/js/114.84185c2f.js"><link rel="prefetch" href="/assets/js/115.19bbf0d5.js"><link rel="prefetch" href="/assets/js/116.4c229dff.js"><link rel="prefetch" href="/assets/js/117.c50c4f7f.js"><link rel="prefetch" href="/assets/js/118.ce66f0c4.js"><link rel="prefetch" href="/assets/js/119.fcacce08.js"><link rel="prefetch" href="/assets/js/12.b9bcfa42.js"><link rel="prefetch" href="/assets/js/120.ef883575.js"><link rel="prefetch" href="/assets/js/121.d53777f4.js"><link rel="prefetch" href="/assets/js/122.3390b5f4.js"><link rel="prefetch" href="/assets/js/123.3e7ab0a3.js"><link rel="prefetch" href="/assets/js/124.db3eca6a.js"><link rel="prefetch" href="/assets/js/125.12565777.js"><link rel="prefetch" href="/assets/js/126.9f2e5bca.js"><link rel="prefetch" href="/assets/js/127.c09d96f2.js"><link rel="prefetch" href="/assets/js/128.ccd81962.js"><link rel="prefetch" href="/assets/js/129.d79dfe2f.js"><link rel="prefetch" href="/assets/js/13.d1b0070c.js"><link rel="prefetch" href="/assets/js/130.02cd264e.js"><link rel="prefetch" href="/assets/js/131.2baf58a9.js"><link rel="prefetch" href="/assets/js/132.84d3b67d.js"><link rel="prefetch" href="/assets/js/133.ee09fef1.js"><link rel="prefetch" href="/assets/js/134.c7978654.js"><link rel="prefetch" href="/assets/js/135.5cfc0097.js"><link rel="prefetch" href="/assets/js/136.a7530282.js"><link rel="prefetch" href="/assets/js/137.22042d1e.js"><link rel="prefetch" href="/assets/js/138.8bfe7e0f.js"><link rel="prefetch" href="/assets/js/139.0dedb9a8.js"><link rel="prefetch" href="/assets/js/14.8600fc68.js"><link rel="prefetch" href="/assets/js/140.ffd60cf4.js"><link rel="prefetch" href="/assets/js/141.be5ecf0c.js"><link rel="prefetch" href="/assets/js/142.81fcc4e7.js"><link rel="prefetch" href="/assets/js/143.b8e18676.js"><link rel="prefetch" href="/assets/js/144.7db33328.js"><link rel="prefetch" href="/assets/js/145.52165f2b.js"><link rel="prefetch" href="/assets/js/146.51bee06c.js"><link rel="prefetch" href="/assets/js/147.ea98eb05.js"><link rel="prefetch" href="/assets/js/148.125b1418.js"><link rel="prefetch" href="/assets/js/149.60999209.js"><link rel="prefetch" href="/assets/js/15.e7f36ac9.js"><link rel="prefetch" href="/assets/js/150.5f4687e0.js"><link rel="prefetch" href="/assets/js/151.4fb57e58.js"><link rel="prefetch" href="/assets/js/152.0b3f8d6e.js"><link rel="prefetch" href="/assets/js/153.590f7f66.js"><link rel="prefetch" href="/assets/js/154.7c50827e.js"><link rel="prefetch" href="/assets/js/155.f16146cd.js"><link rel="prefetch" href="/assets/js/156.e4eb9f2b.js"><link rel="prefetch" href="/assets/js/157.71be4e5a.js"><link rel="prefetch" href="/assets/js/158.f8226894.js"><link rel="prefetch" href="/assets/js/159.23e0f7d3.js"><link rel="prefetch" href="/assets/js/16.9088887c.js"><link rel="prefetch" href="/assets/js/160.adadc3c2.js"><link rel="prefetch" href="/assets/js/161.4b7917ea.js"><link rel="prefetch" href="/assets/js/162.217ce512.js"><link rel="prefetch" href="/assets/js/163.10cee4f1.js"><link rel="prefetch" href="/assets/js/164.4ad5170f.js"><link rel="prefetch" href="/assets/js/165.d9c4eb2f.js"><link rel="prefetch" href="/assets/js/166.5abfdb3c.js"><link rel="prefetch" href="/assets/js/167.d8036606.js"><link rel="prefetch" href="/assets/js/168.39d0f7a2.js"><link rel="prefetch" href="/assets/js/169.28dcef97.js"><link rel="prefetch" href="/assets/js/17.55d1a373.js"><link rel="prefetch" href="/assets/js/170.1904cc3c.js"><link rel="prefetch" href="/assets/js/171.25c0c843.js"><link rel="prefetch" href="/assets/js/172.bc0ff95a.js"><link rel="prefetch" href="/assets/js/173.1fd038a7.js"><link rel="prefetch" href="/assets/js/174.ff8cd66a.js"><link rel="prefetch" href="/assets/js/175.819ad242.js"><link rel="prefetch" href="/assets/js/18.ce5c67f1.js"><link rel="prefetch" href="/assets/js/19.4ded1f11.js"><link rel="prefetch" href="/assets/js/21.f0afcbf5.js"><link rel="prefetch" href="/assets/js/22.24526a64.js"><link rel="prefetch" href="/assets/js/23.5767a1dc.js"><link rel="prefetch" href="/assets/js/24.ed944a1b.js"><link rel="prefetch" href="/assets/js/25.c9237e9f.js"><link rel="prefetch" href="/assets/js/26.24c8333e.js"><link rel="prefetch" href="/assets/js/27.fcf23e69.js"><link rel="prefetch" href="/assets/js/28.13fea098.js"><link rel="prefetch" href="/assets/js/29.8fe770f1.js"><link rel="prefetch" href="/assets/js/3.5545542d.js"><link rel="prefetch" href="/assets/js/30.5b039abb.js"><link rel="prefetch" href="/assets/js/31.e1fe50c8.js"><link rel="prefetch" href="/assets/js/32.235a1916.js"><link rel="prefetch" href="/assets/js/33.9f922802.js"><link rel="prefetch" href="/assets/js/34.c1827c5d.js"><link rel="prefetch" href="/assets/js/35.f7642664.js"><link rel="prefetch" href="/assets/js/36.34ff0660.js"><link rel="prefetch" href="/assets/js/37.eeac5e1e.js"><link rel="prefetch" href="/assets/js/38.d1e718a5.js"><link rel="prefetch" href="/assets/js/39.b35a797e.js"><link rel="prefetch" href="/assets/js/4.7af7de0a.js"><link rel="prefetch" href="/assets/js/40.fd584b6b.js"><link rel="prefetch" href="/assets/js/41.5225513f.js"><link rel="prefetch" href="/assets/js/42.6cfd6220.js"><link rel="prefetch" href="/assets/js/43.25342211.js"><link rel="prefetch" href="/assets/js/44.ef0a25bd.js"><link rel="prefetch" href="/assets/js/45.68c53edb.js"><link rel="prefetch" href="/assets/js/46.8f31cde6.js"><link rel="prefetch" href="/assets/js/47.caedb210.js"><link rel="prefetch" href="/assets/js/48.e0ac851e.js"><link rel="prefetch" href="/assets/js/5.d553fe1c.js"><link rel="prefetch" href="/assets/js/50.611e5a4b.js"><link rel="prefetch" href="/assets/js/51.4f9f3f6d.js"><link rel="prefetch" href="/assets/js/52.c39f14d5.js"><link rel="prefetch" href="/assets/js/53.6100105a.js"><link rel="prefetch" href="/assets/js/54.e0a02f1a.js"><link rel="prefetch" href="/assets/js/55.9722b08b.js"><link rel="prefetch" href="/assets/js/56.334a361d.js"><link rel="prefetch" href="/assets/js/57.c4782794.js"><link rel="prefetch" href="/assets/js/58.5df1eae4.js"><link rel="prefetch" href="/assets/js/59.bd3f5fd2.js"><link rel="prefetch" href="/assets/js/6.3ebd012a.js"><link rel="prefetch" href="/assets/js/60.f8194307.js"><link rel="prefetch" href="/assets/js/61.9375aaad.js"><link rel="prefetch" href="/assets/js/62.c34e3455.js"><link rel="prefetch" href="/assets/js/63.14829835.js"><link rel="prefetch" href="/assets/js/64.48f8650b.js"><link rel="prefetch" href="/assets/js/65.e812686e.js"><link rel="prefetch" href="/assets/js/66.0c93b50a.js"><link rel="prefetch" href="/assets/js/67.a9675320.js"><link rel="prefetch" href="/assets/js/68.6bf78f24.js"><link rel="prefetch" href="/assets/js/69.7ef082ff.js"><link rel="prefetch" href="/assets/js/7.639ea18e.js"><link rel="prefetch" href="/assets/js/70.4e03679a.js"><link rel="prefetch" href="/assets/js/71.4f17504f.js"><link rel="prefetch" href="/assets/js/72.74c28698.js"><link rel="prefetch" href="/assets/js/73.14894cf8.js"><link rel="prefetch" href="/assets/js/74.9654a45c.js"><link rel="prefetch" href="/assets/js/75.f2e4f3bd.js"><link rel="prefetch" href="/assets/js/76.0337b039.js"><link rel="prefetch" href="/assets/js/77.12e176b5.js"><link rel="prefetch" href="/assets/js/78.0b1a720d.js"><link rel="prefetch" href="/assets/js/79.99b02597.js"><link rel="prefetch" href="/assets/js/8.decb7721.js"><link rel="prefetch" href="/assets/js/80.efeb98f6.js"><link rel="prefetch" href="/assets/js/81.9f377f24.js"><link rel="prefetch" href="/assets/js/82.5537e285.js"><link rel="prefetch" href="/assets/js/83.282c845e.js"><link rel="prefetch" href="/assets/js/84.94111c71.js"><link rel="prefetch" href="/assets/js/85.9243f917.js"><link rel="prefetch" href="/assets/js/86.4d8485e2.js"><link rel="prefetch" href="/assets/js/87.2a6643f4.js"><link rel="prefetch" href="/assets/js/88.33508e76.js"><link rel="prefetch" href="/assets/js/89.02ef538c.js"><link rel="prefetch" href="/assets/js/9.c45915be.js"><link rel="prefetch" href="/assets/js/90.75b8945f.js"><link rel="prefetch" href="/assets/js/91.8d60519a.js"><link rel="prefetch" href="/assets/js/92.9251c3cd.js"><link rel="prefetch" href="/assets/js/93.0040bcf0.js"><link rel="prefetch" href="/assets/js/94.4638f28f.js"><link rel="prefetch" href="/assets/js/95.2107de61.js"><link rel="prefetch" href="/assets/js/96.85c2dcbf.js"><link rel="prefetch" href="/assets/js/97.663fb4f9.js"><link rel="prefetch" href="/assets/js/98.32cd8ee5.js"><link rel="prefetch" href="/assets/js/99.4083605b.js">
    <link rel="stylesheet" href="/assets/css/0.styles.350c6f84.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-7dd95ae2><div data-v-7dd95ae2><div class="password-shadow password-wrapper-out" style="display:none;" data-v-59e6cb88 data-v-7dd95ae2 data-v-7dd95ae2><h3 class="title" data-v-59e6cb88>谢稳的个人博客</h3> <p class="description" data-v-59e6cb88>描述</p> <label id="box" class="inputBox" data-v-59e6cb88><input type="password" value="" data-v-59e6cb88> <span data-v-59e6cb88>Konck! Knock!</span> <button data-v-59e6cb88>OK</button></label> <div class="footer" data-v-59e6cb88><span data-v-59e6cb88><i class="iconfont reco-theme" data-v-59e6cb88></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-59e6cb88>vuePress-theme-reco</a></span> <span data-v-59e6cb88><i class="iconfont reco-copyright" data-v-59e6cb88></i> <a data-v-59e6cb88><span data-v-59e6cb88>xiewen</span>
          
        <span data-v-59e6cb88>2017 - </span>
        2024
      </a></span></div></div> <div class="hide" data-v-7dd95ae2><header class="navbar" data-v-7dd95ae2><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo2.png" alt="谢稳的个人博客" class="logo"> <span class="site-name">谢稳的个人博客</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont icon-cafei"></i>
      Java
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Java/java开发技巧/其他/语法糖.html" class="nav-link"><i class="iconfont icon-LBhouduanfuwuzu"></i>
  java开发技巧
</a></li><li class="dropdown-item"><!----> <a href="/Java/JVM性能调优/JVM概念/0_JVM体系结构.html" class="nav-link"><i class="iconfont icon-duozhongzhifu"></i>
  JVM性能调优
</a></li><li class="dropdown-item"><!----> <a href="/Java/并发编程/JUC.html" class="nav-link"><i class="iconfont icon-bingfashuliang"></i>
  并发编程
</a></li><li class="dropdown-item"><!----> <a href="/Java/容器/Docker/0_Docker介绍及使用.html" class="nav-link"><i class="iconfont icon-rongqi"></i>
  容器相关
</a></li><li class="dropdown-item"><!----> <a href="/Java/设计模式/1基本概念/设计模式.html" class="nav-link"><i class="iconfont icon-iconfontmoshi"></i>
  设计模式
</a></li><li class="dropdown-item"><!----> <a href="/Java/微服务专栏/流控组件Sentinel/微服务保护.html" class="nav-link"><i class="iconfont icon-mseweifuwuyinqing"></i>
  微服务专栏
</a></li><li class="dropdown-item"><!----> <a href="/Java/架构设计/分布式/分布式事务/分布式事务Seata.html" class="nav-link"><i class="iconfont icon-jiagou"></i>
  架构设计
</a></li><li class="dropdown-item"><!----> <a href="/Java/数据结构/排序算法.html" class="nav-link"><i class="iconfont icon-shujujiegou"></i>
  数据结构
</a></li></ul></div></div><div class="nav-item"><a href="/数据库/MongoDB/0_MongoDB简介.html" class="nav-link"><i class="iconfont icon-shujuku"></i>
  数据库
</a></div><div class="nav-item"><a href="/Redis/Redis解决限流问题.html" class="nav-link"><i class="iconfont icon-redis"></i>
  Redis专栏
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont icon-zuzhijiagou"></i>
      常用框架
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/常用框架/Spring/Spring容器初始化源码解析.html" class="nav-link"><i class="iconfont icon-iconfontmoshi"></i>
  Spring
</a></li><li class="dropdown-item"><!----> <a href="/常用框架/Mybatis/Mybatis-Plus-Join连表查询.html" class="nav-link"><i class="iconfont icon-iconfontmoshi"></i>
  MybatisPlus
</a></li><li class="dropdown-item"><!----> <a href="/Java/架构设计/分布式/分布式搜索/分布式搜索引擎Elasticsearch01.html" class="nav-link"><i class="iconfont icon-iconfontmoshi"></i>
  搜索引擎ElasticSearch
</a></li><li class="dropdown-item"><!----> <a href="/常用框架/Activiti7/Activiti整合Spring.html" class="nav-link"><i class="iconfont icon-iconfontmoshi"></i>
  工作流引擎Activiti7
</a></li><li class="dropdown-item"><!----> <a href="/Java/架构设计/分布式/分布式监控/SpringBootAdmin.html" class="nav-link"><i class="iconfont icon-iconfontmoshi"></i>
  SpringBootAdmin
</a></li></ul></div></div><div class="nav-item"><a href="/Linux/0_Linux常用命令.html" class="nav-link"><i class="iconfont icon-centos"></i>
  Linux
</a></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-7dd95ae2></div> <aside class="sidebar" data-v-7dd95ae2><div class="personal-info-wrapper" data-v-1fad0c41 data-v-7dd95ae2><img src="/logo2.png" alt="author-avatar" class="personal-img" data-v-1fad0c41> <h3 class="name" data-v-1fad0c41>
    xiewen
  </h3> <div class="num" data-v-1fad0c41><div data-v-1fad0c41><h3 data-v-1fad0c41>132</h3> <h6 data-v-1fad0c41>文章</h6></div> <div data-v-1fad0c41><h3 data-v-1fad0c41>57</h3> <h6 data-v-1fad0c41>标签</h6></div></div> <ul class="social-links" data-v-1fad0c41></ul> <hr data-v-1fad0c41></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont icon-cafei"></i>
      Java
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Java/java开发技巧/其他/语法糖.html" class="nav-link"><i class="iconfont icon-LBhouduanfuwuzu"></i>
  java开发技巧
</a></li><li class="dropdown-item"><!----> <a href="/Java/JVM性能调优/JVM概念/0_JVM体系结构.html" class="nav-link"><i class="iconfont icon-duozhongzhifu"></i>
  JVM性能调优
</a></li><li class="dropdown-item"><!----> <a href="/Java/并发编程/JUC.html" class="nav-link"><i class="iconfont icon-bingfashuliang"></i>
  并发编程
</a></li><li class="dropdown-item"><!----> <a href="/Java/容器/Docker/0_Docker介绍及使用.html" class="nav-link"><i class="iconfont icon-rongqi"></i>
  容器相关
</a></li><li class="dropdown-item"><!----> <a href="/Java/设计模式/1基本概念/设计模式.html" class="nav-link"><i class="iconfont icon-iconfontmoshi"></i>
  设计模式
</a></li><li class="dropdown-item"><!----> <a href="/Java/微服务专栏/流控组件Sentinel/微服务保护.html" class="nav-link"><i class="iconfont icon-mseweifuwuyinqing"></i>
  微服务专栏
</a></li><li class="dropdown-item"><!----> <a href="/Java/架构设计/分布式/分布式事务/分布式事务Seata.html" class="nav-link"><i class="iconfont icon-jiagou"></i>
  架构设计
</a></li><li class="dropdown-item"><!----> <a href="/Java/数据结构/排序算法.html" class="nav-link"><i class="iconfont icon-shujujiegou"></i>
  数据结构
</a></li></ul></div></div><div class="nav-item"><a href="/数据库/MongoDB/0_MongoDB简介.html" class="nav-link"><i class="iconfont icon-shujuku"></i>
  数据库
</a></div><div class="nav-item"><a href="/Redis/Redis解决限流问题.html" class="nav-link"><i class="iconfont icon-redis"></i>
  Redis专栏
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont icon-zuzhijiagou"></i>
      常用框架
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/常用框架/Spring/Spring容器初始化源码解析.html" class="nav-link"><i class="iconfont icon-iconfontmoshi"></i>
  Spring
</a></li><li class="dropdown-item"><!----> <a href="/常用框架/Mybatis/Mybatis-Plus-Join连表查询.html" class="nav-link"><i class="iconfont icon-iconfontmoshi"></i>
  MybatisPlus
</a></li><li class="dropdown-item"><!----> <a href="/Java/架构设计/分布式/分布式搜索/分布式搜索引擎Elasticsearch01.html" class="nav-link"><i class="iconfont icon-iconfontmoshi"></i>
  搜索引擎ElasticSearch
</a></li><li class="dropdown-item"><!----> <a href="/常用框架/Activiti7/Activiti整合Spring.html" class="nav-link"><i class="iconfont icon-iconfontmoshi"></i>
  工作流引擎Activiti7
</a></li><li class="dropdown-item"><!----> <a href="/Java/架构设计/分布式/分布式监控/SpringBootAdmin.html" class="nav-link"><i class="iconfont icon-iconfontmoshi"></i>
  SpringBootAdmin
</a></li></ul></div></div><div class="nav-item"><a href="/Linux/0_Linux常用命令.html" class="nav-link"><i class="iconfont icon-centos"></i>
  Linux
</a></div> <!----></nav> <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>分布式</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>分布式事务</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Java/架构设计/分布式/分布式事务/分布式事务Seata.html" class="sidebar-link">分布式事务Seata</a></li><li><a href="/Java/架构设计/分布式/分布式事务/分布式事务框架TX-LCN.html" class="sidebar-link">分布式事务框架TX-LCN</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>分布式日志收集</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Java/架构设计/分布式/分布式日志收集/0_ElasticStack概述.html" class="sidebar-link">ElasticStack概述</a></li><li><a href="/Java/架构设计/分布式/分布式日志收集/1_Elasticsearch安装.html" class="sidebar-link">ELK篇之安装ElasticSearch和Kibana</a></li><li><a href="/Java/架构设计/分布式/分布式日志收集/2_Logstash使用.html" class="sidebar-link">ELK篇之Logstash使用</a></li><li><a href="/Java/架构设计/分布式/分布式日志收集/3_SpringBoot集成ELK.html" class="sidebar-link">ELK篇之SpringBoot集成ELK</a></li><li><a href="/Java/架构设计/分布式/分布式日志收集/4_EFK篇之Filebeat使用.html" class="sidebar-link">EFK篇之Filebeat使用</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>分布式搜索</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Java/架构设计/分布式/分布式搜索/ElasticSearch进阶功能.html" class="sidebar-link">Elasticsearch进阶功能</a></li><li><a href="/Java/架构设计/分布式/分布式搜索/分布式搜索引擎Elasticsearch01.html" class="sidebar-link">Elasticsearch-学习笔记01</a></li><li><a href="/Java/架构设计/分布式/分布式搜索/分布式搜索引擎Elasticsearch02.html" class="sidebar-link">Elasticsearch-学习笔记02</a></li><li><a href="/Java/架构设计/分布式/分布式搜索/分布式搜索引擎Elasticsearch03.html" class="sidebar-link">Elasticsearch-学习笔记03</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading open"><span>分布式消息队列</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Java/架构设计/分布式/分布式消息队列/1概念/消息队列.html" class="sidebar-link">消息队列介绍</a></li><li><a href="/Java/架构设计/分布式/分布式消息队列/RabbitMQ/RabbitMQ.html" class="sidebar-link">RabbitMQ消息队列</a></li><li><a href="/Java/架构设计/分布式/分布式消息队列/RabbitMQ/RabbitMQ安装.html" class="sidebar-link">RabbitMQ安装</a></li><li><a href="/Java/架构设计/分布式/分布式消息队列/RocketMQ/RocketMQ-01.html" class="active sidebar-link">RocketMQ-学习笔记01</a></li><li><a href="/Java/架构设计/分布式/分布式消息队列/RocketMQ/RocketMQ-02.html" class="sidebar-link">RocketMQ-学习笔记02</a></li><li><a href="/Java/架构设计/分布式/分布式消息队列/RocketMQ/RocketMQ-03.html" class="sidebar-link">RocketMQ-学习笔记03</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>分布式监控</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Java/架构设计/分布式/分布式监控/0_监控.html" class="sidebar-link">监控</a></li><li><a href="/Java/架构设计/分布式/分布式监控/Pinpoint.html" class="sidebar-link">Pinpoint性能监控</a></li><li><a href="/Java/架构设计/分布式/分布式监控/Prometheus.html" class="sidebar-link">Prometheus监控</a></li><li><a href="/Java/架构设计/分布式/分布式监控/SkyWalking.html" class="sidebar-link">skywalking链路追踪</a></li><li><a href="/Java/架构设计/分布式/分布式监控/SpringBootAdmin.html" class="sidebar-link">SpringBootAdmin系统监控</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>分布式缓存</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Java/架构设计/分布式/分布式缓存/1概念/缓存.html" class="sidebar-link">缓存概述</a></li><li><a href="/Java/架构设计/分布式/分布式缓存/cache/0_redis.html" class="sidebar-link">Redis概述及使用</a></li><li><a href="/Java/架构设计/分布式/分布式缓存/cache/1_RedisStack介绍.html" class="sidebar-link">Redis Stack介绍</a></li><li><a href="/Java/架构设计/分布式/分布式缓存/cache/2_RedisInsight部署使用.html" class="sidebar-link">/Java/架构设计/分布式/分布式缓存/cache/2_RedisInsight部署使用.html</a></li><li><a href="/Java/架构设计/分布式/分布式缓存/cache/3_布隆过滤器.html" class="sidebar-link">布隆过滤器</a></li></ul></section></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>高可用</span> <!----></p> <!----></section></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-59e6cb88 data-v-7dd95ae2><h3 class="title" data-v-59e6cb88>RocketMQ-学习笔记01</h3> <!----> <label id="box" class="inputBox" data-v-59e6cb88><input type="password" value="" data-v-59e6cb88> <span data-v-59e6cb88>Konck! Knock!</span> <button data-v-59e6cb88>OK</button></label> <div class="footer" data-v-59e6cb88><span data-v-59e6cb88><i class="iconfont reco-theme" data-v-59e6cb88></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-59e6cb88>vuePress-theme-reco</a></span> <span data-v-59e6cb88><i class="iconfont reco-copyright" data-v-59e6cb88></i> <a data-v-59e6cb88><span data-v-59e6cb88>xiewen</span>
          
        <span data-v-59e6cb88>2017 - </span>
        2024
      </a></span></div></div> <div data-v-7dd95ae2><div data-v-7dd95ae2><main class="page"><section style="display:;"><div class="page-title"><h1 class="title">RocketMQ-学习笔记01</h1> <div data-v-8a445198><i class="iconfont reco-account" data-v-8a445198><span data-v-8a445198>xiewen</span></i> <!----> <i class="iconfont reco-eye" data-v-8a445198><span id="/Java/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/%E5%88%86%E5%B8%83%E5%BC%8F/%E5%88%86%E5%B8%83%E5%BC%8F%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/RocketMQ/RocketMQ-01.html" data-flag-title="Your Article Title" class="leancloud-visitors" data-v-8a445198><a class="leancloud-visitors-count" style="font-size:.9rem;font-weight:normal;color:#999;"></a></span></i> <i class="tags iconfont reco-tag" data-v-8a445198><span class="tag-item" data-v-8a445198>消息队列</span><span class="tag-item" data-v-8a445198>RocketMQ</span></i></div></div> <div class="theme-reco-content content__default"><h1 id="_1-mq介绍"><a href="#_1-mq介绍" class="header-anchor">#</a> 1. MQ介绍</h1> <p>##1.1 为什么要用MQ</p> <p>消息队列是一种“先进先出”的数据结构</p> <p><img src="/assets/img/queue1.d24b6ee6.png" alt=""></p> <p>其应用场景主要包含以下3个方面</p> <ul><li>应用解耦</li></ul> <p>系统的耦合性越高，容错性就越低。以电商应用为例，用户创建订单后，如果耦合调用库存系统、物流系统、支付系统，任何一个子系统出了故障或者因为升级等原因暂时不可用，都会造成下单操作异常，影响用户使用体验。</p> <p><img src="/assets/img/解耦1.7dac27ac.png" alt=""></p> <p>使用消息队列解耦合，系统的耦合性就会提高了。比如物流系统发生故障，需要几分钟才能来修复，在这段时间内，物流系统要处理的数据被缓存到消息队列中，用户的下单操作正常完成。当物流系统回复后，补充处理存在消息队列中的订单消息即可，终端系统感知不到物流系统发生过几分钟故障。</p> <p><img src="/assets/img/解耦2.61bd6fea.png" alt=""></p> <ul><li>流量削峰</li></ul> <p><img src="data:image/png;base64,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wCXR6wGAaBYOh1VaWqqSkhKVlJSouLhY+/fv1znnnKN+/fpVr/ePf/xDo0aNUtOmTauXffDBB/r666912223eTE6cEaIA+LOp59+qjvvvFN33323rrnmmurlBw4c0NSpU1VWVqaysjIdPnxY5eXlSktLU9OmTdW4cWM1adJEzZo1U69evaq/b8eOHXr99df1s5/9rMbtnHfeefrTn/6kvn37yu/3R2z/gNpAHBB3srOz1bZtW2VnZ9eIQ5MmTTRjxgylpKSoUaNGWrRokV599VXdd9996tOnjyTpm2++UTAYVOvWrau/77XXXtPkyZOVlJSkESNGSJKCwaDC4bCSkpI0bdq06nXvv/9+XXzxxRHaUwCIYj6fz/p8PhsNSkpKbL9+/ezKlStt79697ZdffulaZ/v27Xbq1Kn2oYcessXFxdXLs7Oz7SWXXGJnz55dvWz37t123LhxtqKiwr788sv2wIED1lprZ8yYYSdNmmSDwaC11lb/HQ2q/nt4/f8FohtPSCOuLFy4UJ06ddKAAQPUp08fZWdn1/j6o48+qquuukqVlZUqLy/X/fffr5tuukljx47VwoUL9cILL2jChAnV6z/55JO65ZZbtG3bNi1YsEBnnXWWAoGAPv74Yz344INKSEhQcXGxbrjhBgWDwUjvLvCDcVoJcSU7O1ujR4+WJI0ePVpPPvmk7rzzTiUmfvtP4ZJLLlHfvn3VpEkThUIhvf3229q7d6/uuecepaWl6b///a86dOgg6dsnqzdt2qTt27dr9+7deumll3Tw4EH97ne/0x/+8Aede+65stYqJSVFzZo106xZs3T99dd7tu/A6eDIAXFj+/bt2rJli0aOHClJysrKUnl5uZYvX169Tq9evdS9e3d98sknevLJJ5WZmalZs2Zp8ODBSktL0+9//3vNmTNHkuQ4jhYsWKBJkybp5z//uS666CI99dRTSktL04wZM3TxxRcrKytLP/nJT1RYWKhXXnlFxcXFnuw7cLo4ckDceO+992St1fjx46uXVVRUKDs7W0OGDJEkTZs2TYsWLVJqaqp69OihuXPnatasWSotLVV5ebkqKir0xBNPKD8/X3fccYdWrlypN998U9OmTVN2dramTZum1NRU9e/fXytXrpTjOOrTp4/eeustffHFF0pPT/do74HTQxwQF0KhkBYuXKi7775bmZmZ1cvX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" alt=""></p> <p>应用系统如果遇到系统请求流量的瞬间猛增，有可能会将系统压垮。有了消息队列可以将大量请求缓存起来，分散到很长一段时间处理，这样可以大大提到系统的稳定性和用户体验。</p> <p><img src="/assets/img/mq-6.0a89da63.png" alt=""></p> <p>一般情况，为了保证系统的稳定性，如果系统负载超过阈值，就会阻止用户请求，这会影响用户体验，而如果使用消息队列将请求缓存起来，等待系统处理完毕后通知用户下单完毕，这样总不能下单体验要好。</p> <p><u>处于经济考量目的：</u></p> <p>业务系统正常时段的QPS如果是1000，流量最高峰是10000，为了应对流量高峰配置高性能的服务器显然不划算，这时可以使用消息队列对峰值流量削峰</p> <ul><li>数据分发</li></ul> <p><img src="/assets/img/mq-1.29f2e256.png" alt=""></p> <p>通过消息队列可以让数据在多个系统更加之间进行流通。数据的产生方不需要关心谁来使用数据，只需要将数据发送到消息队列，数据使用方直接在消息队列中直接获取数据即可</p> <p><img src="/assets/img/mq-2.954f1d7f.png" alt=""></p> <h2 id="_1-2-mq的优点和缺点"><a href="#_1-2-mq的优点和缺点" class="header-anchor">#</a> 1.2 MQ的优点和缺点</h2> <p>优点：解耦、削峰、数据分发</p> <p>缺点包含以下几点：</p> <ul><li><p>系统可用性降低</p> <p>系统引入的外部依赖越多，系统稳定性越差。一旦MQ宕机，就会对业务造成影响。</p> <p>如何保证MQ的高可用？</p></li> <li><p>系统复杂度提高</p> <p>MQ的加入大大增加了系统的复杂度，以前系统间是同步的远程调用，现在是通过MQ进行异步调用。</p> <p>如何保证消息没有被重复消费？怎么处理消息丢失情况？那么保证消息传递的顺序性？</p></li> <li><p>一致性问题</p> <p>A系统处理完业务，通过MQ给B、C、D三个系统发消息数据，如果B系统、C系统处理成功，D系统处理失败。</p> <p>如何保证消息数据处理的一致性？</p></li></ul> <h2 id="_1-3-各种mq产品的比较"><a href="#_1-3-各种mq产品的比较" class="header-anchor">#</a> 1.3 各种MQ产品的比较</h2> <p>常见的MQ产品包括Kafka、ActiveMQ、RabbitMQ、RocketMQ。</p> <p><img src="/assets/img/MQ比较.bd4ee29e.png" alt=""></p> <h1 id="_2-rocketmq快速入门"><a href="#_2-rocketmq快速入门" class="header-anchor">#</a> 2. RocketMQ快速入门</h1> <p>RocketMQ是阿里巴巴2016年MQ中间件，使用Java语言开发，在阿里内部，RocketMQ承接了例如“双11”等高并发场景的消息流转，能够处理万亿级别的消息。</p> <h2 id="_2-1-准备工作"><a href="#_2-1-准备工作" class="header-anchor">#</a> 2.1 准备工作</h2> <h3 id="_2-1-1-下载rocketmq"><a href="#_2-1-1-下载rocketmq" class="header-anchor">#</a> 2.1.1 下载RocketMQ</h3> <p>RocketMQ最新版本：4.5.1</p> <p><a href="https://www.apache.org/dyn/closer.cgi?path=rocketmq/4.5.1/rocketmq-all-4.5.1-bin-release.zip" target="_blank" rel="noopener noreferrer">下载地址<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="_2-2-2-环境要求"><a href="#_2-2-2-环境要求" class="header-anchor">#</a> 2.2.2 环境要求</h3> <ul><li><p>Linux64位系统</p></li> <li><p>JDK1.8(64位)</p></li> <li><p>源码安装需要安装Maven 3.2.x</p></li></ul> <h2 id="_2-2-安装rocketmq"><a href="#_2-2-安装rocketmq" class="header-anchor">#</a> 2.2 安装RocketMQ</h2> <h3 id="_2-2-1-安装步骤"><a href="#_2-2-1-安装步骤" class="header-anchor">#</a> 2.2.1 安装步骤</h3> <p>本教程以二进制包方式安装</p> <ol><li>解压安装包</li> <li>进入安装目录</li></ol> <h3 id="_2-2-2-目录介绍"><a href="#_2-2-2-目录介绍" class="header-anchor">#</a> 2.2.2 目录介绍</h3> <ul><li>bin：启动脚本，包括shell脚本和CMD脚本</li> <li>conf：实例配置文件 ，包括broker配置文件、logback配置文件等</li> <li>lib：依赖jar包，包括Netty、commons-lang、FastJSON等</li></ul> <h2 id="_2-3-启动rocketmq"><a href="#_2-3-启动rocketmq" class="header-anchor">#</a> 2.3 启动RocketMQ</h2> <ol><li>启动NameServer</li></ol> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 1.启动NameServer</span>
<span class="token function">nohup</span> <span class="token function">sh</span> bin/mqnamesrv <span class="token operator">&amp;</span>
<span class="token comment"># 2.查看启动日志</span>
<span class="token function">tail</span> <span class="token parameter variable">-f</span> ~/logs/rocketmqlogs/namesrv.log
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ol start="2"><li>启动Broker</li></ol> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 1.启动Broker</span>
<span class="token function">nohup</span> <span class="token function">sh</span> bin/mqbroker <span class="token parameter variable">-n</span> localhost:9876 <span class="token operator">&amp;</span>
<span class="token comment"># 2.查看启动日志</span>
<span class="token function">tail</span> <span class="token parameter variable">-f</span> ~/logs/rocketmqlogs/broker.log 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li><p>问题描述：</p> <p>RocketMQ默认的虚拟机内存较大，启动Broker如果因为内存不足失败，需要编辑如下两个配置文件，修改JVM内存大小</p></li></ul> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 编辑runbroker.sh和runserver.sh修改默认JVM大小</span>
<span class="token function">vi</span> runbroker.sh
<span class="token function">vi</span> runserver.sh
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li>参考设置：</li></ul> <p><code>JAVA_OPT=&quot;${JAVA_OPT} -server -Xms256m -Xmx256m -Xmn128m -XX:MetaspaceSize=128m -XX:MaxMetaspaceSize=320m&quot;</code></p> <h2 id="_2-4-测试rocketmq"><a href="#_2-4-测试rocketmq" class="header-anchor">#</a> 2.4 测试RocketMQ</h2> <h3 id="_2-4-1-发送消息"><a href="#_2-4-1-发送消息" class="header-anchor">#</a> 2.4.1 发送消息</h3> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment"># 1.设置环境变量</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">NAMESRV_ADDR</span><span class="token operator">=</span>localhost:9876
<span class="token comment"># 2.使用安装包的Demo发送消息</span>
<span class="token function">sh</span> tools.sh org.apache.rocketmq.example.quickstart.Producer
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="_2-4-2-接收消息"><a href="#_2-4-2-接收消息" class="header-anchor">#</a> 2.4.2 接收消息</h3> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 1.设置环境变量</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">NAMESRV_ADDR</span><span class="token operator">=</span>localhost:9876
<span class="token comment"># 2.接收消息</span>
<span class="token function">sh</span> tools.sh org.apache.rocketmq.example.quickstart.Consumer
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="_2-5-关闭rocketmq"><a href="#_2-5-关闭rocketmq" class="header-anchor">#</a> 2.5 关闭RocketMQ</h2> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 1.关闭NameServer</span>
<span class="token function">sh</span> bin/mqshutdown namesrv
<span class="token comment"># 2.关闭Broker</span>
<span class="token function">sh</span> bin/mqshutdown broker
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h1 id="_3-rocketmq集群搭建"><a href="#_3-rocketmq集群搭建" class="header-anchor">#</a> 3. RocketMQ集群搭建</h1> <h2 id="_3-1-各角色介绍"><a href="#_3-1-各角色介绍" class="header-anchor">#</a> 3.1 各角色介绍</h2> <ul><li>Producer：消息的发送者；举例：发信者</li> <li>Consumer：消息接收者；举例：收信者</li> <li>Broker：暂存和传输消息；举例：邮局</li> <li>NameServer：管理Broker；举例：各个邮局的管理机构</li> <li>Topic：区分消息的种类；一个发送者可以发送消息给一个或者多个Topic；一个消息的接收者可以订阅一个或者多个Topic消息</li> <li>Message Queue：相当于是Topic的分区；用于并行发送和接收消息</li></ul> <p><img src="/assets/img/RocketMQ角色.7e96f927.jpg" alt=""></p> <h2 id="_3-2-集群搭建方式"><a href="#_3-2-集群搭建方式" class="header-anchor">#</a> 3.2 集群搭建方式</h2> <h3 id="_3-2-1-集群特点"><a href="#_3-2-1-集群特点" class="header-anchor">#</a> 3.2.1 集群特点</h3> <ul><li><p>NameServer是一个几乎无状态节点，可集群部署，节点之间无任何信息同步。</p></li> <li><p>Broker部署相对复杂，Broker分为Master与Slave，一个Master可以对应多个Slave，但是一个Slave只能对应一个Master，Master与Slave的对应关系通过指定相同的BrokerName，不同的BrokerId来定义，BrokerId为0表示Master，非0表示Slave。Master也可以部署多个。每个Broker与NameServer集群中的所有节点建立长连接，定时注册Topic信息到所有NameServer。</p></li> <li><p>Producer与NameServer集群中的其中一个节点（随机选择）建立长连接，定期从NameServer取Topic路由信息，并向提供Topic服务的Master建立长连接，且定时向Master发送心跳。Producer完全无状态，可集群部署。</p></li> <li><p>Consumer与NameServer集群中的其中一个节点（随机选择）建立长连接，定期从NameServer取Topic路由信息，并向提供Topic服务的Master、Slave建立长连接，且定时向Master、Slave发送心跳。Consumer既可以从Master订阅消息，也可以从Slave订阅消息，订阅规则由Broker配置决定。</p></li></ul> <h3 id="_3-2-3-集群模式"><a href="#_3-2-3-集群模式" class="header-anchor">#</a> 3.2.3 集群模式</h3> <h4 id="_1-单master模式"><a href="#_1-单master模式" class="header-anchor">#</a> 1）单Master模式</h4> <p>这种方式风险较大，一旦Broker重启或者宕机时，会导致整个服务不可用。不建议线上环境使用,可以用于本地测试。</p> <h4 id="_2-多master模式"><a href="#_2-多master模式" class="header-anchor">#</a> 2）多Master模式</h4> <p>一个集群无Slave，全是Master，例如2个Master或者3个Master，这种模式的优缺点如下：</p> <ul><li>优点：配置简单，单个Master宕机或重启维护对应用无影响，在磁盘配置为RAID10时，即使机器宕机不可恢复情况下，由于RAID10磁盘非常可靠，消息也不会丢（异步刷盘丢失少量消息，同步刷盘一条不丢），性能最高；</li> <li>缺点：单台机器宕机期间，这台机器上未被消费的消息在机器恢复之前不可订阅，消息实时性会受到影响。</li></ul> <h4 id="_3-多master多slave模式-异步"><a href="#_3-多master多slave模式-异步" class="header-anchor">#</a> 3）多Master多Slave模式（异步）</h4> <p>每个Master配置一个Slave，有多对Master-Slave，HA采用异步复制方式，主备有短暂消息延迟（毫秒级），这种模式的优缺点如下：</p> <ul><li>优点：即使磁盘损坏，消息丢失的非常少，且消息实时性不会受影响，同时Master宕机后，消费者仍然可以从Slave消费，而且此过程对应用透明，不需要人工干预，性能同多Master模式几乎一样；</li> <li>缺点：Master宕机，磁盘损坏情况下会丢失少量消息。</li></ul> <h4 id="_4-多master多slave模式-同步"><a href="#_4-多master多slave模式-同步" class="header-anchor">#</a> 4）多Master多Slave模式（同步）</h4> <p>每个Master配置一个Slave，有多对Master-Slave，HA采用同步双写方式，即只有主备都写成功，才向应用返回成功，这种模式的优缺点如下：</p> <ul><li>优点：数据与服务都无单点故障，Master宕机情况下，消息无延迟，服务可用性与数据可用性都非常高；</li> <li>缺点：性能比异步复制模式略低（大约低10%左右），发送单个消息的RT会略高，且目前版本在主节点宕机后，备机不能自动切换为主机。</li></ul> <h2 id="_3-3-双主双从集群搭建"><a href="#_3-3-双主双从集群搭建" class="header-anchor">#</a> 3.3 双主双从集群搭建</h2> <h3 id="_3-3-1-总体架构"><a href="#_3-3-1-总体架构" class="header-anchor">#</a> 3.3.1 总体架构</h3> <p>消息高可用采用2m-2s（同步双写）方式</p> <p><img src="/assets/img/RocketMQ集群.5ed4beac.png" alt=""></p> <h3 id="_3-3-2-集群工作流程"><a href="#_3-3-2-集群工作流程" class="header-anchor">#</a> 3.3.2 集群工作流程</h3> <ol><li>启动NameServer，NameServer起来后监听端口，等待Broker、Producer、Consumer连上来，相当于一个路由控制中心。</li> <li>Broker启动，跟所有的NameServer保持长连接，定时发送心跳包。心跳包中包含当前Broker信息(IP+端口等)以及存储所有Topic信息。注册成功后，NameServer集群中就有Topic跟Broker的映射关系。</li> <li>收发消息前，先创建Topic，创建Topic时需要指定该Topic要存储在哪些Broker上，也可以在发送消息时自动创建Topic。</li> <li>Producer发送消息，启动时先跟NameServer集群中的其中一台建立长连接，并从NameServer中获取当前发送的Topic存在哪些Broker上，轮询从队列列表中选择一个队列，然后与队列所在的Broker建立长连接从而向Broker发消息。</li> <li>Consumer跟Producer类似，跟其中一台NameServer建立长连接，获取当前订阅Topic存在哪些Broker上，然后直接跟Broker建立连接通道，开始消费消息。</li></ol> <h3 id="_3-3-3-服务器环境"><a href="#_3-3-3-服务器环境" class="header-anchor">#</a> 3.3.3 服务器环境</h3> <table><thead><tr><th><strong>序号</strong></th> <th><strong>IP</strong></th> <th><strong>角色</strong></th> <th><strong>架构模式</strong></th></tr></thead> <tbody><tr><td>1</td> <td>192.168.25.135</td> <td>nameserver、brokerserver</td> <td>Master1、Slave2</td></tr> <tr><td>2</td> <td>192.168.25.138</td> <td>nameserver、brokerserver</td> <td>Master2、Slave1</td></tr></tbody></table> <h3 id="_3-3-4-host添加信息"><a href="#_3-3-4-host添加信息" class="header-anchor">#</a> 3.3.4 Host添加信息</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">vim</span> /etc/hosts
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>配置如下:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># nameserver</span>
<span class="token number">192.168</span>.3.36 rocketmq-nameserver1
<span class="token number">192.168</span>.3.37 rocketmq-nameserver2
<span class="token comment"># broker</span>
<span class="token number">192.168</span>.3.201 rocketmq-master1
<span class="token number">192.168</span>.3.201 rocketmq-slave2
<span class="token number">192.168</span>.3.37 rocketmq-master2
<span class="token number">192.168</span>.3.37 rocketmq-slave1
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>配置完成后, 重启网卡</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>systemctl restart network
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="_3-3-5-防火墙配置"><a href="#_3-3-5-防火墙配置" class="header-anchor">#</a> 3.3.5 防火墙配置</h3> <p>宿主机需要远程访问虚拟机的rocketmq服务和web服务，需要开放相关的端口号，简单粗暴的方式是直接关闭防火墙</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 关闭防火墙</span>
systemctl stop firewalld.service 
<span class="token comment"># 查看防火墙的状态</span>
firewall-cmd <span class="token parameter variable">--state</span> 
<span class="token comment"># 禁止firewall开机启动</span>
systemctl disable firewalld.service
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>或者为了安全，只开放特定的端口号，RocketMQ默认使用3个端口：9876 、10911 、11011 。如果防火墙没有关闭的话，那么防火墙就必须开放这些端口：</p> <ul><li><code>nameserver</code> 默认使用 9876 端口</li> <li><code>master</code> 默认使用 10911 端口</li> <li><code>slave</code> 默认使用11011 端口</li></ul> <p>执行以下命令：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 开放name server默认端口</span>
firewall-cmd --remove-port<span class="token operator">=</span><span class="token number">9876</span>/tcp <span class="token parameter variable">--permanent</span>
<span class="token comment"># 开放master默认端口</span>
firewall-cmd --remove-port<span class="token operator">=</span><span class="token number">10911</span>/tcp <span class="token parameter variable">--permanent</span>
<span class="token comment"># 开放slave默认端口 (当前集群模式可不开启)</span>
firewall-cmd --remove-port<span class="token operator">=</span><span class="token number">11011</span>/tcp <span class="token parameter variable">--permanent</span> 
<span class="token comment"># 重启防火墙</span>
firewall-cmd <span class="token parameter variable">--reload</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="_3-3-6-环境变量配置"><a href="#_3-3-6-环境变量配置" class="header-anchor">#</a> 3.3.6 环境变量配置</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">vim</span> /etc/profile
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>在profile文件的末尾加入如下命令</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment">#set rocketmq</span>
<span class="token assign-left variable">ROCKETMQ_HOME</span><span class="token operator">=</span>/install/soft/rocketmq/rocketmq-all-4.8.0-bin-release
<span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token environment constant">$PATH</span><span class="token builtin class-name">:</span><span class="token variable">$ROCKETMQ_HOME</span>/bin
<span class="token builtin class-name">export</span> ROCKETMQ_HOME <span class="token environment constant">PATH</span>


/soft/mq/rocketmq
/soft/mq/rocketmq


<span class="token assign-left variable">ROCKETMQ_HOME</span><span class="token operator">=</span>/soft/mq/rocketmq
<span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token environment constant">$PATH</span><span class="token builtin class-name">:</span><span class="token variable">$ROCKETMQ_HOME</span>/bin
<span class="token builtin class-name">export</span> ROCKETMQ_HOME <span class="token environment constant">PATH</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>输入:wq! 保存并退出， 并使得配置立刻生效：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token builtin class-name">source</span> /etc/profile


<span class="token number">37</span>
<span class="token comment">#set rocketmq</span>
<span class="token assign-left variable">ROCKETMQ_HOME</span><span class="token operator">=</span>/opt/rocketmq/rocketmq-4.8.0-bin
<span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token environment constant">$PATH</span><span class="token builtin class-name">:</span><span class="token variable">$ROCKETMQ_HOME</span>/bin
<span class="token builtin class-name">export</span> ROCKETMQ_HOME <span class="token environment constant">PATH</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="_3-3-7-创建消息存储路径"><a href="#_3-3-7-创建消息存储路径" class="header-anchor">#</a> 3.3.7 创建消息存储路径</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">mkdir</span> /usr/local/rocketmq/store
<span class="token function">mkdir</span> /usr/local/rocketmq/store/commitlog
<span class="token function">mkdir</span> /usr/local/rocketmq/store/consumequeue
<span class="token function">mkdir</span> /usr/local/rocketmq/store/index
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="_3-3-8-broker配置文件"><a href="#_3-3-8-broker配置文件" class="header-anchor">#</a> 3.3.8 broker配置文件</h3> <h4 id="_1-master1"><a href="#_1-master1" class="header-anchor">#</a> 1）master1</h4> <p>服务器：192.168.3.37</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">vi</span> /opt/rocketmq/rocketmq-4.8.0-bin/conf/2m-2s-sync/broker-a.properties
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>修改配置如下：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment">#所属集群名字</span>
<span class="token assign-left variable">brokerClusterName</span><span class="token operator">=</span>rocketmq-cluster
<span class="token comment">#broker名字，注意此处不同的配置文件填写的不一样</span>
<span class="token assign-left variable">brokerName</span><span class="token operator">=</span>broker-a
<span class="token comment">#0 表示 Master，&gt;0 表示 Slave</span>
<span class="token assign-left variable">brokerId</span><span class="token operator">=</span><span class="token number">0</span>
<span class="token comment">#nameServer地址，分号分割</span>
<span class="token assign-left variable">namesrvAddr</span><span class="token operator">=</span>rocketmq-nameserver1:9876
<span class="token comment">#在发送消息时，自动创建服务器不存在的topic，默认创建的队列数</span>
<span class="token assign-left variable">defaultTopicQueueNums</span><span class="token operator">=</span><span class="token number">4</span>
<span class="token comment">#是否允许 Broker 自动创建Topic，建议线下开启，线上关闭</span>
<span class="token assign-left variable">autoCreateTopicEnable</span><span class="token operator">=</span>true
<span class="token comment">#是否允许 Broker 自动创建订阅组，建议线下开启，线上关闭</span>
<span class="token assign-left variable">autoCreateSubscriptionGroup</span><span class="token operator">=</span>true
<span class="token comment">#Broker 对外服务的监听端口</span>
<span class="token assign-left variable">listenPort</span><span class="token operator">=</span><span class="token number">10911</span>
<span class="token comment">#删除文件时间点，默认凌晨 4点</span>
<span class="token assign-left variable">deleteWhen</span><span class="token operator">=</span>04
<span class="token comment">#文件保留时间，默认 48 小时</span>
<span class="token assign-left variable">fileReservedTime</span><span class="token operator">=</span><span class="token number">120</span>
<span class="token comment">#commitLog每个文件的大小默认1G</span>
<span class="token assign-left variable">mapedFileSizeCommitLog</span><span class="token operator">=</span><span class="token number">1073741824</span>
<span class="token comment">#ConsumeQueue每个文件默认存30W条，根据业务情况调整</span>
<span class="token assign-left variable">mapedFileSizeConsumeQueue</span><span class="token operator">=</span><span class="token number">300000</span>
<span class="token comment">#destroyMapedFileIntervalForcibly=120000</span>
<span class="token comment">#redeleteHangedFileInterval=120000</span>
<span class="token comment">#检测物理文件磁盘空间</span>
<span class="token assign-left variable">diskMaxUsedSpaceRatio</span><span class="token operator">=</span><span class="token number">88</span>
<span class="token comment">#存储路径</span>
<span class="token assign-left variable">storePathRootDir</span><span class="token operator">=</span>/soft/mq/rocketmq/store
<span class="token comment">#commitLog 存储路径</span>
<span class="token assign-left variable">storePathCommitLog</span><span class="token operator">=</span>/soft/mq/rocketmq/store/commitlog
<span class="token comment">#消费队列存储路径存储路径</span>
<span class="token assign-left variable">storePathConsumeQueue</span><span class="token operator">=</span>/soft/mq/rocketmq/store/comsumequeue
<span class="token comment">#消息索引存储路径</span>
<span class="token assign-left variable">storePathIndex</span><span class="token operator">=</span>/soft/mq/rocketmq/store/index
<span class="token comment">#checkpoint 文件存储路径</span>
<span class="token assign-left variable">storeCheckpoint</span><span class="token operator">=</span>/soft/mq/rocketmq/store/checkpoint
<span class="token comment">#abort 文件存储路径</span>
<span class="token assign-left variable">abortFile</span><span class="token operator">=</span>/soft/mq/rocketmq/store/abort
<span class="token comment">#限制的消息大小</span>
<span class="token assign-left variable">maxMessageSize</span><span class="token operator">=</span><span class="token number">65536</span>
<span class="token comment">#flushCommitLogLeastPages=4</span>
<span class="token comment">#flushConsumeQueueLeastPages=2</span>
<span class="token comment">#flushCommitLogThoroughInterval=10000</span>
<span class="token comment">#flushConsumeQueueThoroughInterval=60000</span>
<span class="token comment">#Broker 的角色</span>
<span class="token comment">#- ASYNC_MASTER 异步复制Master</span>
<span class="token comment">#- SYNC_MASTER 同步双写Master</span>
<span class="token comment">#- SLAVE</span>
<span class="token assign-left variable">brokerRole</span><span class="token operator">=</span>SYNC_MASTER
<span class="token comment">#刷盘方式</span>
<span class="token comment">#- ASYNC_FLUSH 异步刷盘</span>
<span class="token comment">#- SYNC_FLUSH 同步刷盘</span>
<span class="token assign-left variable">flushDiskType</span><span class="token operator">=</span>SYNC_FLUSH
<span class="token comment">#checkTransactionMessageEnable=false</span>
<span class="token comment">#发消息线程池数量</span>
<span class="token comment">#sendMessageThreadPoolNums=128</span>
<span class="token comment">#拉消息线程池数量</span>
<span class="token comment">#pullMessageThreadPoolNums=128</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br></div></div><h4 id="_2-slave2"><a href="#_2-slave2" class="header-anchor">#</a> 2）slave2</h4> <p>服务器：192.168.3.37</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">vi</span> /opt/rocketmq/rocketmq-4.8.0-bin/conf/2m-2s-sync/broker-b-s.properties
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>修改配置如下：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment">#所属集群名字</span>
<span class="token assign-left variable">brokerClusterName</span><span class="token operator">=</span>rocketmq-cluster
<span class="token comment">#broker名字，注意此处不同的配置文件填写的不一样</span>
<span class="token assign-left variable">brokerName</span><span class="token operator">=</span>broker-b
<span class="token comment">#0 表示 Master，&gt;0 表示 Slave</span>
<span class="token assign-left variable">brokerId</span><span class="token operator">=</span><span class="token number">1</span>
<span class="token comment">#nameServer地址，分号分割</span>
<span class="token assign-left variable">namesrvAddr</span><span class="token operator">=</span>rocketmq-nameserver1:9876<span class="token punctuation">;</span>rocketmq-nameserver2:9876
<span class="token comment">#在发送消息时，自动创建服务器不存在的topic，默认创建的队列数</span>
<span class="token assign-left variable">defaultTopicQueueNums</span><span class="token operator">=</span><span class="token number">4</span>
<span class="token comment">#是否允许 Broker 自动创建Topic，建议线下开启，线上关闭</span>
<span class="token assign-left variable">autoCreateTopicEnable</span><span class="token operator">=</span>true
<span class="token comment">#是否允许 Broker 自动创建订阅组，建议线下开启，线上关闭</span>
<span class="token assign-left variable">autoCreateSubscriptionGroup</span><span class="token operator">=</span>true
<span class="token comment">#Broker 对外服务的监听端口</span>
<span class="token assign-left variable">listenPort</span><span class="token operator">=</span><span class="token number">11011</span>
<span class="token comment">#删除文件时间点，默认凌晨 4点</span>
<span class="token assign-left variable">deleteWhen</span><span class="token operator">=</span>04
<span class="token comment">#文件保留时间，默认 48 小时</span>
<span class="token assign-left variable">fileReservedTime</span><span class="token operator">=</span><span class="token number">120</span>
<span class="token comment">#commitLog每个文件的大小默认1G</span>
<span class="token assign-left variable">mapedFileSizeCommitLog</span><span class="token operator">=</span><span class="token number">1073741824</span>
<span class="token comment">#ConsumeQueue每个文件默认存30W条，根据业务情况调整</span>
<span class="token assign-left variable">mapedFileSizeConsumeQueue</span><span class="token operator">=</span><span class="token number">300000</span>
<span class="token comment">#destroyMapedFileIntervalForcibly=120000</span>
<span class="token comment">#redeleteHangedFileInterval=120000</span>
<span class="token comment">#检测物理文件磁盘空间</span>
<span class="token assign-left variable">diskMaxUsedSpaceRatio</span><span class="token operator">=</span><span class="token number">88</span>
<span class="token comment">#存储路径</span>
<span class="token assign-left variable">storePathRootDir</span><span class="token operator">=</span>/opt/rocketmq/message2
<span class="token comment">#commitLog 存储路径</span>
<span class="token assign-left variable">storePathCommitLog</span><span class="token operator">=</span>/opt/rocketmq/message2/commitlog
<span class="token comment">#消费队列存储路径存储路径</span>
<span class="token assign-left variable">storePathConsumeQueue</span><span class="token operator">=</span>/opt/rocketmq/message2/consumequeue
<span class="token comment">#消息索引存储路径</span>
<span class="token assign-left variable">storePathIndex</span><span class="token operator">=</span>/opt/rocketmq/message2/index
<span class="token comment">#checkpoint 文件存储路径</span>
<span class="token assign-left variable">storeCheckpoint</span><span class="token operator">=</span>/opt/rocketmq/message2/checkpoint
<span class="token comment">#abort 文件存储路径</span>
<span class="token assign-left variable">abortFile</span><span class="token operator">=</span>/opt/rocketmq/message2/abort
<span class="token comment">#限制的消息大小</span>
<span class="token assign-left variable">maxMessageSize</span><span class="token operator">=</span><span class="token number">65536</span>
<span class="token comment">#flushCommitLogLeastPages=4</span>
<span class="token comment">#flushConsumeQueueLeastPages=2</span>
<span class="token comment">#flushCommitLogThoroughInterval=10000</span>
<span class="token comment">#flushConsumeQueueThoroughInterval=60000</span>
<span class="token comment">#Broker 的角色</span>
<span class="token comment">#- ASYNC_MASTER 异步复制Master</span>
<span class="token comment">#- SYNC_MASTER 同步双写Master</span>
<span class="token comment">#- SLAVE</span>
<span class="token assign-left variable">brokerRole</span><span class="token operator">=</span>SLAVE
<span class="token comment">#刷盘方式</span>
<span class="token comment">#- ASYNC_FLUSH 异步刷盘</span>
<span class="token comment">#- SYNC_FLUSH 同步刷盘</span>
<span class="token assign-left variable">flushDiskType</span><span class="token operator">=</span>ASYNC_FLUSH
<span class="token comment">#checkTransactionMessageEnable=false</span>
<span class="token comment">#发消息线程池数量</span>
<span class="token comment">#sendMessageThreadPoolNums=128</span>
<span class="token comment">#拉消息线程池数量</span>
<span class="token comment">#pullMessageThreadPoolNums=128</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br></div></div><h4 id="_3-master2"><a href="#_3-master2" class="header-anchor">#</a> 3）master2</h4> <p>服务器：192.168.3.201</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">vi</span> /usr/soft/rocketmq/conf/2m-2s-sync/broker-b.properties
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>修改配置如下：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment">#所属集群名字</span>
<span class="token assign-left variable">brokerClusterName</span><span class="token operator">=</span>rocketmq-cluster
<span class="token comment">#broker名字，注意此处不同的配置文件填写的不一样</span>
<span class="token assign-left variable">brokerName</span><span class="token operator">=</span>broker-b
<span class="token comment">#0 表示 Master，&gt;0 表示 Slave</span>
<span class="token assign-left variable">brokerId</span><span class="token operator">=</span><span class="token number">0</span>
<span class="token comment">#nameServer地址，分号分割</span>
<span class="token assign-left variable">namesrvAddr</span><span class="token operator">=</span>rocketmq-nameserver1:9876<span class="token punctuation">;</span>rocketmq-nameserver2:9876
<span class="token comment">#在发送消息时，自动创建服务器不存在的topic，默认创建的队列数</span>
<span class="token assign-left variable">defaultTopicQueueNums</span><span class="token operator">=</span><span class="token number">4</span>
<span class="token comment">#是否允许 Broker 自动创建Topic，建议线下开启，线上关闭</span>
<span class="token assign-left variable">autoCreateTopicEnable</span><span class="token operator">=</span>true
<span class="token comment">#是否允许 Broker 自动创建订阅组，建议线下开启，线上关闭</span>
<span class="token assign-left variable">autoCreateSubscriptionGroup</span><span class="token operator">=</span>true
<span class="token comment">#Broker 对外服务的监听端口</span>
<span class="token assign-left variable">listenPort</span><span class="token operator">=</span><span class="token number">10911</span>
<span class="token comment">#删除文件时间点，默认凌晨 4点</span>
<span class="token assign-left variable">deleteWhen</span><span class="token operator">=</span>04
<span class="token comment">#文件保留时间，默认 48 小时</span>
<span class="token assign-left variable">fileReservedTime</span><span class="token operator">=</span><span class="token number">120</span>
<span class="token comment">#commitLog每个文件的大小默认1G</span>
<span class="token assign-left variable">mapedFileSizeCommitLog</span><span class="token operator">=</span><span class="token number">1073741824</span>
<span class="token comment">#ConsumeQueue每个文件默认存30W条，根据业务情况调整</span>
<span class="token assign-left variable">mapedFileSizeConsumeQueue</span><span class="token operator">=</span><span class="token number">300000</span>
<span class="token comment">#destroyMapedFileIntervalForcibly=120000</span>
<span class="token comment">#redeleteHangedFileInterval=120000</span>
<span class="token comment">#检测物理文件磁盘空间</span>
<span class="token assign-left variable">diskMaxUsedSpaceRatio</span><span class="token operator">=</span><span class="token number">88</span>
<span class="token comment">#存储路径</span>
<span class="token assign-left variable">storePathRootDir</span><span class="token operator">=</span>/install/soft/rocketmq/message
<span class="token comment">#commitLog 存储路径</span>
<span class="token assign-left variable">storePathCommitLog</span><span class="token operator">=</span>/install/soft/rocketmq/message/commitlog
<span class="token comment">#消费队列存储路径存储路径</span>
<span class="token assign-left variable">storePathConsumeQueue</span><span class="token operator">=</span>/install/soft/rocketmq/message/consumequeue
<span class="token comment">#消息索引存储路径</span>
<span class="token assign-left variable">storePathIndex</span><span class="token operator">=</span>/install/soft/rocketmq/message/index
<span class="token comment">#checkpoint 文件存储路径</span>
<span class="token assign-left variable">storeCheckpoint</span><span class="token operator">=</span>/install/soft/rocketmq/message/checkpoint
<span class="token comment">#abort 文件存储路径</span>
<span class="token assign-left variable">abortFile</span><span class="token operator">=</span>/install/soft/rocketmq/message/abort
<span class="token comment">#限制的消息大小</span>
<span class="token assign-left variable">maxMessageSize</span><span class="token operator">=</span><span class="token number">65536</span>
<span class="token comment">#flushCommitLogLeastPages=4</span>
<span class="token comment">#flushConsumeQueueLeastPages=2</span>
<span class="token comment">#flushCommitLogThoroughInterval=10000</span>
<span class="token comment">#flushConsumeQueueThoroughInterval=60000</span>
<span class="token comment">#Broker 的角色</span>
<span class="token comment">#- ASYNC_MASTER 异步复制Master</span>
<span class="token comment">#- SYNC_MASTER 同步双写Master</span>
<span class="token comment">#- SLAVE</span>
<span class="token assign-left variable">brokerRole</span><span class="token operator">=</span>SYNC_MASTER
<span class="token comment">#刷盘方式</span>
<span class="token comment">#- ASYNC_FLUSH 异步刷盘</span>
<span class="token comment">#- SYNC_FLUSH 同步刷盘</span>
<span class="token assign-left variable">flushDiskType</span><span class="token operator">=</span>SYNC_FLUSH
<span class="token comment">#checkTransactionMessageEnable=false</span>
<span class="token comment">#发消息线程池数量</span>
<span class="token comment">#sendMessageThreadPoolNums=128</span>
<span class="token comment">#拉消息线程池数量</span>
<span class="token comment">#pullMessageThreadPoolNums=128</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br></div></div><h4 id="_4-slave1"><a href="#_4-slave1" class="header-anchor">#</a> 4）slave1</h4> <p>服务器：192.168.3.201</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">vi</span> /usr/soft/rocketmq/conf/2m-2s-sync/broker-a-s.properties
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>修改配置如下：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment">#所属集群名字</span>
<span class="token assign-left variable">brokerClusterName</span><span class="token operator">=</span>rocketmq-cluster
<span class="token comment">#broker名字，注意此处不同的配置文件填写的不一样</span>
<span class="token assign-left variable">brokerName</span><span class="token operator">=</span>broker-a
<span class="token comment">#0 表示 Master，&gt;0 表示 Slave</span>
<span class="token assign-left variable">brokerId</span><span class="token operator">=</span><span class="token number">1</span>
<span class="token comment">#nameServer地址，分号分割</span>
<span class="token assign-left variable">namesrvAddr</span><span class="token operator">=</span>rocketmq-nameserver1:9876<span class="token punctuation">;</span>rocketmq-nameserver2:9876
<span class="token comment">#在发送消息时，自动创建服务器不存在的topic，默认创建的队列数</span>
<span class="token assign-left variable">defaultTopicQueueNums</span><span class="token operator">=</span><span class="token number">4</span>
<span class="token comment">#是否允许 Broker 自动创建Topic，建议线下开启，线上关闭</span>
<span class="token assign-left variable">autoCreateTopicEnable</span><span class="token operator">=</span>true
<span class="token comment">#是否允许 Broker 自动创建订阅组，建议线下开启，线上关闭</span>
<span class="token assign-left variable">autoCreateSubscriptionGroup</span><span class="token operator">=</span>true
<span class="token comment">#Broker 对外服务的监听端口</span>
<span class="token assign-left variable">listenPort</span><span class="token operator">=</span><span class="token number">11011</span>
<span class="token comment">#删除文件时间点，默认凌晨 4点</span>
<span class="token assign-left variable">deleteWhen</span><span class="token operator">=</span>04
<span class="token comment">#文件保留时间，默认 48 小时</span>
<span class="token assign-left variable">fileReservedTime</span><span class="token operator">=</span><span class="token number">120</span>
<span class="token comment">#commitLog每个文件的大小默认1G</span>
<span class="token assign-left variable">mapedFileSizeCommitLog</span><span class="token operator">=</span><span class="token number">1073741824</span>
<span class="token comment">#ConsumeQueue每个文件默认存30W条，根据业务情况调整</span>
<span class="token assign-left variable">mapedFileSizeConsumeQueue</span><span class="token operator">=</span><span class="token number">300000</span>
<span class="token comment">#destroyMapedFileIntervalForcibly=120000</span>
<span class="token comment">#redeleteHangedFileInterval=120000</span>
<span class="token comment">#检测物理文件磁盘空间</span>
<span class="token assign-left variable">diskMaxUsedSpaceRatio</span><span class="token operator">=</span><span class="token number">88</span>
<span class="token comment">#存储路径</span>
<span class="token assign-left variable">storePathRootDir</span><span class="token operator">=</span>/install/soft/rocketmq/message2
<span class="token comment">#commitLog 存储路径</span>
<span class="token assign-left variable">storePathCommitLog</span><span class="token operator">=</span>/install/soft/rocketmq/message2/commitlog
<span class="token comment">#消费队列存储路径存储路径</span>
<span class="token assign-left variable">storePathConsumeQueue</span><span class="token operator">=</span>/install/soft/rocketmq/message2/consumequeue
<span class="token comment">#消息索引存储路径</span>
<span class="token assign-left variable">storePathIndex</span><span class="token operator">=</span>/install/soft/rocketmq/message2/index
<span class="token comment">#checkpoint 文件存储路径</span>
<span class="token assign-left variable">storeCheckpoint</span><span class="token operator">=</span>/install/soft/rocketmq/message2/checkpoint
<span class="token comment">#abort 文件存储路径</span>
<span class="token assign-left variable">abortFile</span><span class="token operator">=</span>/install/soft/rocketmq/message2/abort
<span class="token comment">#限制的消息大小</span>
<span class="token assign-left variable">maxMessageSize</span><span class="token operator">=</span><span class="token number">65536</span>
<span class="token comment">#flushCommitLogLeastPages=4</span>
<span class="token comment">#flushConsumeQueueLeastPages=2</span>
<span class="token comment">#flushCommitLogThoroughInterval=10000</span>
<span class="token comment">#flushConsumeQueueThoroughInterval=60000</span>
<span class="token comment">#Broker 的角色</span>
<span class="token comment">#- ASYNC_MASTER 异步复制Master</span>
<span class="token comment">#- SYNC_MASTER 同步双写Master</span>
<span class="token comment">#- SLAVE</span>
<span class="token assign-left variable">brokerRole</span><span class="token operator">=</span>SLAVE
<span class="token comment">#刷盘方式</span>
<span class="token comment">#- ASYNC_FLUSH 异步刷盘</span>
<span class="token comment">#- SYNC_FLUSH 同步刷盘</span>
<span class="token assign-left variable">flushDiskType</span><span class="token operator">=</span>ASYNC_FLUSH
<span class="token comment">#checkTransactionMessageEnable=false</span>
<span class="token comment">#发消息线程池数量</span>
<span class="token comment">#sendMessageThreadPoolNums=128</span>
<span class="token comment">#拉消息线程池数量</span>
<span class="token comment">#pullMessageThreadPoolNums=128</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br></div></div><h3 id="_3-3-9-修改启动脚本文件"><a href="#_3-3-9-修改启动脚本文件" class="header-anchor">#</a> 3.3.9 修改启动脚本文件</h3> <h4 id="_1-runbroker-sh"><a href="#_1-runbroker-sh" class="header-anchor">#</a> 1）runbroker.sh</h4> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">vi</span> /usr/local/rocketmq/bin/runbroker.sh
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>需要根据内存大小进行适当的对JVM参数进行调整：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment">#===================================================</span>
<span class="token comment"># 开发环境配置 JVM Configuration</span>
<span class="token assign-left variable">JAVA_OPT</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">${JAVA_OPT}</span> -server -Xms256m -Xmx256m -Xmn128m&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>####2）runserver.sh</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">vim</span> /usr/local/rocketmq/bin/runserver.sh
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token assign-left variable">JAVA_OPT</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">${JAVA_OPT}</span> -server -Xms256m -Xmx256m -Xmn128m -XX:MetaspaceSize=128m -XX:MaxMetaspaceSize=320m&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="_3-3-10-服务启动"><a href="#_3-3-10-服务启动" class="header-anchor">#</a> 3.3.10 服务启动</h3> <h4 id="_1-启动nameserve集群"><a href="#_1-启动nameserve集群" class="header-anchor">#</a> 1）启动NameServe集群</h4> <p>分别在192.168.3.37和192.168.3.201启动NameServer</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> /usr/local/rocketmq/bin
<span class="token function">nohup</span> <span class="token function">sh</span> mqnamesrv <span class="token operator">&amp;</span>

/install/soft/rocketmq/rocketmq-all-4.8.0-bin-release/conf/2m-2s-sync
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h4 id="_2-启动broker集群"><a href="#_2-启动broker集群" class="header-anchor">#</a> 2）启动Broker集群</h4> <ul><li>在192.168.3.37上启动master1和slave2</li></ul> <p>master1：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> /usr/local/rocketmq/bin
<span class="token function">nohup</span> <span class="token function">sh</span> mqbroker <span class="token parameter variable">-c</span> /opt/rocketmq/rocketmq-4.8.0-bin/conf/2m-2s-sync/broker-a.properties <span class="token operator">&amp;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>slave2：</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token builtin class-name">cd</span> /usr/local/rocketmq/bin
<span class="token function">nohup</span> <span class="token function">sh</span> mqbroker <span class="token parameter variable">-c</span> /opt/rocketmq/rocketmq-4.8.0-bin/conf/2m-2s-sync/broker-b-s.properties <span class="token operator">&amp;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>在192.168.3.201上启动master2和slave2</li></ul> <p>master2</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token builtin class-name">cd</span> /usr/local/rocketmq/bin
<span class="token function">nohup</span> <span class="token function">sh</span> mqbroker <span class="token parameter variable">-c</span> /install/soft/rocketmq/rocketmq-all-4.8.0-bin-release/conf/2m-2s-sync/broker-b.properties <span class="token operator">&amp;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>slave1</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token builtin class-name">cd</span> /usr/local/rocketmq/bin
<span class="token function">nohup</span> <span class="token function">sh</span> mqbroker <span class="token parameter variable">-c</span> /install/soft/rocketmq/rocketmq-all-4.8.0-bin-release/conf/2m-2s-sync/broker-a-s.properties <span class="token operator">&amp;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="_3-3-11-查看进程状态"><a href="#_3-3-11-查看进程状态" class="header-anchor">#</a> 3.3.11 查看进程状态</h3> <p>启动后通过JPS查看启动进程</p> <p><img src="data:image/png;base64,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" alt=""></p> <h3 id="_3-3-12-查看日志"><a href="#_3-3-12-查看日志" class="header-anchor">#</a> 3.3.12 查看日志</h3> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment"># 查看nameServer日志</span>
<span class="token function">tail</span> <span class="token parameter variable">-500f</span> ~/logs/rocketmqlogs/namesrv.log
<span class="token comment"># 查看broker日志</span>
<span class="token function">tail</span> <span class="token parameter variable">-500f</span> ~/logs/rocketmqlogs/broker.log
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="_3-4-mqadmin管理工具"><a href="#_3-4-mqadmin管理工具" class="header-anchor">#</a> 3.4 mqadmin管理工具</h2> <h3 id="_3-4-1-使用方式"><a href="#_3-4-1-使用方式" class="header-anchor">#</a> 3.4.1 使用方式</h3> <p>进入RocketMQ安装位置，在bin目录下执行<code>./mqadmin {command} {args}</code></p> <p>###3.4.2 命令介绍</p> <p>####1）Topic相关</p> <table border="0" cellpadding="0" cellspacing="0" width="714"><col width="177"> <col width="175"> <col width="177"> <col width="185"> <tr height="23" style="height:17.0pt;"><td height="23" width="177" class="xl63" style="height:17.0pt;width:133pt;">名称</td> <td width="175" class="xl64" style="width:131pt;">含义</td> <td width="177" class="xl64" style="width:133pt;">命令选项</td> <td width="185" class="xl64" style="width:139pt;">说明</td></tr> <tr height="132" style="height:99.0pt;"><td rowspan="8" height="593" width="163" class="xl68" style="border-bottom:1.0pt;height:444.0pt;border-top:none;width:122pt;">updateTopic</td> <td rowspan="8" width="135" class="xl70" style="border-bottom:1.0pt;border-top:none;width:101pt;">创建更新Topic配置</td> <td width="149" class="xl65" style="width:112pt;">-b</td> <td width="159" class="xl66" style="width:119pt;">Broker 地址，表示 topic 所在
  Broker，只支持单台Broker，地址为ip:port</td></tr> <tr height="132" style="height:99.0pt;"><td height="132" width="149" class="xl65" style="height:99.0pt;width:112pt;">-c</td> <td width="159" class="xl66" style="width:119pt;">cluster 名称，表示 topic 所在集群（集群可通过
  clusterList 查询）</td></tr> <tr height="23" style="height:17.0pt;"><td height="23" width="149" class="xl65" style="height:17.0pt;width:112pt;">-h-</td> <td width="159" class="xl66" style="width:119pt;">打印帮助</td></tr> <tr height="57" style="height:43.0pt;"><td height="57" width="149" class="xl65" style="height:43.0pt;width:112pt;">-n</td> <td width="159" class="xl66" style="width:119pt;">NameServer服务地址，格式 ip:port</td></tr> <tr height="76" style="height:57.0pt;"><td height="76" width="149" class="xl65" style="height:57.0pt;width:112pt;">-p</td> <td width="159" class="xl66" style="width:119pt;">指定新topic的读写权限( W=2|R=4|WR=6 )</td></tr> <tr height="39" style="height:29.0pt;"><td height="39" width="149" class="xl65" style="height:29.0pt;width:112pt;">-r</td> <td width="159" class="xl66" style="width:119pt;">可读队列数（默认为 8）</td></tr> <tr height="39" style="height:29.0pt;"><td height="39" width="149" class="xl65" style="height:29.0pt;width:112pt;">-w</td> <td width="159" class="xl66" style="width:119pt;">可写队列数（默认为 8）</td></tr> <tr height="95" style="height:71.0pt;"><td height="95" width="149" class="xl65" style="height:71.0pt;width:112pt;">-t</td> <td width="159" class="xl66" style="width:119pt;">topic 名称（名称只能使用字符
  ^[a-zA-Z0-9_-]+$ ）</td></tr> <tr height="132" style="height:99.0pt;"><td rowspan="4" height="307" width="163" class="xl68" style="border-bottom:1.0pt;height:230.0pt;border-top:none;width:122pt;">deleteTopic</td> <td rowspan="4" width="135" class="xl70" style="border-bottom:1.0pt;border-top:none;width:101pt;">删除Topic</td> <td width="149" class="xl65" style="width:112pt;">-c</td> <td width="159" class="xl66" style="width:119pt;">cluster 名称，表示删除某集群下的某个 topic （集群
  可通过 clusterList 查询）</td></tr> <tr height="23" style="height:17.0pt;"><td height="23" width="149" class="xl65" style="height:17.0pt;width:112pt;">-h</td> <td width="159" class="xl66" style="width:119pt;">打印帮助</td></tr> <tr height="57" style="height:43.0pt;"><td height="57" width="149" class="xl65" style="height:43.0pt;width:112pt;">-n</td> <td width="159" class="xl66" style="width:119pt;">NameServer 服务地址，格式 ip:port</td></tr> <tr height="95" style="height:71.0pt;"><td height="95" width="149" class="xl65" style="height:71.0pt;width:112pt;">-t</td> <td width="159" class="xl66" style="width:119pt;">topic 名称（名称只能使用字符
  ^[a-zA-Z0-9_-]+$ ）</td></tr> <tr height="23" style="height:17.0pt;"><td rowspan="3" height="287" width="163" class="xl68" style="border-bottom:1.0pt;height:215.0pt;border-top:none;width:122pt;">topicList</td> <td rowspan="3" width="135" class="xl70" style="border-bottom:1.0pt;border-top:none;width:101pt;">查看 Topic 列表信息</td> <td width="149" class="xl65" style="width:112pt;">-h</td> <td width="159" class="xl66" style="width:119pt;">打印帮助</td></tr> <tr height="207" style="height:155.0pt;"><td height="207" width="149" class="xl65" style="height:155.0pt;width:112pt;">-c</td> <td width="159" class="xl66" style="width:119pt;">不配置-c只返回topic列表，增加-c返回clusterName,
  topic, consumerGroup信息，即topic的所属集群和订阅关系，没有参数</td></tr> <tr height="57" style="height:43.0pt;"><td height="57" width="149" class="xl65" style="height:43.0pt;width:112pt;">-n</td> <td width="159" class="xl66" style="width:119pt;">NameServer 服务地址，格式 ip:port</td></tr> <tr height="23" style="height:17.0pt;"><td rowspan="3" height="103" width="163" class="xl68" style="border-bottom:1.0pt;height:77.0pt;border-top:none;width:122pt;">topicRoute</td> <td rowspan="3" width="135" class="xl70" style="border-bottom:1.0pt;border-top:none;width:101pt;">查看 Topic 路由信息</td> <td width="149" class="xl65" style="width:112pt;">-t</td> <td width="159" class="xl66" style="width:119pt;">topic 名称</td></tr> <tr height="23" style="height:17.0pt;"><td height="23" width="149" class="xl65" style="height:17.0pt;width:112pt;">-h</td> <td width="159" class="xl66" style="width:119pt;">打印帮助</td></tr> <tr height="57" style="height:43.0pt;"><td height="57" width="149" class="xl65" style="height:43.0pt;width:112pt;">-n</td> <td width="159" class="xl66" style="width:119pt;">NameServer 服务地址，格式 ip:port</td></tr> <tr height="23" style="height:17.0pt;"><td rowspan="3" height="103" width="163" class="xl68" style="border-bottom:1.0pt;height:77.0pt;border-top:none;width:122pt;">topicStatus</td> <td rowspan="3" width="135" class="xl70" style="border-bottom:1.0pt;border-top:none;width:101pt;">查看 Topic 消息队列offset</td> <td width="149" class="xl65" style="width:112pt;">-t</td> <td width="159" class="xl66" style="width:119pt;">topic 名称</td></tr> <tr height="23" style="height:17.0pt;"><td height="23" width="149" class="xl65" style="height:17.0pt;width:112pt;">-h</td> <td width="159" class="xl66" style="width:119pt;">打印帮助</td></tr> <tr height="57" style="height:43.0pt;"><td height="57" width="149" class="xl65" style="height:43.0pt;width:112pt;">-n</td> <td width="159" class="xl66" style="width:119pt;">NameServer 服务地址，格式 ip:port</td></tr> <tr height="23" style="height:17.0pt;"><td rowspan="3" height="103" width="163" class="xl68" style="border-bottom:1.0pt;height:77.0pt;border-top:none;width:122pt;">topicClusterList</td> <td rowspan="3" width="135" class="xl70" style="border-bottom:1.0pt;border-top:none;width:101pt;">查看 Topic 所在集群列表</td> <td width="149" class="xl65" style="width:112pt;">-t</td> <td width="159" class="xl66" style="width:119pt;">topic 名称</td></tr> <tr height="23" style="height:17.0pt;"><td height="23" width="149" class="xl65" style="height:17.0pt;width:112pt;">-h</td> <td width="159" class="xl66" style="width:119pt;">打印帮助</td></tr> <tr height="57" style="height:43.0pt;"><td height="57" width="149" class="xl65" style="height:43.0pt;width:112pt;">-n</td> <td width="159" class="xl66" style="width:119pt;">NameServer 服务地址，格式 ip:port</td></tr> <tr height="23" style="height:17.0pt;"><td rowspan="6" height="518" width="163" class="xl68" style="border-bottom:1.0pt;height:380pt;border-top:none;width:122pt;">updateTopicPerm</td> <td rowspan="6" width="135" class="xl70" style="border-bottom:1.0pt;border-top:none;width:101pt;">更新 Topic 读写权限</td> <td width="149" class="xl65" style="width:112pt;">-t</td> <td width="159" class="xl66" style="width:119pt;">topic 名称</td></tr> <tr height="23" style="height:17.0pt;"><td height="23" width="149" class="xl65" style="height:17.0pt;width:112pt;">-h</td> <td width="159" class="xl66" style="width:119pt;">打印帮助</td></tr> <tr height="57" style="height:43.0pt;"><td height="57" width="149" class="xl65" style="height:43.0pt;width:112pt;">-n</td> <td width="159" class="xl66" style="width:119pt;">NameServer 服务地址，格式 ip:port</td></tr> <tr height="132" style="height:99.0pt;"><td height="132" width="149" class="xl65" style="height:99.0pt;width:112pt;">-b</td> <td width="159" class="xl66" style="width:119pt;">Broker 地址，表示 topic 所在
  Broker，只支持单台Broker，地址为ip:port</td></tr> <tr height="76" style="height:57.0pt;"><td height="76" width="149" class="xl65" style="height:57.0pt;width:112pt;">-p</td> <td width="159" class="xl66" style="width:119pt;">指定新 topic 的读写权限( W=2|R=4|WR=6 )</td></tr> <tr height="207" style="height:155.0pt;"><td height="207" width="149" class="xl65" style="height:155.0pt;width:112pt;">-c</td> <td width="159" class="xl66" style="width:119pt;">cluster 名称，表示 topic 所在集群（集群可通过
  clusterList 查询），-b优先，如果没有-b，则对集群中所有Broker执行命令</td></tr> <tr height="23" style="height:17.0pt;"><td rowspan="5" height="199" width="163" class="xl68" style="border-bottom:1.0pt;height:149.0pt;border-top:none;width:122pt;">updateOrderConf</td> <td rowspan="5" width="135" class="xl70" style="border-bottom:1.0pt;border-top:none;width:101pt;">从NameServer上创建、删除、获取特定命名空间的kv配置，目前还未启用</td> <td width="149" class="xl65" style="width:112pt;">-h</td> <td width="159" class="xl66" style="width:119pt;">打印帮助</td></tr> <tr height="57" style="height:43.0pt;"><td height="57" width="149" class="xl65" style="height:43.0pt;width:112pt;">-n</td> <td width="159" class="xl66" style="width:119pt;">NameServer 服务地址，格式 ip:port</td></tr> <tr height="23" style="height:17.0pt;"><td height="23" width="149" class="xl65" style="height:17.0pt;width:112pt;">-t</td> <td width="159" class="xl66" style="width:119pt;">topic，键</td></tr> <tr height="39" style="height:29.0pt;"><td height="39" width="149" class="xl65" style="height:29.0pt;width:112pt;">-v</td> <td width="159" class="xl66" style="width:119pt;">orderConf，值</td></tr> <tr height="57" style="height:43.0pt;"><td height="57" width="149" class="xl65" style="height:43.0pt;width:112pt;">-m</td> <td width="159" class="xl66" style="width:119pt;">method，可选get、put、delete</td></tr> <tr height="23" style="height:17.0pt;"><td rowspan="4" height="198" width="163" class="xl68" style="border-bottom:1.0pt;height:140pt;border-top:none;width:122pt;">allocateMQ</td> <td rowspan="4" width="135" class="xl70" style="border-bottom:1.0pt;border-top:none;width:101pt;">以平均负载算法计算消费者列表负载消息队列的负载结果</td> <td width="149" class="xl65" style="width:112pt;">-t</td> <td width="159" class="xl66" style="width:119pt;">topic 名称</td></tr> <tr height="23" style="height:17.0pt;"><td height="23" width="149" class="xl65" style="height:17.0pt;width:112pt;">-h</td> <td width="159" class="xl66" style="width:119pt;">打印帮助</td></tr> <tr height="57" style="height:43.0pt;"><td height="57" width="149" class="xl65" style="height:43.0pt;width:112pt;">-n</td> <td width="159" class="xl66" style="width:119pt;">NameServer 服务地址，格式 ip:port</td></tr> <tr height="95" style="height:71.0pt;"><td height="95" width="149" class="xl65" style="height:71.0pt;width:112pt;">-i</td> <td width="159" class="xl66" style="width:119pt;">ipList，用逗号分隔，计算这些ip去负载Topic的消息队列</td></tr> <tr height="23" style="height:17.0pt;"><td rowspan="4" height="142" width="163" class="xl68" style="border-bottom:1.0pt solid black;height:106.0pt;border-top:1.0pt;width:122pt;">statsAll</td> <td rowspan="4" width="135" class="xl70" style="border-bottom:1.0pt;border-top:none;width:101pt;">打印Topic订阅关系、TPS、积累量、24h读写总量等信息</td> <td width="149" class="xl65" style="width:112pt;">-h</td> <td width="159" class="xl66" style="width:119pt;">打印帮助</td></tr> <tr height="57" style="height:43.0pt;"><td height="57" width="149" class="xl65" style="height:43.0pt;width:112pt;">-n</td> <td width="159" class="xl66" style="width:119pt;">NameServer 服务地址，格式 ip:port</td></tr> <tr height="39" style="height:29.0pt;"><td height="39" width="149" class="xl65" style="height:29.0pt;width:112pt;">-a</td> <td width="159" class="xl66" style="width:119pt;">是否只打印活跃topic</td></tr> <tr height="23" style="height:17.0pt;"><td height="23" width="149" class="xl65" style="height:17.0pt;width:112pt;">-t</td> <td width="159" class="xl66" style="width:119pt;">指定topic</td></tr></table> <p>####2）集群相关</p> <table border="0" cellpadding="0" cellspacing="0" width="714"><col width="177"> <col width="175"> <col width="177"> <col width="185"> <tr height="23" style="height:17.0pt;"><td height="23" width="177" class="xl63" style="height:17.0pt;width:133pt;">名称</td> <td width="175" class="xl64" style="width:131pt;">含义</td> <td width="177" class="xl64" style="width:133pt;">命令选项</td> <td width="185" class="xl64" style="width:139pt;">说明</td></tr> <tr height="207" style="height:155.0pt;"><td rowspan="4" height="326" width="177" class="xl67" style="border-bottom:1.0pt;height:244.0pt;border-top:none;width:133pt;"><span style="mso-spacerun:yes;"></span>clusterList</td> <td rowspan="4" width="175" class="xl70" style="border-bottom:1.0pt;border-top:none;width:131pt;">查看集群信息，集群、BrokerName、BrokerId、TPS等信息</td> <td width="177" class="xl65" style="width:133pt;">-m</td> <td width="185" class="xl66" style="width:139pt;">打印更多信息 (增加打印出如下信息 #InTotalYest,
  #OutTotalYest, #InTotalToday ,#OutTotalToday)</td></tr> <tr height="23" style="height:17.0pt;"><td height="23" width="177" class="xl65" style="height:17.0pt;width:133pt;">-h</td> <td width="185" class="xl66" style="width:139pt;">打印帮助</td></tr> <tr height="57" style="height:43.0pt;"><td height="57" width="177" class="xl65" style="height:43.0pt;width:133pt;">-n</td> <td width="185" class="xl66" style="width:139pt;">NameServer 服务地址，格式 ip:port</td></tr> <tr height="39" style="height:29.0pt;"><td height="39" width="177" class="xl65" style="height:29.0pt;width:133pt;">-i</td> <td width="185" class="xl66" style="width:139pt;">打印间隔，单位秒</td></tr> <tr height="95" style="height:71.0pt;"><td rowspan="8" height="391" width="177" class="xl67" style="border-bottom:1.0pt;height:292.0pt;border-top:none;width:133pt;">clusterRT</td> <td rowspan="8" width="175" class="xl70" style="border-bottom:1.0pt;border-top:none;width:131pt;">发送消息检测集群各Broker RT。消息发往${BrokerName} Topic。</td> <td width="177" class="xl65" style="width:133pt;">-a</td> <td width="185" class="xl66" style="width:139pt;">amount，每次探测的总数，RT = 总时间 /
  amount</td></tr> <tr height="39" style="height:29.0pt;"><td height="39" width="177" class="xl65" style="height:29.0pt;width:133pt;">-s</td> <td width="185" class="xl66" style="width:139pt;">消息大小，单位B</td></tr> <tr height="23" style="height:17.0pt;"><td height="23" width="177" class="xl65" style="height:17.0pt;width:133pt;">-c</td> <td width="185" class="xl66" style="width:139pt;">探测哪个集群</td></tr> <tr height="76" style="height:57.0pt;"><td height="76" width="177" class="xl65" style="height:57.0pt;width:133pt;">-p</td> <td width="185" class="xl66" style="width:139pt;">是否打印格式化日志，以|分割，默认不打印</td></tr> <tr height="23" style="height:17.0pt;"><td height="23" width="177" class="xl65" style="height:17.0pt;width:133pt;">-h</td> <td width="185" class="xl66" style="width:139pt;">打印帮助</td></tr> <tr height="39" style="height:29.0pt;"><td height="39" width="177" class="xl65" style="height:29.0pt;width:133pt;">-m</td> <td width="185" class="xl66" style="width:139pt;">所属机房，打印使用</td></tr> <tr height="39" style="height:29.0pt;"><td height="39" width="177" class="xl65" style="height:29.0pt;width:133pt;">-i</td> <td width="185" class="xl66" style="width:139pt;">发送间隔，单位秒</td></tr> <tr height="57" style="height:43.0pt;"><td height="57" width="177" class="xl65" style="height:43.0pt;width:133pt;">-n</td> <td width="185" class="xl66" style="width:139pt;">NameServer 服务地址，格式 ip:port</td></tr></table> <p>####3）Broker相关</p> <table border="0" cellpadding="0" cellspacing="0" width="714"><col width="177"> <col width="175"> <col width="177"> <col width="185"> <tr height="23" style="height:17.0pt;"><td height="23" width="177" class="xl63" style="height:17.0pt;width:133pt;">名称</td> <td width="175" class="xl64" style="width:131pt;">含义</td> <td width="177" class="xl64" style="width:133pt;">命令选项</td> <td width="185" class="xl64" style="width:139pt;">说明</td></tr> <tr height="57" style="height:43.0pt;"><td rowspan="6" height="206" width="191" class="xl69" style="border-bottom:1.0pt;height:154.0pt;border-top:none;width:143pt;">updateBrokerConfig</td> <td rowspan="6" width="87" class="xl72" style="border-bottom:1.0pt;border-top:none;width:65pt;">更新 Broker 配置文件，会修改Broker.conf</td> <td width="87" class="xl67" style="width:65pt;">-b</td> <td width="87" class="xl68" style="width:65pt;">Broker 地址，格式为ip:port</td></tr> <tr height="23" style="height:17.0pt;"><td height="23" width="87" class="xl67" style="height:17.0pt;width:65pt;">-c</td> <td width="87" class="xl68" style="width:65pt;">cluster 名称</td></tr> <tr height="23" style="height:17.0pt;"><td height="23" width="87" class="xl67" style="height:17.0pt;width:65pt;">-k</td> <td width="87" class="xl68" style="width:65pt;">key 值</td></tr> <tr height="23" style="height:17.0pt;"><td height="23" width="87" class="xl67" style="height:17.0pt;width:65pt;">-v</td> <td width="87" class="xl68" style="width:65pt;">value 值</td></tr> <tr height="23" style="height:17.0pt;"><td height="23" width="87" class="xl67" style="height:17.0pt;width:65pt;">-h</td> <td width="87" class="xl68" style="width:65pt;">打印帮助</td></tr> <tr height="57" style="height:43.0pt;"><td height="57" width="87" class="xl67" style="height:43.0pt;width:65pt;">-n</td> <td width="87" class="xl68" style="width:65pt;">NameServer 服务地址，格式 ip:port</td></tr> <tr height="57" style="height:43.0pt;"><td rowspan="3" height="137" width="191" class="xl69" style="border-bottom:1.0pt;height:103.0pt;border-top:none;width:143pt;">brokerStatus</td> <td rowspan="3" width="87" class="xl72" style="border-bottom:1.0pt;border-top:none;width:65pt;">查看 Broker 统计信息、运行状态（你想要的信息几乎都在里面）</td> <td width="87" class="xl67" style="width:65pt;">-b</td> <td width="87" class="xl68" style="width:65pt;">Broker 地址，地址为ip:port</td></tr> <tr height="23" style="height:17.0pt;"><td height="23" width="87" class="xl67" style="height:17.0pt;width:65pt;">-h</td> <td width="87" class="xl68" style="width:65pt;">打印帮助</td></tr> <tr height="57" style="height:43.0pt;"><td height="57" width="87" class="xl67" style="height:43.0pt;width:65pt;">-n</td> <td width="87" class="xl68" style="width:65pt;">NameServer 服务地址，格式 ip:port</td></tr> <tr height="57" style="height:43.0pt;"><td rowspan="6" height="256" width="191" class="xl69" style="border-bottom:1.0pt;height:192.0pt;border-top:none;width:143pt;">brokerConsumeStats</td> <td rowspan="6" width="87" class="xl72" style="border-bottom:1.0pt;border-top:none;width:65pt;">Broker中各个消费者的消费情况，按Message Queue维度返回Consume
  Offset，Broker Offset，Diff，TImestamp等信息</td> <td width="87" class="xl67" style="width:65pt;">-b</td> <td width="87" class="xl68" style="width:65pt;">Broker 地址，地址为ip:port</td></tr> <tr height="23" style="height:17.0pt;"><td height="23" width="87" class="xl67" style="height:17.0pt;width:65pt;">-t</td> <td width="87" class="xl68" style="width:65pt;">请求超时时间</td></tr> <tr height="39" style="height:29.0pt;"><td height="39" width="87" class="xl67" style="height:29.0pt;width:65pt;">-l</td> <td width="87" class="xl68" style="width:65pt;">diff阈值，超过阈值才打印</td></tr> <tr height="57" style="height:43.0pt;"><td height="57" width="87" class="xl67" style="height:43.0pt;width:65pt;">-o</td> <td width="87" class="xl68" style="width:65pt;">是否为顺序topic，一般为false</td></tr> <tr height="23" style="height:17.0pt;"><td height="23" width="87" class="xl67" style="height:17.0pt;width:65pt;">-h</td> <td width="87" class="xl68" style="width:65pt;">打印帮助</td></tr> <tr height="57" style="height:43.0pt;"><td height="57" width="87" class="xl67" style="height:43.0pt;width:65pt;">-n</td> <td width="87" class="xl68" style="width:65pt;">NameServer 服务地址，格式 ip:port</td></tr> <tr height="57" style="height:43.0pt;"><td rowspan="2" height="114" width="191" class="xl69" style="border-bottom:1.0pt;height:86.0pt;border-top:none;width:143pt;">getBrokerConfig</td> <td rowspan="2" width="87" class="xl72" style="border-bottom:1.0pt;width:65pt;">获取Broker配置</td> <td width="87" class="xl67" style="width:65pt;">-b</td> <td width="87" class="xl68" style="width:65pt;">Broker 地址，地址为ip:port</td></tr> <tr height="57" style="height:43.0pt;"><td height="57" width="87" class="xl67" style="height:43.0pt;width:65pt;">-n</td> <td width="87" class="xl68" style="width:65pt;">NameServer 服务地址，格式 ip:port</td></tr> <tr height="57" style="height:43.0pt;"><td rowspan="3" height="137" width="191" class="xl69" style="border-bottom:1.0pt;height:103.0pt;border-top:none;width:143pt;">wipeWritePerm</td> <td rowspan="3" width="87" class="xl72" style="border-bottom:1.0pt;width:65pt;">从NameServer上清除 Broker写权限</td> <td width="87" class="xl67" style="width:65pt;">-b</td> <td width="87" class="xl68" style="width:65pt;">Broker 地址，地址为ip:port</td></tr> <tr height="57" style="height:43.0pt;"><td height="57" width="87" class="xl67" style="height:43.0pt;width:65pt;">-n</td> <td width="87" class="xl68" style="width:65pt;">NameServer 服务地址，格式 ip:port</td></tr> <tr height="23" style="height:17.0pt;"><td height="23" width="87" class="xl67" style="height:17.0pt;width:65pt;">-h</td> <td width="87" class="xl68" style="width:65pt;">打印帮助</td></tr> <tr height="57" style="height:43.0pt;"><td rowspan="4" height="160" width="191" class="xl69" style="border-bottom:1.0pt;height:120.0pt;border-top:none;width:143pt;">cleanExpiredCQ</td> <td rowspan="4" width="87" class="xl72" style="border-bottom:1.0pt;width:65pt;">清理Broker上过期的Consume Queue，如果手动减少对列数可能产生过期队列</td> <td width="87" class="xl67" style="width:65pt;">-n</td> <td width="87" class="xl68" style="width:65pt;">NameServer 服务地址，格式 ip:port</td></tr> <tr height="23" style="height:17.0pt;"><td height="23" width="87" class="xl67" style="height:17.0pt;width:65pt;">-h</td> <td width="87" class="xl68" style="width:65pt;">打印帮助</td></tr> <tr height="57" style="height:43.0pt;"><td height="57" width="87" class="xl67" style="height:43.0pt;width:65pt;">-b</td> <td width="87" class="xl68" style="width:65pt;">Broker 地址，地址为ip:port</td></tr> <tr height="23" style="height:17.0pt;"><td height="23" width="87" class="xl67" style="height:17.0pt;width:65pt;">-c</td> <td width="87" class="xl68" style="width:65pt;">集群名称</td></tr> <tr height="88" style="mso-height-source:userset;height:66.0pt;"><td rowspan="4" height="191" width="191" class="xl69" style="border-bottom:1.0pt;height:143.0pt;border-top:none;width:143pt;">cleanUnusedTopic</td> <td rowspan="4" width="87" class="xl72" style="border-bottom:1.0pt;width:65pt;">清理Broker上不使用的Topic，从内存中释放Topic的Consume
  Queue，如果手动删除Topic会产生不使用的Topic</td> <td width="87" class="xl67" style="width:65pt;">-n</td> <td width="87" class="xl68" style="width:65pt;">NameServer 服务地址，格式 ip:port</td></tr> <tr height="23" style="height:17.0pt;"><td height="23" width="87" class="xl67" style="height:17.0pt;width:65pt;">-h</td> <td width="87" class="xl68" style="width:65pt;">打印帮助</td></tr> <tr height="57" style="height:43.0pt;"><td height="57" width="87" class="xl67" style="height:43.0pt;width:65pt;">-b</td> <td width="87" class="xl68" style="width:65pt;">Broker 地址，地址为ip:port</td></tr> <tr height="23" style="height:17.0pt;"><td height="23" width="87" class="xl67" style="height:17.0pt;width:65pt;">-c</td> <td width="87" class="xl68" style="width:65pt;">集群名称</td></tr> <tr height="57" style="height:43.0pt;"><td rowspan="5" height="199" width="191" class="xl69" style="border-bottom:1.0pt;height:149.0pt;border-top:none;width:143pt;">sendMsgStatus</td> <td rowspan="5" width="87" class="xl72" style="border-bottom:1.0pt;width:65pt;">向Broker发消息，返回发送状态和RT</td> <td width="87" class="xl67" style="width:65pt;">-n</td> <td width="87" class="xl68" style="width:65pt;">NameServer 服务地址，格式 ip:port</td></tr> <tr height="23" style="height:17.0pt;"><td height="23" width="87" class="xl67" style="height:17.0pt;width:65pt;">-h</td> <td width="87" class="xl68" style="width:65pt;">打印帮助</td></tr> <tr height="57" style="height:43.0pt;"><td height="57" width="87" class="xl67" style="height:43.0pt;width:65pt;">-b</td> <td width="87" class="xl68" style="width:65pt;">BrokerName，注意不同于Broker地址</td></tr> <tr height="39" style="height:29.0pt;"><td height="39" width="87" class="xl67" style="height:29.0pt;width:65pt;">-s</td> <td width="87" class="xl68" style="width:65pt;">消息大小，单位B</td></tr> <tr height="23" style="height:17.0pt;"><td height="23" width="87" class="xl67" style="height:17.0pt;width:65pt;">-c</td> <td width="87" class="xl68" style="width:65pt;">发送次数</td></tr></table> <p>####4）消息相关</p> <table border="0" cellpadding="0" cellspacing="0" width="714"><col width="177"> <col width="175"> <col width="177"> <col width="185"> <tr height="23" style="height:17.0pt;"><td height="23" width="177" class="xl63" style="height:17.0pt;width:133pt;">名称</td> <td width="175" class="xl64" style="width:131pt;">含义</td> <td width="177" class="xl64" style="width:133pt;">命令选项</td> <td width="185" class="xl64" style="width:139pt;">说明</td></tr> <tr height="128" style="height:96.0pt;"><td rowspan="3" height="208" width="87" class="xl69" style="border-bottom:1.0pt;height:156.0pt;border-top:none;width:65pt;">queryMsgById</td> <td rowspan="3" width="87" class="xl72" style="border-bottom:1.0pt;border-top:none;width:65pt;">根据offsetMsgId查询msg，如果使用开源控制台，应使用offsetMsgId，此命令还有其他参数，具体作用请阅读QueryMsgByIdSubCommand。</td> <td width="87" class="xl67" style="width:65pt;">-i</td> <td width="87" class="xl67" style="width:65pt;">msgId</td></tr> <tr height="23" style="height:17.0pt;"><td height="23" width="87" class="xl67" style="height:17.0pt;width:65pt;">-h</td> <td width="87" class="xl68" style="width:65pt;">打印帮助</td></tr> <tr height="57" style="height:43.0pt;"><td height="57" width="87" class="xl67" style="height:43.0pt;width:65pt;">-n</td> <td width="87" class="xl68" style="width:65pt;">NameServer 服务地址，格式 ip:port</td></tr> <tr height="23" style="height:17.0pt;"><td rowspan="4" height="126" width="87" class="xl69" style="border-bottom:1.0pt;height:94.0pt;border-top:none;width:65pt;">queryMsgByKey</td> <td rowspan="4" width="87" class="xl72" style="border-bottom:1.0pt;border-top:none;width:65pt;">根据消息 Key 查询消息</td> <td width="87" class="xl67" style="width:65pt;">-k</td> <td width="87" class="xl67" style="width:65pt;">msgKey</td></tr> <tr height="23" style="height:17.0pt;"><td height="23" width="87" class="xl67" style="height:17.0pt;width:65pt;">-t</td> <td width="87" class="xl68" style="width:65pt;">Topic 名称</td></tr> <tr height="23" style="height:17.0pt;"><td height="23" width="87" class="xl67" style="height:17.0pt;width:65pt;">-h</td> <td width="87" class="xl68" style="width:65pt;">打印帮助</td></tr> <tr height="57" style="height:43.0pt;"><td height="57" width="87" class="xl67" style="height:43.0pt;width:65pt;">-n</td> <td width="87" class="xl68" style="width:65pt;">NameServer 服务地址，格式 ip:port</td></tr> <tr height="225" style="height:169.0pt;"><td rowspan="6" height="390" width="87" class="xl69" style="border-bottom:1.0pt;height:292.0pt;border-top:none;width:65pt;">queryMsgByOffset</td> <td rowspan="6" width="87" class="xl72" style="border-bottom:1.0pt;border-top:none;width:65pt;">根据 Offset 查询消息</td> <td width="87" class="xl67" style="width:65pt;">-b</td> <td width="87" class="xl68" style="width:65pt;">Broker 名称，（这里需要注意
  填写的是 Broker 的名称，不是 Broker 的地址，Broker 名称可以在 clusterList 查到）</td></tr> <tr height="39" style="height:29.0pt;"><td height="39" width="87" class="xl67" style="height:29.0pt;width:65pt;">-i</td> <td width="87" class="xl68" style="width:65pt;">query 队列 id</td></tr> <tr height="23" style="height:17.0pt;"><td height="23" width="87" class="xl67" style="height:17.0pt;width:65pt;">-o</td> <td width="87" class="xl68" style="width:65pt;">offset 值</td></tr> <tr height="23" style="height:17.0pt;"><td height="23" width="87" class="xl67" style="height:17.0pt;width:65pt;">-t</td> <td width="87" class="xl68" style="width:65pt;">topic 名称</td></tr> <tr height="23" style="height:17.0pt;"><td height="23" width="87" class="xl67" style="height:17.0pt;width:65pt;">-h</td> <td width="87" class="xl68" style="width:65pt;">打印帮助</td></tr> <tr height="57" style="height:43.0pt;"><td height="57" width="87" class="xl67" style="height:43.0pt;width:65pt;">-n</td> <td width="87" class="xl68" style="width:65pt;">NameServer 服务地址，格式 ip:port</td></tr> <tr height="47"><td rowspan="6" height="209" width="87" class="xl69" style="border-bottom:1.0pt;height:156.0pt;border-top:none;width:65pt;">queryMsgByUniqueKey</td> <td rowspan="6" width="87" class="xl72" style="border-bottom:1.0pt;border-top:none;width:65pt;">根据msgId查询，msgId不同于offsetMsgId，区别详见常见运维问题。-g，-d配合使用，查到消息后尝试让特定的消费者消费消息并返回消费结果</td> <td width="87" class="xl67" style="width:65pt;">-h</td> <td width="87" class="xl68" style="width:65pt;">打印帮助</td></tr> <tr height="57" style="height:43.0pt;"><td height="57" width="87" class="xl67" style="height:43.0pt;width:65pt;">-n</td> <td width="87" class="xl68" style="width:65pt;">NameServer 服务地址，格式 ip:port</td></tr> <tr height="23" style="height:17.0pt;"><td height="23" width="87" class="xl67" style="height:17.0pt;width:65pt;">-i</td> <td width="87" class="xl67" style="width:65pt;">uniqe msg id</td></tr> <tr height="36" style="height:27.0pt;"><td height="36" width="87" class="xl67" style="height:27.0pt;width:65pt;">-g</td> <td width="87" class="xl67" style="width:65pt;">consumerGroup</td></tr> <tr height="23" style="height:17.0pt;"><td height="23" width="87" class="xl67" style="height:17.0pt;width:65pt;">-d</td> <td width="87" class="xl67" style="width:65pt;">clientId</td></tr> <tr height="23" style="height:17.0pt;"><td height="23" width="87" class="xl67" style="height:17.0pt;width:65pt;">-t</td> <td width="87" class="xl68" style="width:65pt;">topic名称</td></tr> <tr height="23" style="height:17.0pt;"><td rowspan="5" height="149" width="87" class="xl69" style="border-bottom:1.0pt;border-top:none;width:65pt;">checkMsgSendRT</td> <td rowspan="5" width="87" class="xl72" style="border-bottom:1.0pt;border-top:none;width:65pt;">检测向topic发消息的RT，功能类似clusterRT</td> <td width="87" class="xl67" style="width:65pt;">-h</td> <td width="87" class="xl68" style="width:65pt;">打印帮助</td></tr> <tr height="57" style="height:43.0pt;"><td height="57" width="87" class="xl67" style="height:43.0pt;width:65pt;">-n</td> <td width="87" class="xl68" style="width:65pt;">NameServer 服务地址，格式 ip:port</td></tr> <tr height="23" style="height:17.0pt;"><td height="23" width="87" class="xl67" style="height:17.0pt;width:65pt;">-t</td> <td width="87" class="xl68" style="width:65pt;">topic名称</td></tr> <tr height="23" style="height:17.0pt;"><td height="23" width="87" class="xl67" style="height:17.0pt;width:65pt;">-a</td> <td width="87" class="xl68" style="width:65pt;">探测次数</td></tr> <tr height="23" style="height:17.0pt;"><td height="23" width="87" class="xl67" style="height:17.0pt;width:65pt;">-s</td> <td width="87" class="xl68" style="width:65pt;">消息大小</td></tr> <tr height="23" style="height:17.0pt;"><td rowspan="8" height="218" width="87" class="xl69" style="border-bottom:1.0pt;height:162.0pt;border-top:none;width:65pt;">sendMessage</td> <td rowspan="8" width="87" class="xl72" style="border-bottom:1.0pt;border-top:none;width:65pt;">发送一条消息，可以根据配置发往特定Message Queue，或普通发送。</td> <td width="87" class="xl67" style="width:65pt;">-h</td> <td width="87" class="xl68" style="width:65pt;">打印帮助</td></tr> <tr height="57" style="height:43.0pt;"><td height="57" width="87" class="xl67" style="height:43.0pt;width:65pt;">-n</td> <td width="87" class="xl68" style="width:65pt;">NameServer 服务地址，格式 ip:port</td></tr> <tr height="23" style="height:17.0pt;"><td height="23" width="87" class="xl67" style="height:17.0pt;width:65pt;">-t</td> <td width="87" class="xl68" style="width:65pt;">topic名称</td></tr> <tr height="23" style="height:17.0pt;"><td height="23" width="87" class="xl67" style="height:17.0pt;width:65pt;">-p</td> <td width="87" class="xl68" style="width:65pt;">body，消息体</td></tr> <tr height="23" style="height:17.0pt;"><td height="23" width="87" class="xl67" style="height:17.0pt;width:65pt;">-k</td> <td width="87" class="xl67" style="width:65pt;">keys</td></tr> <tr height="23" style="height:17.0pt;"><td height="23" width="87" class="xl67" style="height:17.0pt;width:65pt;">-c</td> <td width="87" class="xl67" style="width:65pt;">tags</td></tr> <tr height="23" style="height:17.0pt;"><td height="23" width="87" class="xl67" style="height:17.0pt;width:65pt;">-b</td> <td width="87" class="xl67" style="width:65pt;">BrokerName</td></tr> <tr height="23" style="height:17.0pt;"><td height="23" width="87" class="xl67" style="height:17.0pt;width:65pt;">-i</td> <td width="87" class="xl67" style="width:65pt;">queueId</td></tr> <tr height="23" style="height:17.0pt;"><td rowspan="10" height="312" width="87" class="xl69" style="border-bottom:1.0pt;height:232.0pt;border-top:none;width:65pt;">consumeMessage</td> <td rowspan="10" width="87" class="xl72" style="border-bottom:1.0pt;border-top:none;width:65pt;">消费消息。可以根据offset、开始&amp;结束时间戳、消息队列消费消息，配置不同执行不同消费逻辑，详见ConsumeMessageCommand。</td> <td width="87" class="xl67" style="width:65pt;">-h</td> <td width="87" class="xl68" style="width:65pt;">打印帮助</td></tr> <tr height="57" style="height:43.0pt;"><td height="57" width="87" class="xl67" style="height:43.0pt;width:65pt;">-n</td> <td width="87" class="xl68" style="width:65pt;">NameServer 服务地址，格式 ip:port</td></tr> <tr height="23" style="height:17.0pt;"><td height="23" width="87" class="xl67" style="height:17.0pt;width:65pt;">-t</td> <td width="87" class="xl68" style="width:65pt;">topic名称</td></tr> <tr height="23" style="height:17.0pt;"><td height="23" width="87" class="xl67" style="height:17.0pt;width:65pt;">-b</td> <td width="87" class="xl67" style="width:65pt;">BrokerName</td></tr> <tr height="39" style="height:29.0pt;"><td height="39" width="87" class="xl67" style="height:29.0pt;width:65pt;">-o</td> <td width="87" class="xl68" style="width:65pt;">从offset开始消费</td></tr> <tr height="23" style="height:17.0pt;"><td height="23" width="87" class="xl67" style="height:17.0pt;width:65pt;">-i</td> <td width="87" class="xl67" style="width:65pt;">queueId</td></tr> <tr height="23" style="height:17.0pt;"><td height="23" width="87" class="xl67" style="height:17.0pt;width:65pt;">-g</td> <td width="87" class="xl68" style="width:65pt;">消费者分组</td></tr> <tr height="39" style="height:29.0pt;"><td height="39" width="87" class="xl67" style="height:29.0pt;width:65pt;">-s</td> <td width="87" class="xl68" style="width:65pt;">开始时间戳，格式详见-h</td></tr> <tr height="23" style="height:17.0pt;"><td height="23" width="87" class="xl67" style="height:17.0pt;width:65pt;">-d</td> <td width="87" class="xl68" style="width:65pt;">结束时间戳</td></tr> <tr height="39" style="height:29.0pt;"><td height="39" width="87" class="xl67" style="height:29.0pt;width:65pt;">-c</td> <td width="87" class="xl68" style="width:65pt;">消费多少条消息</td></tr> <tr height="23" style="height:17.0pt;"><td rowspan="8" height="282" width="87" class="xl69" style="border-bottom:1.0pt;height:210.0pt;border-top:none;width:65pt;">printMsg</td> <td rowspan="8" width="87" class="xl72" style="border-bottom:1.0pt;border-top:none;width:65pt;">从Broker消费消息并打印，可选时间段</td> <td width="87" class="xl67" style="width:65pt;">-h</td> <td width="87" class="xl68" style="width:65pt;">打印帮助</td></tr> <tr height="57" style="height:43.0pt;"><td height="57" width="87" class="xl67" style="height:43.0pt;width:65pt;">-n</td> <td width="87" class="xl68" style="width:65pt;">NameServer 服务地址，格式 ip:port</td></tr> <tr height="23" style="height:17.0pt;"><td height="23" width="87" class="xl67" style="height:17.0pt;width:65pt;">-t</td> <td width="87" class="xl68" style="width:65pt;">topic名称</td></tr> <tr height="39" style="height:29.0pt;"><td height="39" width="87" class="xl67" style="height:29.0pt;width:65pt;">-c</td> <td width="87" class="xl68" style="width:65pt;">字符集，例如UTF-8</td></tr> <tr height="39" style="height:29.0pt;"><td height="39" width="87" class="xl67" style="height:29.0pt;width:65pt;">-s</td> <td width="87" class="xl68" style="width:65pt;">subExpress，过滤表达式</td></tr> <tr height="39" style="height:29.0pt;"><td height="39" width="87" class="xl67" style="height:29.0pt;width:65pt;">-b</td> <td width="87" class="xl68" style="width:65pt;">开始时间戳，格式参见-h</td></tr> <tr height="23" style="height:17.0pt;"><td height="23" width="87" class="xl67" style="height:17.0pt;width:65pt;">-e</td> <td width="87" class="xl68" style="width:65pt;">结束时间戳</td></tr> <tr height="39" style="height:29.0pt;"><td height="39" width="87" class="xl67" style="height:29.0pt;width:65pt;">-d</td> <td width="87" class="xl68" style="width:65pt;">是否打印消息体</td></tr> <tr height="23" style="height:17.0pt;"><td rowspan="12" height="390" width="87" class="xl69" style="border-bottom:1.0pt;height:290.0pt;border-top:none;width:65pt;">printMsgByQueue</td> <td rowspan="12" width="87" class="xl72" style="border-bottom:1.0pt;border-top:none;width:65pt;">类似printMsg，但指定Message Queue</td> <td width="87" class="xl67" style="width:65pt;">-h</td> <td width="87" class="xl68" style="width:65pt;">打印帮助</td></tr> <tr height="57" style="height:43.0pt;"><td height="57" width="87" class="xl67" style="height:43.0pt;width:65pt;">-n</td> <td width="87" class="xl68" style="width:65pt;">NameServer 服务地址，格式 ip:port</td></tr> <tr height="23" style="height:17.0pt;"><td height="23" width="87" class="xl67" style="height:17.0pt;width:65pt;">-t</td> <td width="87" class="xl68" style="width:65pt;">topic名称</td></tr> <tr height="23" style="height:17.0pt;"><td height="23" width="87" class="xl67" style="height:17.0pt;width:65pt;">-i</td> <td width="87" class="xl67" style="width:65pt;">queueId</td></tr> <tr height="23" style="height:17.0pt;"><td height="23" width="87" class="xl67" style="height:17.0pt;width:65pt;">-a</td> <td width="87" class="xl67" style="width:65pt;">BrokerName</td></tr> <tr height="39" style="height:29.0pt;"><td height="39" width="87" class="xl67" style="height:29.0pt;width:65pt;">-c</td> <td width="87" class="xl68" style="width:65pt;">字符集，例如UTF-8</td></tr> <tr height="39" style="height:29.0pt;"><td height="39" width="87" class="xl67" style="height:29.0pt;width:65pt;">-s</td> <td width="87" class="xl68" style="width:65pt;">subExpress，过滤表达式</td></tr> <tr height="39" style="height:29.0pt;"><td height="39" width="87" class="xl67" style="height:29.0pt;width:65pt;">-b</td> <td width="87" class="xl68" style="width:65pt;">开始时间戳，格式参见-h</td></tr> <tr height="23" style="height:17.0pt;"><td height="23" width="87" class="xl67" style="height:17.0pt;width:65pt;">-e</td> <td width="87" class="xl68" style="width:65pt;">结束时间戳</td></tr> <tr height="23" style="height:17.0pt;"><td height="23" width="87" class="xl67" style="height:17.0pt;width:65pt;">-p</td> <td width="87" class="xl68" style="width:65pt;">是否打印消息</td></tr> <tr height="39" style="height:29.0pt;"><td height="39" width="87" class="xl67" style="height:29.0pt;width:65pt;">-d</td> <td width="87" class="xl68" style="width:65pt;">是否打印消息体</td></tr> <tr height="39" style="height:29.0pt;"><td height="39" width="87" class="xl67" style="height:29.0pt;width:65pt;">-f</td> <td width="87" class="xl68" style="width:65pt;">是否统计tag数量并打印</td></tr> <tr height="23" style="height:17.0pt;"><td rowspan="7" height="410" width="87" class="xl69" style="border-bottom:1.0pt;height:307.0pt;border-top:none;width:65pt;">resetOffsetByTime</td> <td rowspan="7" width="87" class="xl72" style="border-bottom:1.0pt;border-top:none;width:65pt;">按时间戳重置offset，Broker和consumer都会重置</td> <td width="87" class="xl67" style="width:65pt;">-h</td> <td width="87" class="xl68" style="width:65pt;">打印帮助</td></tr> <tr height="57" style="height:43.0pt;"><td height="57" width="87" class="xl67" style="height:43.0pt;width:65pt;">-n</td> <td width="87" class="xl68" style="width:65pt;">NameServer 服务地址，格式 ip:port</td></tr> <tr height="23" style="height:17.0pt;"><td height="23" width="87" class="xl67" style="height:17.0pt;width:65pt;">-g</td> <td width="87" class="xl68" style="width:65pt;">消费者分组</td></tr> <tr height="23" style="height:17.0pt;"><td height="23" width="87" class="xl67" style="height:17.0pt;width:65pt;">-t</td> <td width="87" class="xl68" style="width:65pt;">topic名称</td></tr> <tr height="57" style="height:43.0pt;"><td height="57" width="87" class="xl67" style="height:43.0pt;width:65pt;">-s</td> <td width="87" class="xl68" style="width:65pt;">重置为此时间戳对应的offset</td></tr> <tr height="188" style="height:141.0pt;"><td height="188" width="87" class="xl67" style="height:141.0pt;width:65pt;">-f</td> <td width="87" class="xl68" style="width:65pt;">是否强制重置，如果false，只支持回溯offset，如果true，不管时间戳对应offset与consumeOffset关系</td></tr> <tr height="39" style="height:29.0pt;"><td height="39" width="87" class="xl67" style="height:29.0pt;width:65pt;">-c</td> <td width="87" class="xl68" style="width:65pt;">是否重置c++客户端offset</td></tr></table> <h4 id="_5-消费者、消费组相关"><a href="#_5-消费者、消费组相关" class="header-anchor">#</a> 5）消费者、消费组相关</h4> <table border="0" cellpadding="0" cellspacing="0" width="714"><col width="177"> <col width="175"> <col width="177"> <col width="185"> <tr height="23" style="height:17.0pt;"><td height="23" width="177" class="xl63" style="height:17.0pt;width:133pt;">名称</td> <td width="175" class="xl64" style="width:131pt;">含义</td> <td width="177" class="xl64" style="width:133pt;">命令选项</td> <td width="185" class="xl64" style="width:139pt;">说明</td></tr> <tr height="39" style="height:29.0pt;"><td rowspan="4" height="158" width="87" class="xl69" style="border-bottom:1.0pt;height:110pt;border-top:none;width:65pt;">consumerProgress</td> <td rowspan="4" width="87" class="xl72" style="border-bottom:1.0pt;border-top:none;width:65pt;">查看订阅组消费状态，可以查看具体的client IP的消息积累量</td> <td width="87" class="xl67" style="width:65pt;">-g</td> <td width="87" class="xl68" style="width:65pt;">消费者所属组名</td></tr> <tr height="39" style="height:29.0pt;"><td height="39" width="87" class="xl67" style="height:29.0pt;width:65pt;">-s</td> <td width="87" class="xl68" style="width:65pt;">是否打印client IP</td></tr> <tr height="23" style="height:17.0pt;"><td height="23" width="87" class="xl67" style="height:17.0pt;width:65pt;">-h</td> <td width="87" class="xl68" style="width:65pt;">打印帮助</td></tr> <tr height="57" style="height:43.0pt;"><td height="57" width="87" class="xl67" style="height:43.0pt;width:65pt;">-n</td> <td width="87" class="xl68" style="width:65pt;">NameServer 服务地址，格式 ip:port</td></tr> <tr height="105" style="mso-height-source:userset;height:79.0pt;"><td rowspan="5" height="260" width="87" class="xl69" style="border-bottom:1.0pt;height:195.0pt;border-top:none;width:65pt;">consumerStatus</td> <td rowspan="5" width="87" class="xl72" style="border-bottom:1.0pt;width:65pt;">查看消费者状态，包括同一个分组中是否都是相同的订阅，分析Process
  Queue是否堆积，返回消费者jstack结果，内容较多，使用者参见ConsumerStatusSubCommand</td> <td width="87" class="xl67" style="width:65pt;">-h</td> <td width="87" class="xl68" style="width:65pt;">打印帮助</td></tr> <tr height="57" style="height:43.0pt;"><td height="57" width="87" class="xl67" style="height:43.0pt;width:65pt;">-n</td> <td width="87" class="xl68" style="width:65pt;">NameServer 服务地址，格式 ip:port</td></tr> <tr height="36" style="height:27.0pt;"><td height="36" width="87" class="xl67" style="height:27.0pt;width:65pt;">-g</td> <td width="87" class="xl67" style="width:65pt;">consumer group</td></tr> <tr height="23" style="height:17.0pt;"><td height="23" width="87" class="xl67" style="height:17.0pt;width:65pt;">-i</td> <td width="87" class="xl67" style="width:65pt;">clientId</td></tr> <tr height="39" style="height:29.0pt;"><td height="39" width="87" class="xl67" style="height:29.0pt;width:65pt;">-s</td> <td width="87" class="xl68" style="width:65pt;">是否执行jstack</td></tr> <tr height="39" style="height:29.0pt;"><td rowspan="5" height="181" width="87" class="xl69" style="border-bottom:1.0pt;border-top:none;width:65pt;">getConsumerStatus</td> <td rowspan="5" width="87" class="xl72" style="border-bottom:1.0pt;width:65pt;">获取 Consumer 消费进度</td> <td width="87" class="xl67" style="width:65pt;">-g</td> <td width="87" class="xl68" style="width:65pt;">消费者所属组名</td></tr> <tr height="23" style="height:17.0pt;"><td height="23" width="87" class="xl67" style="height:17.0pt;width:65pt;">-t</td> <td width="87" class="xl68" style="width:65pt;">查询主题</td></tr> <tr height="39" style="height:29.0pt;"><td height="39" width="87" class="xl67" style="height:29.0pt;width:65pt;">-i</td> <td width="87" class="xl68" style="width:65pt;">Consumer 客户端 ip</td></tr> <tr height="57" style="height:43.0pt;"><td height="57" width="87" class="xl67" style="height:43.0pt;width:65pt;">-n</td> <td width="87" class="xl68" style="width:65pt;">NameServer 服务地址，格式 ip:port</td></tr> <tr height="23" style="height:17.0pt;"><td height="23" width="87" class="xl67" style="height:17.0pt;width:65pt;">-h</td> <td width="87" class="xl68" style="width:65pt;">打印帮助</td></tr> <tr height="57" style="height:43.0pt;"><td rowspan="13" height="761" width="87" class="xl69" style="border-bottom:1.0pt;border-top:none;width:65pt;">updateSubGroup</td> <td rowspan="13" width="87" class="xl72" style="border-bottom:1.0pt;width:65pt;">更新或创建订阅关系</td> <td width="87" class="xl67" style="width:65pt;">-n</td> <td width="87" class="xl68" style="width:65pt;">NameServer 服务地址，格式 ip:port</td></tr> <tr height="23" style="height:17.0pt;"><td height="23" width="87" class="xl67" style="height:17.0pt;width:65pt;">-h</td> <td width="87" class="xl68" style="width:65pt;">打印帮助</td></tr> <tr height="23" style="height:17.0pt;"><td height="23" width="87" class="xl67" style="height:17.0pt;width:65pt;">-b</td> <td width="87" class="xl68" style="width:65pt;">Broker地址</td></tr> <tr height="23" style="height:17.0pt;"><td height="23" width="87" class="xl67" style="height:17.0pt;width:65pt;">-c</td> <td width="87" class="xl68" style="width:65pt;">集群名称</td></tr> <tr height="39" style="height:29.0pt;"><td height="39" width="87" class="xl67" style="height:29.0pt;width:65pt;">-g</td> <td width="87" class="xl68" style="width:65pt;">消费者分组名称</td></tr> <tr height="39" style="height:29.0pt;"><td height="39" width="87" class="xl67" style="height:29.0pt;width:65pt;">-s</td> <td width="87" class="xl68" style="width:65pt;">分组是否允许消费</td></tr> <tr height="57" style="height:43.0pt;"><td height="57" width="87" class="xl67" style="height:43.0pt;width:65pt;">-m</td> <td width="87" class="xl68" style="width:65pt;">是否从最小offset开始消费</td></tr> <tr height="39" style="height:29.0pt;"><td height="39" width="87" class="xl67" style="height:29.0pt;width:65pt;">-d</td> <td width="87" class="xl68" style="width:65pt;">是否是广播模式</td></tr> <tr height="23" style="height:17.0pt;"><td height="23" width="87" class="xl67" style="height:17.0pt;width:65pt;">-q</td> <td width="87" class="xl68" style="width:65pt;">重试队列数量</td></tr> <tr height="23" style="height:17.0pt;"><td height="23" width="87" class="xl67" style="height:17.0pt;width:65pt;">-r</td> <td width="87" class="xl68" style="width:65pt;">最大重试次数</td></tr> <tr height="207" style="height:155.0pt;"><td height="207" width="87" class="xl67" style="height:155.0pt;width:65pt;">-i</td> <td width="87" class="xl68" style="width:65pt;">当slaveReadEnable开启时有效，且还未达到从slave消费时建议从哪个BrokerId消费，可以配置备机id，主动从备机消费</td></tr> <tr height="132" style="height:99.0pt;"><td height="132" width="87" class="xl67" style="height:99.0pt;width:65pt;">-w</td> <td width="87" class="xl68" style="width:65pt;">如果Broker建议从slave消费，配置决定从哪个slave消费，配置BrokerId，例如1</td></tr> <tr height="76" style="height:57.0pt;"><td height="76" width="87" class="xl67" style="height:57.0pt;width:65pt;">-a</td> <td width="87" class="xl68" style="width:65pt;">当消费者数量变化时是否通知其他消费者负载均衡</td></tr> <tr height="57" style="height:43.0pt;"><td rowspan="5" height="165" width="87" class="xl69" style="border-bottom:1.0pt;border-top:none;width:65pt;">deleteSubGroup</td> <td rowspan="5" width="87" class="xl72" style="border-bottom:1.0pt;width:65pt;">从Broker删除订阅关系</td> <td width="87" class="xl67" style="width:65pt;">-n</td> <td width="87" class="xl68" style="width:65pt;">NameServer 服务地址，格式 ip:port</td></tr> <tr height="23" style="height:17.0pt;"><td height="23" width="87" class="xl67" style="height:17.0pt;width:65pt;">-h</td> <td width="87" class="xl68" style="width:65pt;">打印帮助</td></tr> <tr height="23" style="height:17.0pt;"><td height="23" width="87" class="xl67" style="height:17.0pt;width:65pt;">-b</td> <td width="87" class="xl68" style="width:65pt;">Broker地址</td></tr> <tr height="23" style="height:17.0pt;"><td height="23" width="87" class="xl67" style="height:17.0pt;width:65pt;">-c</td> <td width="87" class="xl68" style="width:65pt;">集群名称</td></tr> <tr height="39" style="height:29.0pt;"><td height="39" width="87" class="xl67" style="height:29.0pt;width:65pt;">-g</td> <td width="87" class="xl68" style="width:65pt;">消费者分组名称</td></tr> <tr height="57" style="height:43.0pt;"><td rowspan="6" height="172" width="87" class="xl69" style="border-bottom:1.0pt;border-top:none;width:65pt;">cloneGroupOffset</td> <td rowspan="6" width="87" class="xl72" style="border-bottom:1.0pt;width:65pt;">在目标群组中使用源群组的offset</td> <td width="87" class="xl67" style="width:65pt;">-n</td> <td width="87" class="xl68" style="width:65pt;">NameServer 服务地址，格式 ip:port</td></tr> <tr height="23" style="height:17.0pt;"><td height="23" width="87" class="xl67" style="height:17.0pt;width:65pt;">-h</td> <td width="87" class="xl68" style="width:65pt;">打印帮助</td></tr> <tr height="23" style="height:17.0pt;"><td height="23" width="87" class="xl67" style="height:17.0pt;width:65pt;">-s</td> <td width="87" class="xl68" style="width:65pt;">源消费者组</td></tr> <tr height="23" style="height:17.0pt;"><td height="23" width="87" class="xl67" style="height:17.0pt;width:65pt;">-d</td> <td width="87" class="xl68" style="width:65pt;">目标消费者组</td></tr> <tr height="23" style="height:17.0pt;"><td height="23" width="87" class="xl67" style="height:17.0pt;width:65pt;">-t</td> <td width="87" class="xl68" style="width:65pt;">topic名称</td></tr> <tr height="23" style="height:17.0pt;"><td height="23" width="87" class="xl67" style="height:17.0pt;width:65pt;">-o</td> <td width="87" class="xl68" style="width:65pt;">暂未使用</td></tr></table> <h4 id="_6-连接相关"><a href="#_6-连接相关" class="header-anchor">#</a> 6）连接相关</h4> <table border="0" cellpadding="0" cellspacing="0" width="714"><col width="177"> <col width="175"> <col width="177"> <col width="185"> <tr height="23" style="height:17.0pt;"><td height="23" width="177" class="xl63" style="height:17.0pt;width:133pt;">名称</td> <td width="175" class="xl64" style="width:131pt;">含义</td> <td width="177" class="xl64" style="width:133pt;">命令选项</td> <td width="185" class="xl64" style="width:139pt;">说明</td></tr> <tr height="39" style="height:29.0pt;"><td rowspan="3" height="119" width="87" class="xl69" style="border-bottom:1.0pt;border-top:none;width:65pt;">consumerConnec tion</td> <td rowspan="3" width="87" class="xl72" style="border-bottom:1.0pt;width:65pt;">查询 Consumer 的网络连接</td> <td width="87" class="xl67" style="width:65pt;">-g</td> <td width="87" class="xl68" style="width:65pt;">消费者所属组名</td></tr> <tr height="57" style="height:43.0pt;"><td height="57" width="87" class="xl67" style="height:43.0pt;width:65pt;">-n</td> <td width="87" class="xl68" style="width:65pt;">NameServer 服务地址，格式 ip:port</td></tr> <tr height="23" style="height:17.0pt;"><td height="23" width="87" class="xl67" style="height:17.0pt;width:65pt;">-h</td> <td width="87" class="xl68" style="width:65pt;">打印帮助</td></tr> <tr height="39" style="height:29.0pt;"><td rowspan="4" height="142" width="87" class="xl69" style="border-bottom:1.0pt;border-top:none;width:65pt;">producerConnec tion</td> <td rowspan="4" width="87" class="xl72" style="border-bottom:1.0pt;width:65pt;">查询 Producer 的网络连接</td> <td width="87" class="xl67" style="width:65pt;">-g</td> <td width="87" class="xl68" style="width:65pt;">生产者所属组名</td></tr> <tr height="23" style="height:17.0pt;"><td height="23" width="87" class="xl67" style="height:17.0pt;width:65pt;">-t</td> <td width="87" class="xl68" style="width:65pt;">主题名称</td></tr> <tr height="57" style="height:43.0pt;"><td height="57" width="87" class="xl67" style="height:43.0pt;width:65pt;">-n</td> <td width="87" class="xl68" style="width:65pt;">NameServer 服务地址，格式 ip:port</td></tr> <tr height="23" style="height:17.0pt;"><td height="23" width="87" class="xl67" style="height:17.0pt;width:65pt;">-h</td> <td width="87" class="xl68" style="width:65pt;">打印帮助</td></tr></table> <h4 id="_7-nameserver相关"><a href="#_7-nameserver相关" class="header-anchor">#</a> 7）NameServer相关</h4> <table border="0" cellpadding="0" cellspacing="0" width="714"><col width="177"> <col width="175"> <col width="177"> <col width="185"> <tr height="23" style="height:17.0pt;"><td height="23" width="177" class="xl63" style="height:17.0pt;width:133pt;">名称</td> <td width="175" class="xl64" style="width:131pt;">含义</td> <td width="177" class="xl64" style="width:133pt;">命令选项</td> <td width="185" class="xl64" style="width:139pt;">说明</td></tr> <tr height="21" style="height:16.0pt;"><td rowspan="5" height="143" width="87" class="xl69" style="border-bottom:1.0pt;border-top:none;width:65pt;">updateKvConfig</td> <td rowspan="5" width="87" class="xl72" style="border-bottom:1.0pt;width:65pt;">更新NameServer的kv配置，目前还未使用</td> <td width="87" class="xl75" style="width:65pt;">-s</td> <td width="87" class="xl76" style="width:65pt;">命名空间</td></tr> <tr height="21" style="height:16.0pt;"><td height="21" width="87" class="xl75" style="height:16.0pt;width:65pt;">-k</td> <td width="87" class="xl75" style="width:65pt;">key</td></tr> <tr height="21" style="height:16.0pt;"><td height="21" width="87" class="xl75" style="height:16.0pt;width:65pt;">-v</td> <td width="87" class="xl75" style="width:65pt;">value</td></tr> <tr height="57" style="height:43.0pt;"><td height="57" width="87" class="xl67" style="height:43.0pt;width:65pt;">-n</td> <td width="87" class="xl68" style="width:65pt;">NameServer 服务地址，格式 ip:port</td></tr> <tr height="23" style="height:17.0pt;"><td height="23" width="87" class="xl67" style="height:17.0pt;width:65pt;">-h</td> <td width="87" class="xl68" style="width:65pt;">打印帮助</td></tr> <tr height="23" style="height:17.0pt;"><td rowspan="4" height="126" width="87" class="xl69" style="border-bottom:1.0pt;border-top:none;width:65pt;">deleteKvConfig</td> <td rowspan="4" width="87" class="xl72" style="border-bottom:1.0pt;width:65pt;">删除NameServer的kv配置</td> <td width="87" class="xl67" style="width:65pt;">-s</td> <td width="87" class="xl68" style="width:65pt;">命名空间</td></tr> <tr height="23" style="height:17.0pt;"><td height="23" width="87" class="xl67" style="height:17.0pt;width:65pt;">-k</td> <td width="87" class="xl67" style="width:65pt;">key</td></tr> <tr height="57" style="height:43.0pt;"><td height="57" width="87" class="xl67" style="height:43.0pt;width:65pt;">-n</td> <td width="87" class="xl68" style="width:65pt;">NameServer 服务地址，格式 ip:port</td></tr> <tr height="23" style="height:17.0pt;"><td height="23" width="87" class="xl67" style="height:17.0pt;width:65pt;">-h</td> <td width="87" class="xl68" style="width:65pt;">打印帮助</td></tr> <tr height="57" style="height:43.0pt;"><td rowspan="2" height="80" width="87" class="xl69" style="border-bottom:1.0pt;border-top:none;width:65pt;">getNamesrvConfig</td> <td rowspan="2" width="87" class="xl72" style="border-bottom:1.0pt;width:65pt;">获取NameServer配置</td> <td width="87" class="xl67" style="width:65pt;">-n</td> <td width="87" class="xl68" style="width:65pt;">NameServer 服务地址，格式 ip:port</td></tr> <tr height="23" style="height:17.0pt;"><td height="23" width="87" class="xl67" style="height:17.0pt;width:65pt;">-h</td> <td width="87" class="xl68" style="width:65pt;">打印帮助</td></tr> <tr height="57" style="height:43.0pt;"><td rowspan="4" height="126" width="87" class="xl69" style="border-bottom:1.0pt;border-top:none;width:65pt;">updateNamesrvConfig</td> <td rowspan="4" width="87" class="xl72" style="border-bottom:1.0pt;width:65pt;">修改NameServer配置</td> <td width="87" class="xl67" style="width:65pt;">-n</td> <td width="87" class="xl68" style="width:65pt;">NameServer 服务地址，格式 ip:port</td></tr> <tr height="23" style="height:17.0pt;"><td height="23" width="87" class="xl67" style="height:17.0pt;width:65pt;">-h</td> <td width="87" class="xl68" style="width:65pt;">打印帮助</td></tr> <tr height="23" style="height:17.0pt;"><td height="23" width="87" class="xl67" style="height:17.0pt;width:65pt;">-k</td> <td width="87" class="xl67" style="width:65pt;">key</td></tr> <tr height="23" style="height:17.0pt;"><td height="23" width="87" class="xl67" style="height:17.0pt;width:65pt;">-v</td> <td width="87" class="xl67" style="width:65pt;">value</td></tr></table> <h4 id="_8-其他"><a href="#_8-其他" class="header-anchor">#</a> 8）其他</h4> <table border="0" cellpadding="0" cellspacing="0" width="714"><col width="177"> <col width="175"> <col width="177"> <col width="185"> <tr height="23" style="height:17.0pt;"><td height="23" width="177" class="xl63" style="height:17.0pt;width:133pt;">名称</td> <td width="175" class="xl64" style="width:131pt;">含义</td> <td width="177" class="xl64" style="width:133pt;">命令选项</td> <td width="185" class="xl64" style="width:139pt;">说明</td></tr> <tr height="57" style="height:43.0pt;"><td rowspan="2" height="80" width="87" class="xl69" style="border-bottom:1.0pt;border-top:none;width:65pt;">startMonitoring</td> <td rowspan="2" width="87" class="xl71" style="border-bottom:1.0pt;width:65pt;">开启监控进程，监控消息误删、重试队列消息数等</td> <td width="87" class="xl67" style="width:65pt;">-n</td> <td width="87" class="xl68" style="width:65pt;">NameServer 服务地址，格式 ip:port</td></tr> <tr height="23" style="height:17.0pt;"><td height="23" width="87" class="xl67" style="height:17.0pt;width:65pt;">-h</td> <td width="87" class="xl68" style="width:65pt;">打印帮助</td></tr></table> <h3 id="_3-4-3-注意事项"><a href="#_3-4-3-注意事项" class="header-anchor">#</a> 3.4.3 注意事项</h3> <ul><li>几乎所有命令都需要配置-n表示NameServer地址，格式为ip:port</li> <li>几乎所有命令都可以通过-h获取帮助</li> <li>如果既有Broker地址（-b）配置项又有clusterName（-c）配置项，则优先以Broker地址执行命令；如果不配置Broker地址，则对集群中所有主机执行命令</li></ul> <h2 id="_3-5-集群监控平台搭建"><a href="#_3-5-集群监控平台搭建" class="header-anchor">#</a> 3.5 集群监控平台搭建</h2> <h3 id="_3-5-1-概述"><a href="#_3-5-1-概述" class="header-anchor">#</a> 3.5.1 概述</h3> <p><code>RocketMQ</code>有一个对其扩展的开源项目<a href="https://github.com/apache/rocketmq-externals" target="_blank" rel="noopener noreferrer">incubator-rocketmq-externals<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，这个项目中有一个子模块叫<code>rocketmq-console</code>，这个便是管理控制台项目了，先将<a href="https://github.com/apache/rocketmq-externals" target="_blank" rel="noopener noreferrer">incubator-rocketmq-externals<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>拉到本地，因为我们需要自己对<code>rocketmq-console</code>进行编译打包运行。</p> <p><img src="/assets/img/rocketmq-console.5d733dfc.png" alt=""></p> <h3 id="_3-5-2-下载并编译打包"><a href="#_3-5-2-下载并编译打包" class="header-anchor">#</a> 3.5.2 下载并编译打包</h3> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">git</span> clone https://github.com/apache/rocketmq-externals
<span class="token builtin class-name">cd</span> rocketmq-console
mvn clean package <span class="token parameter variable">-Dmaven.test.skip</span><span class="token operator">=</span>true
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>注意：打包前在<code>rocketmq-console</code>中配置<code>namesrv</code>集群地址：</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token assign-left variable">rocketmq.config.namesrvAddr</span><span class="token operator">=</span><span class="token number">192.168</span>.25.135:9876<span class="token punctuation">;</span><span class="token number">192.168</span>.25.138:9876
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>启动rocketmq-console：</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">java</span> <span class="token parameter variable">-jar</span> rocketmq-console.jar
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>启动成功后，我们就可以通过浏览器访问<code>http://localhost:8080</code>进入控制台界面了，如下图：</p> <p><img src="/assets/img/rocketmq-console2.e229f44a.png" alt=""></p> <p>集群状态：</p> <p><img src="/assets/img/rocketmq-console3.eec734bf.png" alt=""></p> <h1 id="_4-消息发送样例"><a href="#_4-消息发送样例" class="header-anchor">#</a> 4. 消息发送样例</h1> <ul><li>导入MQ客户端依赖</li></ul> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.rocketmq<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>rocketmq-client<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>4.4.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ul><li>消息发送者步骤分析r</li></ul> <div class="language-tex line-numbers-mode"><pre class="language-tex"><code>1.创建消息生产者producer，并制定生产者组名
2.指定Nameserver地址
3.启动producer
4.创建消息对象，指定主题Topic、Tag和消息体
5.发送消息
6.关闭生产者producer
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ul><li>消息消费者步骤分析</li></ul> <div class="language-tex line-numbers-mode"><pre class="language-tex"><code>1.创建消费者Consumer，制定消费者组名
2.指定Nameserver地址
3.订阅主题Topic和Tag
4.设置回调函数，处理消息
5.启动消费者consumer
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="_4-1-基本样例"><a href="#_4-1-基本样例" class="header-anchor">#</a> 4.1 基本样例</h2> <h3 id="_4-1-1-消息发送"><a href="#_4-1-1-消息发送" class="header-anchor">#</a> 4.1.1 消息发送</h3> <h4 id="_1-发送同步消息"><a href="#_1-发送同步消息" class="header-anchor">#</a> 1）发送同步消息</h4> <p>这种可靠性同步地发送方式使用的比较广泛，比如：重要的消息通知，短信通知。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SyncProducer</span> <span class="token punctuation">{</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    	<span class="token comment">// 实例化消息生产者Producer</span>
        <span class="token class-name">DefaultMQProducer</span> producer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultMQProducer</span><span class="token punctuation">(</span><span class="token string">&quot;please_rename_unique_group_name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    	<span class="token comment">// 设置NameServer的地址</span>
    	producer<span class="token punctuation">.</span><span class="token function">setNamesrvAddr</span><span class="token punctuation">(</span><span class="token string">&quot;localhost:9876&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    	<span class="token comment">// 启动Producer实例</span>
        producer<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    	    <span class="token comment">// 创建消息，并指定Topic，Tag和消息体</span>
    	    <span class="token class-name">Message</span> msg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Message</span><span class="token punctuation">(</span><span class="token string">&quot;TopicTest&quot;</span> <span class="token comment">/* Topic */</span><span class="token punctuation">,</span>
        	<span class="token string">&quot;TagA&quot;</span> <span class="token comment">/* Tag */</span><span class="token punctuation">,</span>
        	<span class="token punctuation">(</span><span class="token string">&quot;Hello RocketMQ &quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token class-name">RemotingHelper</span><span class="token punctuation">.</span><span class="token constant">DEFAULT_CHARSET</span><span class="token punctuation">)</span> <span class="token comment">/* Message body */</span>
        	<span class="token punctuation">)</span><span class="token punctuation">;</span>
        	<span class="token comment">// 发送消息到一个Broker</span>
            <span class="token class-name">SendResult</span> sendResult <span class="token operator">=</span> producer<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 通过sendResult返回消息是否成功送达</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%s%n&quot;</span><span class="token punctuation">,</span> sendResult<span class="token punctuation">)</span><span class="token punctuation">;</span>
    	<span class="token punctuation">}</span>
    	<span class="token comment">// 如果不再发送消息，关闭Producer实例。</span>
    	producer<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><h4 id="_2-发送异步消息"><a href="#_2-发送异步消息" class="header-anchor">#</a> 2）发送异步消息</h4> <p>异步消息通常用在对响应时间敏感的业务场景，即发送端不能容忍长时间地等待Broker的响应。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AsyncProducer</span> <span class="token punctuation">{</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    	<span class="token comment">// 实例化消息生产者Producer</span>
        <span class="token class-name">DefaultMQProducer</span> producer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultMQProducer</span><span class="token punctuation">(</span><span class="token string">&quot;please_rename_unique_group_name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    	<span class="token comment">// 设置NameServer的地址</span>
        producer<span class="token punctuation">.</span><span class="token function">setNamesrvAddr</span><span class="token punctuation">(</span><span class="token string">&quot;localhost:9876&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    	<span class="token comment">// 启动Producer实例</span>
        producer<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        producer<span class="token punctuation">.</span><span class="token function">setRetryTimesWhenSendAsyncFailed</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">final</span> <span class="token keyword">int</span> index <span class="token operator">=</span> i<span class="token punctuation">;</span>
            	<span class="token comment">// 创建消息，并指定Topic，Tag和消息体</span>
                <span class="token class-name">Message</span> msg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Message</span><span class="token punctuation">(</span><span class="token string">&quot;TopicTest&quot;</span><span class="token punctuation">,</span>
                    <span class="token string">&quot;TagA&quot;</span><span class="token punctuation">,</span>
                    <span class="token string">&quot;OrderID188&quot;</span><span class="token punctuation">,</span>
                    <span class="token string">&quot;Hello world&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token class-name">RemotingHelper</span><span class="token punctuation">.</span><span class="token constant">DEFAULT_CHARSET</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// SendCallback接收异步返回结果的回调</span>
                producer<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>msg<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">SendCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token annotation punctuation">@Override</span>
                    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onSuccess</span><span class="token punctuation">(</span><span class="token class-name">SendResult</span> sendResult<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%-10d OK %s %n&quot;</span><span class="token punctuation">,</span> index<span class="token punctuation">,</span>
                            sendResult<span class="token punctuation">.</span><span class="token function">getMsgId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    <span class="token annotation punctuation">@Override</span>
                    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onException</span><span class="token punctuation">(</span><span class="token class-name">Throwable</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      	              <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%-10d Exception %s %n&quot;</span><span class="token punctuation">,</span> index<span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
      	              e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
            	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    	<span class="token punctuation">}</span>
    	<span class="token comment">// 如果不再发送消息，关闭Producer实例。</span>
    	producer<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><h4 id="_3-单向发送消息"><a href="#_3-单向发送消息" class="header-anchor">#</a> 3）单向发送消息</h4> <p>这种方式主要用在不特别关心发送结果的场景，例如日志发送。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OnewayProducer</span> <span class="token punctuation">{</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">{</span>
    	<span class="token comment">// 实例化消息生产者Producer</span>
        <span class="token class-name">DefaultMQProducer</span> producer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultMQProducer</span><span class="token punctuation">(</span><span class="token string">&quot;please_rename_unique_group_name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    	<span class="token comment">// 设置NameServer的地址</span>
        producer<span class="token punctuation">.</span><span class="token function">setNamesrvAddr</span><span class="token punctuation">(</span><span class="token string">&quot;localhost:9876&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    	<span class="token comment">// 启动Producer实例</span>
        producer<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        	<span class="token comment">// 创建消息，并指定Topic，Tag和消息体</span>
        	<span class="token class-name">Message</span> msg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Message</span><span class="token punctuation">(</span><span class="token string">&quot;TopicTest&quot;</span> <span class="token comment">/* Topic */</span><span class="token punctuation">,</span>
                <span class="token string">&quot;TagA&quot;</span> <span class="token comment">/* Tag */</span><span class="token punctuation">,</span>
                <span class="token punctuation">(</span><span class="token string">&quot;Hello RocketMQ &quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token class-name">RemotingHelper</span><span class="token punctuation">.</span><span class="token constant">DEFAULT_CHARSET</span><span class="token punctuation">)</span> <span class="token comment">/* Message body */</span>
        	<span class="token punctuation">)</span><span class="token punctuation">;</span>
        	<span class="token comment">// 发送单向消息，没有任何返回结果</span>
        	producer<span class="token punctuation">.</span><span class="token function">sendOneway</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>

    	<span class="token punctuation">}</span>
    	<span class="token comment">// 如果不再发送消息，关闭Producer实例。</span>
    	producer<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><h3 id="_4-1-2-消费消息"><a href="#_4-1-2-消费消息" class="header-anchor">#</a> 4.1.2 消费消息</h3> <h4 id="_1-负载均衡模式"><a href="#_1-负载均衡模式" class="header-anchor">#</a> 1）负载均衡模式</h4> <p>消费者采用负载均衡方式消费消息，多个消费者共同消费队列消息，每个消费者处理的消息不同</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    <span class="token comment">// 实例化消息生产者,指定组名</span>
    <span class="token class-name">DefaultMQPushConsumer</span> consumer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultMQPushConsumer</span><span class="token punctuation">(</span><span class="token string">&quot;group1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 指定Namesrv地址信息.</span>
    consumer<span class="token punctuation">.</span><span class="token function">setNamesrvAddr</span><span class="token punctuation">(</span><span class="token string">&quot;localhost:9876&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 订阅Topic</span>
    consumer<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token string">&quot;Test&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//负载均衡模式消费</span>
    consumer<span class="token punctuation">.</span><span class="token function">setMessageModel</span><span class="token punctuation">(</span><span class="token class-name">MessageModel</span><span class="token punctuation">.</span><span class="token constant">CLUSTERING</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 注册回调函数，处理消息</span>
    consumer<span class="token punctuation">.</span><span class="token function">registerMessageListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MessageListenerConcurrently</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token class-name">ConsumeConcurrentlyStatus</span> <span class="token function">consumeMessage</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MessageExt</span><span class="token punctuation">&gt;</span></span> msgs<span class="token punctuation">,</span>
                                                        <span class="token class-name">ConsumeConcurrentlyContext</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%s Receive New Messages: %s %n&quot;</span><span class="token punctuation">,</span> 
                              <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> msgs<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token class-name">ConsumeConcurrentlyStatus</span><span class="token punctuation">.</span><span class="token constant">CONSUME_SUCCESS</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//启动消息者</span>
    consumer<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;Consumer Started.%n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><h4 id="_2-广播模式"><a href="#_2-广播模式" class="header-anchor">#</a> 2）广播模式</h4> <p>消费者采用广播的方式消费消息，每个消费者消费的消息都是相同的</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    <span class="token comment">// 实例化消息生产者,指定组名</span>
    <span class="token class-name">DefaultMQPushConsumer</span> consumer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultMQPushConsumer</span><span class="token punctuation">(</span><span class="token string">&quot;group1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 指定Namesrv地址信息.</span>
    consumer<span class="token punctuation">.</span><span class="token function">setNamesrvAddr</span><span class="token punctuation">(</span><span class="token string">&quot;localhost:9876&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 订阅Topic</span>
    consumer<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token string">&quot;Test&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//广播模式消费</span>
    consumer<span class="token punctuation">.</span><span class="token function">setMessageModel</span><span class="token punctuation">(</span><span class="token class-name">MessageModel</span><span class="token punctuation">.</span><span class="token constant">BROADCASTING</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 注册回调函数，处理消息</span>
    consumer<span class="token punctuation">.</span><span class="token function">registerMessageListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MessageListenerConcurrently</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token class-name">ConsumeConcurrentlyStatus</span> <span class="token function">consumeMessage</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MessageExt</span><span class="token punctuation">&gt;</span></span> msgs<span class="token punctuation">,</span>
                                                        <span class="token class-name">ConsumeConcurrentlyContext</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%s Receive New Messages: %s %n&quot;</span><span class="token punctuation">,</span> 
                              <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> msgs<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token class-name">ConsumeConcurrentlyStatus</span><span class="token punctuation">.</span><span class="token constant">CONSUME_SUCCESS</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//启动消息者</span>
    consumer<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;Consumer Started.%n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><h2 id="_4-2-顺序消息"><a href="#_4-2-顺序消息" class="header-anchor">#</a> 4.2 顺序消息</h2> <p>消息有序指的是可以按照消息的发送顺序来消费(FIFO)。RocketMQ可以严格的保证消息有序，可以分为分区有序或者全局有序。</p> <p>顺序消费的原理解析，在默认的情况下消息发送会采取Round Robin轮询方式把消息发送到不同的queue(分区队列)；而消费消息的时候从多个queue上拉取消息，这种情况发送和消费是不能保证顺序。但是如果控制发送的顺序消息只依次发送到同一个queue中，消费的时候只从这个queue上依次拉取，则就保证了顺序。当发送和消费参与的queue只有一个，则是全局有序；如果多个queue参与，则为分区有序，即相对每个queue，消息都是有序的。</p> <p>下面用订单进行分区有序的示例。一个订单的顺序流程是：创建、付款、推送、完成。订单号相同的消息会被先后发送到同一个队列中，消费时，同一个OrderId获取到的肯定是同一个队列。</p> <h3 id="_4-2-1-顺序消息生产"><a href="#_4-2-1-顺序消息生产" class="header-anchor">#</a> 4.2.1 顺序消息生产</h3> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
* Producer，发送顺序消息
*/</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Producer</span> <span class="token punctuation">{</span>

   <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
       <span class="token class-name">DefaultMQProducer</span> producer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultMQProducer</span><span class="token punctuation">(</span><span class="token string">&quot;please_rename_unique_group_name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

       producer<span class="token punctuation">.</span><span class="token function">setNamesrvAddr</span><span class="token punctuation">(</span><span class="token string">&quot;127.0.0.1:9876&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

       producer<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

       <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> tags <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token string">&quot;TagA&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;TagC&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;TagD&quot;</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

       <span class="token comment">// 订单列表</span>
       <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">OrderStep</span><span class="token punctuation">&gt;</span></span> orderList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Producer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">buildOrders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

       <span class="token class-name">Date</span> date <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token class-name">SimpleDateFormat</span> sdf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleDateFormat</span><span class="token punctuation">(</span><span class="token string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token class-name">String</span> dateStr <span class="token operator">=</span> sdf<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>date<span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
           <span class="token comment">// 加个时间前缀</span>
           <span class="token class-name">String</span> body <span class="token operator">=</span> dateStr <span class="token operator">+</span> <span class="token string">&quot; Hello RocketMQ &quot;</span> <span class="token operator">+</span> orderList<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token class-name">Message</span> msg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Message</span><span class="token punctuation">(</span><span class="token string">&quot;TopicTest&quot;</span><span class="token punctuation">,</span> tags<span class="token punctuation">[</span>i <span class="token operator">%</span> tags<span class="token punctuation">.</span>length<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">&quot;KEY&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">,</span> body<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

           <span class="token class-name">SendResult</span> sendResult <span class="token operator">=</span> producer<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>msg<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">MessageQueueSelector</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
               <span class="token annotation punctuation">@Override</span>
               <span class="token keyword">public</span> <span class="token class-name">MessageQueue</span> <span class="token function">select</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MessageQueue</span><span class="token punctuation">&gt;</span></span> mqs<span class="token punctuation">,</span> <span class="token class-name">Message</span> msg<span class="token punctuation">,</span> <span class="token class-name">Object</span> arg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                   <span class="token class-name">Long</span> id <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Long</span><span class="token punctuation">)</span> arg<span class="token punctuation">;</span>  <span class="token comment">//根据订单id选择发送queue</span>
                   <span class="token keyword">long</span> index <span class="token operator">=</span> id <span class="token operator">%</span> mqs<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                   <span class="token keyword">return</span> mqs<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> index<span class="token punctuation">)</span><span class="token punctuation">;</span>
               <span class="token punctuation">}</span>
           <span class="token punctuation">}</span><span class="token punctuation">,</span> orderList<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getOrderId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//订单id</span>

           <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;SendResult status:%s, queueId:%d, body:%s&quot;</span><span class="token punctuation">,</span>
               sendResult<span class="token punctuation">.</span><span class="token function">getSendStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
               sendResult<span class="token punctuation">.</span><span class="token function">getMessageQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getQueueId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
               body<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span>

       producer<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token comment">/**
    * 订单的步骤
    */</span>
   <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">OrderStep</span> <span class="token punctuation">{</span>
       <span class="token keyword">private</span> <span class="token keyword">long</span> orderId<span class="token punctuation">;</span>
       <span class="token keyword">private</span> <span class="token class-name">String</span> desc<span class="token punctuation">;</span>

       <span class="token keyword">public</span> <span class="token keyword">long</span> <span class="token function">getOrderId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
           <span class="token keyword">return</span> orderId<span class="token punctuation">;</span>
       <span class="token punctuation">}</span>

       <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setOrderId</span><span class="token punctuation">(</span><span class="token keyword">long</span> orderId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
           <span class="token keyword">this</span><span class="token punctuation">.</span>orderId <span class="token operator">=</span> orderId<span class="token punctuation">;</span>
       <span class="token punctuation">}</span>

       <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getDesc</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
           <span class="token keyword">return</span> desc<span class="token punctuation">;</span>
       <span class="token punctuation">}</span>

       <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setDesc</span><span class="token punctuation">(</span><span class="token class-name">String</span> desc<span class="token punctuation">)</span> <span class="token punctuation">{</span>
           <span class="token keyword">this</span><span class="token punctuation">.</span>desc <span class="token operator">=</span> desc<span class="token punctuation">;</span>
       <span class="token punctuation">}</span>

       <span class="token annotation punctuation">@Override</span>
       <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
           <span class="token keyword">return</span> <span class="token string">&quot;OrderStep{&quot;</span> <span class="token operator">+</span>
               <span class="token string">&quot;orderId=&quot;</span> <span class="token operator">+</span> orderId <span class="token operator">+</span>
               <span class="token string">&quot;, desc='&quot;</span> <span class="token operator">+</span> desc <span class="token operator">+</span> <span class="token char">'\''</span> <span class="token operator">+</span>
               <span class="token char">'}'</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>

   <span class="token comment">/**
    * 生成模拟订单数据
    */</span>
   <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">OrderStep</span><span class="token punctuation">&gt;</span></span> <span class="token function">buildOrders</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">OrderStep</span><span class="token punctuation">&gt;</span></span> orderList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">OrderStep</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

       <span class="token class-name">OrderStep</span> orderDemo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrderStep</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       orderDemo<span class="token punctuation">.</span><span class="token function">setOrderId</span><span class="token punctuation">(</span><span class="token number">15103111039L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       orderDemo<span class="token punctuation">.</span><span class="token function">setDesc</span><span class="token punctuation">(</span><span class="token string">&quot;创建&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       orderList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>orderDemo<span class="token punctuation">)</span><span class="token punctuation">;</span>

       orderDemo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrderStep</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       orderDemo<span class="token punctuation">.</span><span class="token function">setOrderId</span><span class="token punctuation">(</span><span class="token number">15103111065L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       orderDemo<span class="token punctuation">.</span><span class="token function">setDesc</span><span class="token punctuation">(</span><span class="token string">&quot;创建&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       orderList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>orderDemo<span class="token punctuation">)</span><span class="token punctuation">;</span>

       orderDemo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrderStep</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       orderDemo<span class="token punctuation">.</span><span class="token function">setOrderId</span><span class="token punctuation">(</span><span class="token number">15103111039L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       orderDemo<span class="token punctuation">.</span><span class="token function">setDesc</span><span class="token punctuation">(</span><span class="token string">&quot;付款&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       orderList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>orderDemo<span class="token punctuation">)</span><span class="token punctuation">;</span>

       orderDemo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrderStep</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       orderDemo<span class="token punctuation">.</span><span class="token function">setOrderId</span><span class="token punctuation">(</span><span class="token number">15103117235L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       orderDemo<span class="token punctuation">.</span><span class="token function">setDesc</span><span class="token punctuation">(</span><span class="token string">&quot;创建&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       orderList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>orderDemo<span class="token punctuation">)</span><span class="token punctuation">;</span>

       orderDemo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrderStep</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       orderDemo<span class="token punctuation">.</span><span class="token function">setOrderId</span><span class="token punctuation">(</span><span class="token number">15103111065L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       orderDemo<span class="token punctuation">.</span><span class="token function">setDesc</span><span class="token punctuation">(</span><span class="token string">&quot;付款&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       orderList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>orderDemo<span class="token punctuation">)</span><span class="token punctuation">;</span>

       orderDemo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrderStep</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       orderDemo<span class="token punctuation">.</span><span class="token function">setOrderId</span><span class="token punctuation">(</span><span class="token number">15103117235L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       orderDemo<span class="token punctuation">.</span><span class="token function">setDesc</span><span class="token punctuation">(</span><span class="token string">&quot;付款&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       orderList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>orderDemo<span class="token punctuation">)</span><span class="token punctuation">;</span>

       orderDemo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrderStep</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       orderDemo<span class="token punctuation">.</span><span class="token function">setOrderId</span><span class="token punctuation">(</span><span class="token number">15103111065L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       orderDemo<span class="token punctuation">.</span><span class="token function">setDesc</span><span class="token punctuation">(</span><span class="token string">&quot;完成&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       orderList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>orderDemo<span class="token punctuation">)</span><span class="token punctuation">;</span>

       orderDemo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrderStep</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       orderDemo<span class="token punctuation">.</span><span class="token function">setOrderId</span><span class="token punctuation">(</span><span class="token number">15103111039L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       orderDemo<span class="token punctuation">.</span><span class="token function">setDesc</span><span class="token punctuation">(</span><span class="token string">&quot;推送&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       orderList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>orderDemo<span class="token punctuation">)</span><span class="token punctuation">;</span>

       orderDemo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrderStep</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       orderDemo<span class="token punctuation">.</span><span class="token function">setOrderId</span><span class="token punctuation">(</span><span class="token number">15103117235L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       orderDemo<span class="token punctuation">.</span><span class="token function">setDesc</span><span class="token punctuation">(</span><span class="token string">&quot;完成&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       orderList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>orderDemo<span class="token punctuation">)</span><span class="token punctuation">;</span>

       orderDemo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrderStep</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       orderDemo<span class="token punctuation">.</span><span class="token function">setOrderId</span><span class="token punctuation">(</span><span class="token number">15103111039L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       orderDemo<span class="token punctuation">.</span><span class="token function">setDesc</span><span class="token punctuation">(</span><span class="token string">&quot;完成&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       orderList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>orderDemo<span class="token punctuation">)</span><span class="token punctuation">;</span>

       <span class="token keyword">return</span> orderList<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br></div></div><h3 id="_4-2-2-顺序消费消息"><a href="#_4-2-2-顺序消费消息" class="header-anchor">#</a> 4.2.2 顺序消费消息</h3> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
* 顺序消息消费，带事务方式（应用可控制Offset什么时候提交）
*/</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConsumerInOrder</span> <span class="token punctuation">{</span>

   <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
       <span class="token class-name">DefaultMQPushConsumer</span> consumer <span class="token operator">=</span> <span class="token keyword">new</span> 
           <span class="token class-name">DefaultMQPushConsumer</span><span class="token punctuation">(</span><span class="token string">&quot;please_rename_unique_group_name_3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       consumer<span class="token punctuation">.</span><span class="token function">setNamesrvAddr</span><span class="token punctuation">(</span><span class="token string">&quot;127.0.0.1:9876&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token comment">/**
        * 设置Consumer第一次启动是从队列头部开始消费还是队列尾部开始消费&lt;br&gt;
        * 如果非第一次启动，那么按照上次消费的位置继续消费
        */</span>
       consumer<span class="token punctuation">.</span><span class="token function">setConsumeFromWhere</span><span class="token punctuation">(</span><span class="token class-name">ConsumeFromWhere</span><span class="token punctuation">.</span><span class="token constant">CONSUME_FROM_FIRST_OFFSET</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

       consumer<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token string">&quot;TopicTest&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;TagA || TagC || TagD&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

       consumer<span class="token punctuation">.</span><span class="token function">registerMessageListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MessageListenerOrderly</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

           <span class="token class-name">Random</span> random <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

           <span class="token annotation punctuation">@Override</span>
           <span class="token keyword">public</span> <span class="token class-name">ConsumeOrderlyStatus</span> <span class="token function">consumeMessage</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MessageExt</span><span class="token punctuation">&gt;</span></span> msgs<span class="token punctuation">,</span> <span class="token class-name">ConsumeOrderlyContext</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
               context<span class="token punctuation">.</span><span class="token function">setAutoCommit</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
               <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">MessageExt</span> msg <span class="token operator">:</span> msgs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                   <span class="token comment">// 可以看到每个queue有唯一的consume线程来消费, 订单对每个queue(分区)有序</span>
                   <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;consumeThread=&quot;</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;queueId=&quot;</span> <span class="token operator">+</span> msg<span class="token punctuation">.</span><span class="token function">getQueueId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;, content:&quot;</span> <span class="token operator">+</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
               <span class="token punctuation">}</span>

               <span class="token keyword">try</span> <span class="token punctuation">{</span>
                   <span class="token comment">//模拟业务逻辑处理中...</span>
                   <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span>random<span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
               <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                   e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
               <span class="token punctuation">}</span>
               <span class="token keyword">return</span> <span class="token class-name">ConsumeOrderlyStatus</span><span class="token punctuation">.</span><span class="token constant">SUCCESS</span><span class="token punctuation">;</span>
           <span class="token punctuation">}</span>
       <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

       consumer<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

       <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Consumer Started.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br></div></div><h2 id="_4-3-延时消息"><a href="#_4-3-延时消息" class="header-anchor">#</a> 4.3 延时消息</h2> <p>比如电商里，提交了一个订单就可以发送一个延时消息，1h后去检查这个订单的状态，如果还是未付款就取消订单释放库存。</p> <h3 id="_4-3-1-启动消息消费者"><a href="#_4-3-1-启动消息消费者" class="header-anchor">#</a> 4.3.1 启动消息消费者</h3> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ScheduledMessageConsumer</span> <span class="token punctuation">{</span>
   <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
      <span class="token comment">// 实例化消费者</span>
      <span class="token class-name">DefaultMQPushConsumer</span> consumer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultMQPushConsumer</span><span class="token punctuation">(</span><span class="token string">&quot;ExampleConsumer&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// 订阅Topics</span>
      consumer<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token string">&quot;TestTopic&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// 注册消息监听者</span>
      consumer<span class="token punctuation">.</span><span class="token function">registerMessageListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MessageListenerConcurrently</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token annotation punctuation">@Override</span>
          <span class="token keyword">public</span> <span class="token class-name">ConsumeConcurrentlyStatus</span> <span class="token function">consumeMessage</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MessageExt</span><span class="token punctuation">&gt;</span></span> messages<span class="token punctuation">,</span> <span class="token class-name">ConsumeConcurrentlyContext</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">MessageExt</span> message <span class="token operator">:</span> messages<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                  <span class="token comment">// Print approximate delay time period</span>
                  <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Receive message[msgId=&quot;</span> <span class="token operator">+</span> message<span class="token punctuation">.</span><span class="token function">getMsgId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;] &quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> message<span class="token punctuation">.</span><span class="token function">getStoreTimestamp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;ms later&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span>
              <span class="token keyword">return</span> <span class="token class-name">ConsumeConcurrentlyStatus</span><span class="token punctuation">.</span><span class="token constant">CONSUME_SUCCESS</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// 启动消费者</span>
      consumer<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h3 id="_4-3-2-发送延时消息"><a href="#_4-3-2-发送延时消息" class="header-anchor">#</a> 4.3.2 发送延时消息</h3> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ScheduledMessageProducer</span> <span class="token punctuation">{</span>
   <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
      <span class="token comment">// 实例化一个生产者来产生延时消息</span>
      <span class="token class-name">DefaultMQProducer</span> producer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultMQProducer</span><span class="token punctuation">(</span><span class="token string">&quot;ExampleProducerGroup&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// 启动生产者</span>
      producer<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">int</span> totalMessagesToSend <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> totalMessagesToSend<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token class-name">Message</span> message <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Message</span><span class="token punctuation">(</span><span class="token string">&quot;TestTopic&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">&quot;Hello scheduled message &quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token comment">// 设置延时等级3,这个消息将在10s之后发送(现在只支持固定的几个时间,详看delayTimeLevel)</span>
          message<span class="token punctuation">.</span><span class="token function">setDelayTimeLevel</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token comment">// 发送消息</span>
          producer<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
       <span class="token comment">// 关闭生产者</span>
      producer<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>###4.3.3 验证</p> <p>您将会看到消息的消费比存储时间晚10秒</p> <h3 id="_4-3-4-使用限制"><a href="#_4-3-4-使用限制" class="header-anchor">#</a> 4.3.4 使用限制</h3> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// org/apache/rocketmq/store/config/MessageStoreConfig.java</span>
<span class="token keyword">private</span> <span class="token class-name">String</span> messageDelayLevel <span class="token operator">=</span> <span class="token string">&quot;1s 5s 10s 30s 1m 2m 3m 4m 5m 6m 7m 8m 9m 10m 20m 30m 1h 2h&quot;</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>现在RocketMq并不支持任意时间的延时，需要设置几个固定的延时等级，从1s到2h分别对应着等级1到18</p> <h2 id="_4-4-批量消息"><a href="#_4-4-批量消息" class="header-anchor">#</a> 4.4 批量消息</h2> <p>批量发送消息能显著提高传递小消息的性能。限制是这些批量消息应该有相同的topic，相同的waitStoreMsgOK，而且不能是延时消息。此外，这一批消息的总大小不应超过4MB。</p> <h3 id="_4-4-1-发送批量消息"><a href="#_4-4-1-发送批量消息" class="header-anchor">#</a> 4.4.1 发送批量消息</h3> <p>如果您每次只发送不超过4MB的消息，则很容易使用批处理，样例如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">String</span> topic <span class="token operator">=</span> <span class="token string">&quot;BatchTest&quot;</span><span class="token punctuation">;</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Message</span><span class="token punctuation">&gt;</span></span> messages <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
messages<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Message</span><span class="token punctuation">(</span>topic<span class="token punctuation">,</span> <span class="token string">&quot;TagA&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;OrderID001&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Hello world 0&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
messages<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Message</span><span class="token punctuation">(</span>topic<span class="token punctuation">,</span> <span class="token string">&quot;TagA&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;OrderID002&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Hello world 1&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
messages<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Message</span><span class="token punctuation">(</span>topic<span class="token punctuation">,</span> <span class="token string">&quot;TagA&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;OrderID003&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Hello world 2&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">try</span> <span class="token punctuation">{</span>
   producer<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>messages<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token comment">//处理error</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>如果消息的总长度可能大于4MB时，这时候最好把消息进行分割</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ListSplitter</span> <span class="token keyword">implements</span> <span class="token class-name">Iterator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">Message</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
   <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token constant">SIZE_LIMIT</span> <span class="token operator">=</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">4</span><span class="token punctuation">;</span>
   <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Message</span><span class="token punctuation">&gt;</span></span> messages<span class="token punctuation">;</span>
   <span class="token keyword">private</span> <span class="token keyword">int</span> currIndex<span class="token punctuation">;</span>
   <span class="token keyword">public</span> <span class="token class-name">ListSplitter</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Message</span><span class="token punctuation">&gt;</span></span> messages<span class="token punctuation">)</span> <span class="token punctuation">{</span>
           <span class="token keyword">this</span><span class="token punctuation">.</span>messages <span class="token operator">=</span> messages<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Override</span> 
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">return</span> currIndex <span class="token operator">&lt;</span> messages<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   	<span class="token annotation punctuation">@Override</span> 
    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Message</span><span class="token punctuation">&gt;</span></span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">int</span> nextIndex <span class="token operator">=</span> currIndex<span class="token punctuation">;</span>
       <span class="token keyword">int</span> totalSize <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
       <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span> nextIndex <span class="token operator">&lt;</span> messages<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> nextIndex<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
           <span class="token class-name">Message</span> message <span class="token operator">=</span> messages<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>nextIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token keyword">int</span> tmpSize <span class="token operator">=</span> message<span class="token punctuation">.</span><span class="token function">getTopic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> message<span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span>
           <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> properties <span class="token operator">=</span> message<span class="token punctuation">.</span><span class="token function">getProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Map<span class="token punctuation">.</span>Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> entry <span class="token operator">:</span> properties<span class="token punctuation">.</span><span class="token function">entrySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
               tmpSize <span class="token operator">+=</span> entry<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> entry<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token punctuation">}</span>
           tmpSize <span class="token operator">=</span> tmpSize <span class="token operator">+</span> <span class="token number">20</span><span class="token punctuation">;</span> <span class="token comment">// 增加日志的开销20字节</span>
           <span class="token keyword">if</span> <span class="token punctuation">(</span>tmpSize <span class="token operator">&gt;</span> <span class="token constant">SIZE_LIMIT</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
               <span class="token comment">//单个消息超过了最大的限制</span>
               <span class="token comment">//忽略,否则会阻塞分裂的进程</span>
               <span class="token keyword">if</span> <span class="token punctuation">(</span>nextIndex <span class="token operator">-</span> currIndex <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                  <span class="token comment">//假如下一个子列表没有元素,则添加这个子列表然后退出循环,否则只是退出循环</span>
                  nextIndex<span class="token operator">++</span><span class="token punctuation">;</span>
               <span class="token punctuation">}</span>
               <span class="token keyword">break</span><span class="token punctuation">;</span>
           <span class="token punctuation">}</span>
           <span class="token keyword">if</span> <span class="token punctuation">(</span>tmpSize <span class="token operator">+</span> totalSize <span class="token operator">&gt;</span> <span class="token constant">SIZE_LIMIT</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
               <span class="token keyword">break</span><span class="token punctuation">;</span>
           <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
               totalSize <span class="token operator">+=</span> tmpSize<span class="token punctuation">;</span>
           <span class="token punctuation">}</span>

       <span class="token punctuation">}</span>
       <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Message</span><span class="token punctuation">&gt;</span></span> subList <span class="token operator">=</span> messages<span class="token punctuation">.</span><span class="token function">subList</span><span class="token punctuation">(</span>currIndex<span class="token punctuation">,</span> nextIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>
       currIndex <span class="token operator">=</span> nextIndex<span class="token punctuation">;</span>
       <span class="token keyword">return</span> subList<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">//把大的消息分裂成若干个小的消息</span>
<span class="token class-name">ListSplitter</span> splitter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ListSplitter</span><span class="token punctuation">(</span>messages<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">while</span> <span class="token punctuation">(</span>splitter<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Message</span><span class="token punctuation">&gt;</span></span>  listItem <span class="token operator">=</span> splitter<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      producer<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>listItem<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//处理error</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br></div></div><h2 id="_4-5-过滤消息"><a href="#_4-5-过滤消息" class="header-anchor">#</a> 4.5 过滤消息</h2> <p>在大多数情况下，TAG是一个简单而有用的设计，其可以来选择您想要的消息。例如：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">DefaultMQPushConsumer</span> consumer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultMQPushConsumer</span><span class="token punctuation">(</span><span class="token string">&quot;CID_EXAMPLE&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
consumer<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token string">&quot;TOPIC&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;TAGA || TAGB || TAGC&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>消费者将接收包含TAGA或TAGB或TAGC的消息。但是限制是一个消息只能有一个标签，这对于复杂的场景可能不起作用。在这种情况下，可以使用SQL表达式筛选消息。SQL特性可以通过发送消息时的属性来进行计算。在RocketMQ定义的语法下，可以实现一些简单的逻辑。下面是一个例子：</p> <div class="language-te line-numbers-mode"><pre class="language-text"><code>------------
| message  |
|----------|  a &gt; 5 AND b = 'abc'
| a = 10   |  --------------------&gt; Gotten
| b = 'abc'|
| c = true |
------------
------------
| message  |
|----------|   a &gt; 5 AND b = 'abc'
| a = 1    |  --------------------&gt; Missed
| b = 'abc'|
| c = true |
------------
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h3 id="_4-5-1-sql基本语法"><a href="#_4-5-1-sql基本语法" class="header-anchor">#</a> 4.5.1 SQL基本语法</h3> <p>RocketMQ只定义了一些基本语法来支持这个特性。你也可以很容易地扩展它。</p> <ul><li>数值比较，比如：<strong>&gt;，&gt;=，&lt;，&lt;=，BETWEEN，=；</strong></li> <li>字符比较，比如：<strong>=，&lt;&gt;，IN；</strong></li> <li><strong>IS NULL</strong> 或者 <strong>IS NOT NULL；</strong></li> <li>逻辑符号 <strong>AND，OR，NOT；</strong></li></ul> <p>常量支持类型为：</p> <ul><li>数值，比如：<strong>123，3.1415；</strong></li> <li>字符，比如：<strong>'abc'，必须用单引号包裹起来；</strong></li> <li><strong>NULL</strong>，特殊的常量</li> <li>布尔值，<strong>TRUE</strong> 或 <strong>FALSE</strong></li></ul> <p>只有使用push模式的消费者才能用使用SQL92标准的sql语句，接口如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">subscribe</span><span class="token punctuation">(</span>finalString topic<span class="token punctuation">,</span> <span class="token keyword">final</span> <span class="token class-name">MessageSelector</span> messageSelector<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="_4-5-2-消息生产者"><a href="#_4-5-2-消息生产者" class="header-anchor">#</a> 4.5.2 消息生产者</h3> <p>发送消息时，你能通过<code>putUserProperty</code>来设置消息的属性</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">DefaultMQProducer</span> producer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultMQProducer</span><span class="token punctuation">(</span><span class="token string">&quot;please_rename_unique_group_name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
producer<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Message</span> msg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Message</span><span class="token punctuation">(</span><span class="token string">&quot;TopicTest&quot;</span><span class="token punctuation">,</span>
   tag<span class="token punctuation">,</span>
   <span class="token punctuation">(</span><span class="token string">&quot;Hello RocketMQ &quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token class-name">RemotingHelper</span><span class="token punctuation">.</span><span class="token constant">DEFAULT_CHARSET</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 设置一些属性</span>
msg<span class="token punctuation">.</span><span class="token function">putUserProperty</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">SendResult</span> sendResult <span class="token operator">=</span> producer<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>

producer<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="_4-5-3-消息消费者"><a href="#_4-5-3-消息消费者" class="header-anchor">#</a> 4.5.3 消息消费者</h3> <p>用MessageSelector.bySql来使用sql筛选消息</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">DefaultMQPushConsumer</span> consumer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultMQPushConsumer</span><span class="token punctuation">(</span><span class="token string">&quot;please_rename_unique_group_name_4&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 只有订阅的消息有这个属性a, a &gt;=0 and a &lt;= 3</span>
consumer<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token string">&quot;TopicTest&quot;</span><span class="token punctuation">,</span> <span class="token class-name">MessageSelector</span><span class="token punctuation">.</span><span class="token function">bySql</span><span class="token punctuation">(</span><span class="token string">&quot;a between 0 and 3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
consumer<span class="token punctuation">.</span><span class="token function">registerMessageListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MessageListenerConcurrently</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token annotation punctuation">@Override</span>
   <span class="token keyword">public</span> <span class="token class-name">ConsumeConcurrentlyStatus</span> <span class="token function">consumeMessage</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MessageExt</span><span class="token punctuation">&gt;</span></span> msgs<span class="token punctuation">,</span> <span class="token class-name">ConsumeConcurrentlyContext</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">return</span> <span class="token class-name">ConsumeConcurrentlyStatus</span><span class="token punctuation">.</span><span class="token constant">CONSUME_SUCCESS</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
consumer<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h2 id="_4-6-事务消息"><a href="#_4-6-事务消息" class="header-anchor">#</a> 4.6 事务消息</h2> <p>###4.6.1 流程分析</p> <p><img src="/assets/img/事务消息.4dfdf7d9.png" alt=""></p> <p>上图说明了事务消息的大致方案，其中分为两个流程：正常事务消息的发送及提交、事务消息的补偿流程。</p> <p>####1）事务消息发送及提交</p> <p>(1) 发送消息（half消息）。</p> <p>(2) 服务端响应消息写入结果。</p> <p>(3) 根据发送结果执行本地事务（如果写入失败，此时half消息对业务不可见，本地逻辑不执行）。</p> <p>(4) 根据本地事务状态执行Commit或者Rollback（Commit操作生成消息索引，消息对消费者可见）</p> <h4 id="_2-事务补偿"><a href="#_2-事务补偿" class="header-anchor">#</a> 2）事务补偿</h4> <p>(1) 对没有Commit/Rollback的事务消息（pending状态的消息），从服务端发起一次“回查”</p> <p>(2) Producer收到回查消息，检查回查消息对应的本地事务的状态</p> <p>(3) 根据本地事务状态，重新Commit或者Rollback</p> <p>其中，补偿阶段用于解决消息Commit或者Rollback发生超时或者失败的情况。</p> <h4 id="_3-事务消息状态"><a href="#_3-事务消息状态" class="header-anchor">#</a> 3）事务消息状态</h4> <p>事务消息共有三种状态，提交状态、回滚状态、中间状态：</p> <ul><li>TransactionStatus.CommitTransaction: 提交事务，它允许消费者消费此消息。</li> <li>TransactionStatus.RollbackTransaction: 回滚事务，它代表该消息将被删除，不允许被消费。</li> <li>TransactionStatus.Unknown: 中间状态，它代表需要检查消息队列来确定状态。</li></ul> <p>###4.6.1 发送事务消息</p> <h4 id="_1-创建事务性生产者"><a href="#_1-创建事务性生产者" class="header-anchor">#</a> 1) 创建事务性生产者</h4> <p>使用 <code>TransactionMQProducer</code>类创建生产者，并指定唯一的 <code>ProducerGroup</code>，就可以设置自定义线程池来处理这些检查请求。执行本地事务后、需要根据执行结果对消息队列进行回复。回传的事务状态在请参考前一节。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Producer</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">MQClientException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token comment">//创建事务监听器</span>
        <span class="token class-name">TransactionListener</span> transactionListener <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TransactionListenerImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//创建消息生产者</span>
        <span class="token class-name">TransactionMQProducer</span> producer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TransactionMQProducer</span><span class="token punctuation">(</span><span class="token string">&quot;group6&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        producer<span class="token punctuation">.</span><span class="token function">setNamesrvAddr</span><span class="token punctuation">(</span><span class="token string">&quot;192.168.25.135:9876;192.168.25.138:9876&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//生产者这是监听器</span>
        producer<span class="token punctuation">.</span><span class="token function">setTransactionListener</span><span class="token punctuation">(</span>transactionListener<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//启动消息生产者</span>
        producer<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> tags <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token string">&quot;TagA&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;TagB&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;TagC&quot;</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token class-name">Message</span> msg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Message</span><span class="token punctuation">(</span><span class="token string">&quot;TransactionTopic&quot;</span><span class="token punctuation">,</span> tags<span class="token punctuation">[</span>i <span class="token operator">%</span> tags<span class="token punctuation">.</span>length<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">&quot;KEY&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">,</span>
                        <span class="token punctuation">(</span><span class="token string">&quot;Hello RocketMQ &quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token class-name">RemotingHelper</span><span class="token punctuation">.</span><span class="token constant">DEFAULT_CHARSET</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">SendResult</span> sendResult <span class="token operator">=</span> producer<span class="token punctuation">.</span><span class="token function">sendMessageInTransaction</span><span class="token punctuation">(</span>msg<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%s%n&quot;</span><span class="token punctuation">,</span> sendResult<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">MQClientException</span> <span class="token operator">|</span> <span class="token class-name">UnsupportedEncodingException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//producer.shutdown();</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><h4 id="_2-实现事务的监听接口"><a href="#_2-实现事务的监听接口" class="header-anchor">#</a> 2）实现事务的监听接口</h4> <p>当发送半消息成功时，我们使用 <code>executeLocalTransaction</code> 方法来执行本地事务。它返回前一节中提到的三个事务状态之一。<code>checkLocalTranscation</code> 方法用于检查本地事务状态，并回应消息队列的检查请求。它也是返回前一节中提到的三个事务状态之一。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TransactionListenerImpl</span> <span class="token keyword">implements</span> <span class="token class-name">TransactionListener</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">LocalTransactionState</span> <span class="token function">executeLocalTransaction</span><span class="token punctuation">(</span><span class="token class-name">Message</span> msg<span class="token punctuation">,</span> <span class="token class-name">Object</span> arg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;执行本地事务&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;TagA&quot;</span><span class="token punctuation">,</span> msg<span class="token punctuation">.</span><span class="token function">getTags</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token class-name">LocalTransactionState</span><span class="token punctuation">.</span><span class="token constant">COMMIT_MESSAGE</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;TagB&quot;</span><span class="token punctuation">,</span> msg<span class="token punctuation">.</span><span class="token function">getTags</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token class-name">LocalTransactionState</span><span class="token punctuation">.</span><span class="token constant">ROLLBACK_MESSAGE</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token class-name">LocalTransactionState</span><span class="token punctuation">.</span><span class="token constant">UNKNOW</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">LocalTransactionState</span> <span class="token function">checkLocalTransaction</span><span class="token punctuation">(</span><span class="token class-name">MessageExt</span> msg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;MQ检查消息Tag【&quot;</span><span class="token operator">+</span>msg<span class="token punctuation">.</span><span class="token function">getTags</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;】的本地事务执行结果&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token class-name">LocalTransactionState</span><span class="token punctuation">.</span><span class="token constant">COMMIT_MESSAGE</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h3 id="_4-6-2-使用限制"><a href="#_4-6-2-使用限制" class="header-anchor">#</a> 4.6.2 使用限制</h3> <ol><li>事务消息不支持延时消息和批量消息。</li> <li>为了避免单个消息被检查太多次而导致半队列消息累积，我们默认将单个消息的检查次数限制为 15 次，但是用户可以通过 Broker 配置文件的 <code>transactionCheckMax</code>参数来修改此限制。如果已经检查某条消息超过 N 次的话（ N = <code>transactionCheckMax</code> ） 则 Broker 将丢弃此消息，并在默认情况下同时打印错误日志。用户可以通过重写 <code>AbstractTransactionCheckListener</code> 类来修改这个行为。</li> <li>事务消息将在 Broker 配置文件中的参数 transactionMsgTimeout 这样的特定时间长度之后被检查。当发送事务消息时，用户还可以通过设置用户属性 CHECK_IMMUNITY_TIME_IN_SECONDS 来改变这个限制，该参数优先于 <code>transactionMsgTimeout</code> 参数。</li> <li>事务性消息可能不止一次被检查或消费。</li> <li>提交给用户的目标主题消息可能会失败，目前这依日志的记录而定。它的高可用性通过 RocketMQ 本身的高可用性机制来保证，如果希望确保事务消息不丢失、并且事务完整性得到保证，建议使用同步的双重写入机制。</li> <li>事务消息的生产者 ID 不能与其他类型消息的生产者 ID 共享。与其他类型的消息不同，事务消息允许反向查询、MQ服务器能通过它们的生产者 ID 查询到消费者。</li></ol></div></section> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev"><a href="/Java/架构设计/分布式/分布式消息队列/RabbitMQ/RabbitMQ安装.html" class="prev">
          RabbitMQ安装
        </a></span> <span class="next"><a href="/Java/架构设计/分布式/分布式消息队列/RocketMQ/RocketMQ-02.html">
          RocketMQ-学习笔记02
        </a></span></p></div> <div class="comments-wrapper"><!----></div></main></div> <!----></div> <ul class="sub-sidebar sub-sidebar-wrapper" style="width:12rem;" data-v-b57cc07c data-v-7dd95ae2><li class="level-2" data-v-b57cc07c><a href="/Java/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/%E5%88%86%E5%B8%83%E5%BC%8F/%E5%88%86%E5%B8%83%E5%BC%8F%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/RocketMQ/RocketMQ-01.html#_1-2-mq的优点和缺点" class="sidebar-link reco-side-_1-2-mq的优点和缺点" data-v-b57cc07c>1.2 MQ的优点和缺点</a></li><li class="level-2" data-v-b57cc07c><a href="/Java/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/%E5%88%86%E5%B8%83%E5%BC%8F/%E5%88%86%E5%B8%83%E5%BC%8F%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/RocketMQ/RocketMQ-01.html#_1-3-各种mq产品的比较" class="sidebar-link reco-side-_1-3-各种mq产品的比较" data-v-b57cc07c>1.3 各种MQ产品的比较</a></li><li class="level-2" data-v-b57cc07c><a href="/Java/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/%E5%88%86%E5%B8%83%E5%BC%8F/%E5%88%86%E5%B8%83%E5%BC%8F%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/RocketMQ/RocketMQ-01.html#_2-1-准备工作" class="sidebar-link reco-side-_2-1-准备工作" data-v-b57cc07c>2.1 准备工作</a></li><li class="level-3" data-v-b57cc07c><a href="/Java/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/%E5%88%86%E5%B8%83%E5%BC%8F/%E5%88%86%E5%B8%83%E5%BC%8F%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/RocketMQ/RocketMQ-01.html#_2-1-1-下载rocketmq" class="sidebar-link reco-side-_2-1-1-下载rocketmq" data-v-b57cc07c>2.1.1 下载RocketMQ</a></li><li class="level-3" data-v-b57cc07c><a href="/Java/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/%E5%88%86%E5%B8%83%E5%BC%8F/%E5%88%86%E5%B8%83%E5%BC%8F%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/RocketMQ/RocketMQ-01.html#_2-2-2-环境要求" class="sidebar-link reco-side-_2-2-2-环境要求" data-v-b57cc07c>2.2.2 环境要求</a></li><li class="level-2" data-v-b57cc07c><a href="/Java/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/%E5%88%86%E5%B8%83%E5%BC%8F/%E5%88%86%E5%B8%83%E5%BC%8F%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/RocketMQ/RocketMQ-01.html#_2-2-安装rocketmq" class="sidebar-link reco-side-_2-2-安装rocketmq" data-v-b57cc07c>2.2 安装RocketMQ</a></li><li class="level-3" data-v-b57cc07c><a href="/Java/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/%E5%88%86%E5%B8%83%E5%BC%8F/%E5%88%86%E5%B8%83%E5%BC%8F%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/RocketMQ/RocketMQ-01.html#_2-2-1-安装步骤" class="sidebar-link reco-side-_2-2-1-安装步骤" data-v-b57cc07c>2.2.1 安装步骤</a></li><li class="level-3" data-v-b57cc07c><a href="/Java/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/%E5%88%86%E5%B8%83%E5%BC%8F/%E5%88%86%E5%B8%83%E5%BC%8F%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/RocketMQ/RocketMQ-01.html#_2-2-2-目录介绍" class="sidebar-link reco-side-_2-2-2-目录介绍" data-v-b57cc07c>2.2.2 目录介绍</a></li><li class="level-2" data-v-b57cc07c><a href="/Java/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/%E5%88%86%E5%B8%83%E5%BC%8F/%E5%88%86%E5%B8%83%E5%BC%8F%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/RocketMQ/RocketMQ-01.html#_2-3-启动rocketmq" class="sidebar-link reco-side-_2-3-启动rocketmq" data-v-b57cc07c>2.3 启动RocketMQ</a></li><li class="level-2" data-v-b57cc07c><a href="/Java/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/%E5%88%86%E5%B8%83%E5%BC%8F/%E5%88%86%E5%B8%83%E5%BC%8F%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/RocketMQ/RocketMQ-01.html#_2-4-测试rocketmq" class="sidebar-link reco-side-_2-4-测试rocketmq" data-v-b57cc07c>2.4 测试RocketMQ</a></li><li class="level-3" data-v-b57cc07c><a href="/Java/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/%E5%88%86%E5%B8%83%E5%BC%8F/%E5%88%86%E5%B8%83%E5%BC%8F%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/RocketMQ/RocketMQ-01.html#_2-4-1-发送消息" class="sidebar-link reco-side-_2-4-1-发送消息" data-v-b57cc07c>2.4.1 发送消息</a></li><li class="level-3" data-v-b57cc07c><a href="/Java/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/%E5%88%86%E5%B8%83%E5%BC%8F/%E5%88%86%E5%B8%83%E5%BC%8F%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/RocketMQ/RocketMQ-01.html#_2-4-2-接收消息" class="sidebar-link reco-side-_2-4-2-接收消息" data-v-b57cc07c>2.4.2 接收消息</a></li><li class="level-2" data-v-b57cc07c><a href="/Java/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/%E5%88%86%E5%B8%83%E5%BC%8F/%E5%88%86%E5%B8%83%E5%BC%8F%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/RocketMQ/RocketMQ-01.html#_2-5-关闭rocketmq" class="sidebar-link reco-side-_2-5-关闭rocketmq" data-v-b57cc07c>2.5 关闭RocketMQ</a></li><li class="level-2" data-v-b57cc07c><a href="/Java/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/%E5%88%86%E5%B8%83%E5%BC%8F/%E5%88%86%E5%B8%83%E5%BC%8F%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/RocketMQ/RocketMQ-01.html#_3-1-各角色介绍" class="sidebar-link reco-side-_3-1-各角色介绍" data-v-b57cc07c>3.1 各角色介绍</a></li><li class="level-2" data-v-b57cc07c><a href="/Java/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/%E5%88%86%E5%B8%83%E5%BC%8F/%E5%88%86%E5%B8%83%E5%BC%8F%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/RocketMQ/RocketMQ-01.html#_3-2-集群搭建方式" class="sidebar-link reco-side-_3-2-集群搭建方式" data-v-b57cc07c>3.2 集群搭建方式</a></li><li class="level-3" data-v-b57cc07c><a href="/Java/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/%E5%88%86%E5%B8%83%E5%BC%8F/%E5%88%86%E5%B8%83%E5%BC%8F%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/RocketMQ/RocketMQ-01.html#_3-2-1-集群特点" class="sidebar-link reco-side-_3-2-1-集群特点" data-v-b57cc07c>3.2.1 集群特点</a></li><li class="level-3" data-v-b57cc07c><a href="/Java/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/%E5%88%86%E5%B8%83%E5%BC%8F/%E5%88%86%E5%B8%83%E5%BC%8F%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/RocketMQ/RocketMQ-01.html#_3-2-3-集群模式" class="sidebar-link reco-side-_3-2-3-集群模式" data-v-b57cc07c>3.2.3 集群模式</a></li><li class="level-2" data-v-b57cc07c><a href="/Java/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/%E5%88%86%E5%B8%83%E5%BC%8F/%E5%88%86%E5%B8%83%E5%BC%8F%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/RocketMQ/RocketMQ-01.html#_3-3-双主双从集群搭建" class="sidebar-link reco-side-_3-3-双主双从集群搭建" data-v-b57cc07c>3.3 双主双从集群搭建</a></li><li class="level-3" data-v-b57cc07c><a href="/Java/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/%E5%88%86%E5%B8%83%E5%BC%8F/%E5%88%86%E5%B8%83%E5%BC%8F%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/RocketMQ/RocketMQ-01.html#_3-3-1-总体架构" class="sidebar-link reco-side-_3-3-1-总体架构" data-v-b57cc07c>3.3.1 总体架构</a></li><li class="level-3" data-v-b57cc07c><a href="/Java/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/%E5%88%86%E5%B8%83%E5%BC%8F/%E5%88%86%E5%B8%83%E5%BC%8F%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/RocketMQ/RocketMQ-01.html#_3-3-2-集群工作流程" class="sidebar-link reco-side-_3-3-2-集群工作流程" data-v-b57cc07c>3.3.2 集群工作流程</a></li><li class="level-3" data-v-b57cc07c><a href="/Java/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/%E5%88%86%E5%B8%83%E5%BC%8F/%E5%88%86%E5%B8%83%E5%BC%8F%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/RocketMQ/RocketMQ-01.html#_3-3-3-服务器环境" class="sidebar-link reco-side-_3-3-3-服务器环境" data-v-b57cc07c>3.3.3 服务器环境</a></li><li class="level-3" data-v-b57cc07c><a href="/Java/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/%E5%88%86%E5%B8%83%E5%BC%8F/%E5%88%86%E5%B8%83%E5%BC%8F%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/RocketMQ/RocketMQ-01.html#_3-3-4-host添加信息" class="sidebar-link reco-side-_3-3-4-host添加信息" data-v-b57cc07c>3.3.4 Host添加信息</a></li><li class="level-3" data-v-b57cc07c><a href="/Java/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/%E5%88%86%E5%B8%83%E5%BC%8F/%E5%88%86%E5%B8%83%E5%BC%8F%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/RocketMQ/RocketMQ-01.html#_3-3-5-防火墙配置" class="sidebar-link reco-side-_3-3-5-防火墙配置" data-v-b57cc07c>3.3.5 防火墙配置</a></li><li class="level-3" data-v-b57cc07c><a href="/Java/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/%E5%88%86%E5%B8%83%E5%BC%8F/%E5%88%86%E5%B8%83%E5%BC%8F%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/RocketMQ/RocketMQ-01.html#_3-3-6-环境变量配置" class="sidebar-link reco-side-_3-3-6-环境变量配置" data-v-b57cc07c>3.3.6 环境变量配置</a></li><li class="level-3" data-v-b57cc07c><a href="/Java/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/%E5%88%86%E5%B8%83%E5%BC%8F/%E5%88%86%E5%B8%83%E5%BC%8F%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/RocketMQ/RocketMQ-01.html#_3-3-7-创建消息存储路径" class="sidebar-link reco-side-_3-3-7-创建消息存储路径" data-v-b57cc07c>3.3.7 创建消息存储路径</a></li><li class="level-3" data-v-b57cc07c><a href="/Java/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/%E5%88%86%E5%B8%83%E5%BC%8F/%E5%88%86%E5%B8%83%E5%BC%8F%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/RocketMQ/RocketMQ-01.html#_3-3-8-broker配置文件" class="sidebar-link reco-side-_3-3-8-broker配置文件" data-v-b57cc07c>3.3.8 broker配置文件</a></li><li class="level-3" data-v-b57cc07c><a href="/Java/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/%E5%88%86%E5%B8%83%E5%BC%8F/%E5%88%86%E5%B8%83%E5%BC%8F%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/RocketMQ/RocketMQ-01.html#_3-3-9-修改启动脚本文件" class="sidebar-link reco-side-_3-3-9-修改启动脚本文件" data-v-b57cc07c>3.3.9 修改启动脚本文件</a></li><li class="level-3" data-v-b57cc07c><a href="/Java/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/%E5%88%86%E5%B8%83%E5%BC%8F/%E5%88%86%E5%B8%83%E5%BC%8F%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/RocketMQ/RocketMQ-01.html#_3-3-10-服务启动" class="sidebar-link reco-side-_3-3-10-服务启动" data-v-b57cc07c>3.3.10 服务启动</a></li><li class="level-3" data-v-b57cc07c><a href="/Java/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/%E5%88%86%E5%B8%83%E5%BC%8F/%E5%88%86%E5%B8%83%E5%BC%8F%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/RocketMQ/RocketMQ-01.html#_3-3-11-查看进程状态" class="sidebar-link reco-side-_3-3-11-查看进程状态" data-v-b57cc07c>3.3.11 查看进程状态</a></li><li class="level-3" data-v-b57cc07c><a href="/Java/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/%E5%88%86%E5%B8%83%E5%BC%8F/%E5%88%86%E5%B8%83%E5%BC%8F%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/RocketMQ/RocketMQ-01.html#_3-3-12-查看日志" class="sidebar-link reco-side-_3-3-12-查看日志" data-v-b57cc07c>3.3.12 查看日志</a></li><li class="level-2" data-v-b57cc07c><a href="/Java/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/%E5%88%86%E5%B8%83%E5%BC%8F/%E5%88%86%E5%B8%83%E5%BC%8F%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/RocketMQ/RocketMQ-01.html#_3-4-mqadmin管理工具" class="sidebar-link reco-side-_3-4-mqadmin管理工具" data-v-b57cc07c>3.4 mqadmin管理工具</a></li><li class="level-3" data-v-b57cc07c><a href="/Java/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/%E5%88%86%E5%B8%83%E5%BC%8F/%E5%88%86%E5%B8%83%E5%BC%8F%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/RocketMQ/RocketMQ-01.html#_3-4-1-使用方式" class="sidebar-link reco-side-_3-4-1-使用方式" data-v-b57cc07c>3.4.1 使用方式</a></li><li class="level-3" data-v-b57cc07c><a href="/Java/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/%E5%88%86%E5%B8%83%E5%BC%8F/%E5%88%86%E5%B8%83%E5%BC%8F%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/RocketMQ/RocketMQ-01.html#_3-4-3-注意事项" class="sidebar-link reco-side-_3-4-3-注意事项" data-v-b57cc07c>3.4.3 注意事项</a></li><li class="level-2" data-v-b57cc07c><a href="/Java/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/%E5%88%86%E5%B8%83%E5%BC%8F/%E5%88%86%E5%B8%83%E5%BC%8F%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/RocketMQ/RocketMQ-01.html#_3-5-集群监控平台搭建" class="sidebar-link reco-side-_3-5-集群监控平台搭建" data-v-b57cc07c>3.5 集群监控平台搭建</a></li><li class="level-3" data-v-b57cc07c><a href="/Java/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/%E5%88%86%E5%B8%83%E5%BC%8F/%E5%88%86%E5%B8%83%E5%BC%8F%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/RocketMQ/RocketMQ-01.html#_3-5-1-概述" class="sidebar-link reco-side-_3-5-1-概述" data-v-b57cc07c>3.5.1 概述</a></li><li class="level-3" data-v-b57cc07c><a href="/Java/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/%E5%88%86%E5%B8%83%E5%BC%8F/%E5%88%86%E5%B8%83%E5%BC%8F%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/RocketMQ/RocketMQ-01.html#_3-5-2-下载并编译打包" class="sidebar-link reco-side-_3-5-2-下载并编译打包" data-v-b57cc07c>3.5.2 下载并编译打包</a></li><li class="level-2" data-v-b57cc07c><a href="/Java/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/%E5%88%86%E5%B8%83%E5%BC%8F/%E5%88%86%E5%B8%83%E5%BC%8F%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/RocketMQ/RocketMQ-01.html#_4-1-基本样例" class="sidebar-link reco-side-_4-1-基本样例" data-v-b57cc07c>4.1 基本样例</a></li><li class="level-3" data-v-b57cc07c><a href="/Java/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/%E5%88%86%E5%B8%83%E5%BC%8F/%E5%88%86%E5%B8%83%E5%BC%8F%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/RocketMQ/RocketMQ-01.html#_4-1-1-消息发送" class="sidebar-link reco-side-_4-1-1-消息发送" data-v-b57cc07c>4.1.1 消息发送</a></li><li class="level-3" data-v-b57cc07c><a href="/Java/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/%E5%88%86%E5%B8%83%E5%BC%8F/%E5%88%86%E5%B8%83%E5%BC%8F%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/RocketMQ/RocketMQ-01.html#_4-1-2-消费消息" class="sidebar-link reco-side-_4-1-2-消费消息" data-v-b57cc07c>4.1.2 消费消息</a></li><li class="level-2" data-v-b57cc07c><a href="/Java/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/%E5%88%86%E5%B8%83%E5%BC%8F/%E5%88%86%E5%B8%83%E5%BC%8F%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/RocketMQ/RocketMQ-01.html#_4-2-顺序消息" class="sidebar-link reco-side-_4-2-顺序消息" data-v-b57cc07c>4.2 顺序消息</a></li><li class="level-3" data-v-b57cc07c><a href="/Java/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/%E5%88%86%E5%B8%83%E5%BC%8F/%E5%88%86%E5%B8%83%E5%BC%8F%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/RocketMQ/RocketMQ-01.html#_4-2-1-顺序消息生产" class="sidebar-link reco-side-_4-2-1-顺序消息生产" data-v-b57cc07c>4.2.1 顺序消息生产</a></li><li class="level-3" data-v-b57cc07c><a href="/Java/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/%E5%88%86%E5%B8%83%E5%BC%8F/%E5%88%86%E5%B8%83%E5%BC%8F%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/RocketMQ/RocketMQ-01.html#_4-2-2-顺序消费消息" class="sidebar-link reco-side-_4-2-2-顺序消费消息" data-v-b57cc07c>4.2.2 顺序消费消息</a></li><li class="level-2" data-v-b57cc07c><a href="/Java/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/%E5%88%86%E5%B8%83%E5%BC%8F/%E5%88%86%E5%B8%83%E5%BC%8F%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/RocketMQ/RocketMQ-01.html#_4-3-延时消息" class="sidebar-link reco-side-_4-3-延时消息" data-v-b57cc07c>4.3 延时消息</a></li><li class="level-3" data-v-b57cc07c><a href="/Java/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/%E5%88%86%E5%B8%83%E5%BC%8F/%E5%88%86%E5%B8%83%E5%BC%8F%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/RocketMQ/RocketMQ-01.html#_4-3-1-启动消息消费者" class="sidebar-link reco-side-_4-3-1-启动消息消费者" data-v-b57cc07c>4.3.1 启动消息消费者</a></li><li class="level-3" data-v-b57cc07c><a href="/Java/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/%E5%88%86%E5%B8%83%E5%BC%8F/%E5%88%86%E5%B8%83%E5%BC%8F%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/RocketMQ/RocketMQ-01.html#_4-3-2-发送延时消息" class="sidebar-link reco-side-_4-3-2-发送延时消息" data-v-b57cc07c>4.3.2 发送延时消息</a></li><li class="level-3" data-v-b57cc07c><a href="/Java/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/%E5%88%86%E5%B8%83%E5%BC%8F/%E5%88%86%E5%B8%83%E5%BC%8F%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/RocketMQ/RocketMQ-01.html#_4-3-4-使用限制" class="sidebar-link reco-side-_4-3-4-使用限制" data-v-b57cc07c>4.3.4 使用限制</a></li><li class="level-2" data-v-b57cc07c><a href="/Java/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/%E5%88%86%E5%B8%83%E5%BC%8F/%E5%88%86%E5%B8%83%E5%BC%8F%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/RocketMQ/RocketMQ-01.html#_4-4-批量消息" class="sidebar-link reco-side-_4-4-批量消息" data-v-b57cc07c>4.4 批量消息</a></li><li class="level-3" data-v-b57cc07c><a href="/Java/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/%E5%88%86%E5%B8%83%E5%BC%8F/%E5%88%86%E5%B8%83%E5%BC%8F%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/RocketMQ/RocketMQ-01.html#_4-4-1-发送批量消息" class="sidebar-link reco-side-_4-4-1-发送批量消息" data-v-b57cc07c>4.4.1 发送批量消息</a></li><li class="level-2" data-v-b57cc07c><a href="/Java/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/%E5%88%86%E5%B8%83%E5%BC%8F/%E5%88%86%E5%B8%83%E5%BC%8F%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/RocketMQ/RocketMQ-01.html#_4-5-过滤消息" class="sidebar-link reco-side-_4-5-过滤消息" data-v-b57cc07c>4.5 过滤消息</a></li><li class="level-3" data-v-b57cc07c><a href="/Java/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/%E5%88%86%E5%B8%83%E5%BC%8F/%E5%88%86%E5%B8%83%E5%BC%8F%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/RocketMQ/RocketMQ-01.html#_4-5-1-sql基本语法" class="sidebar-link reco-side-_4-5-1-sql基本语法" data-v-b57cc07c>4.5.1 SQL基本语法</a></li><li class="level-3" data-v-b57cc07c><a href="/Java/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/%E5%88%86%E5%B8%83%E5%BC%8F/%E5%88%86%E5%B8%83%E5%BC%8F%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/RocketMQ/RocketMQ-01.html#_4-5-2-消息生产者" class="sidebar-link reco-side-_4-5-2-消息生产者" data-v-b57cc07c>4.5.2 消息生产者</a></li><li class="level-3" data-v-b57cc07c><a href="/Java/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/%E5%88%86%E5%B8%83%E5%BC%8F/%E5%88%86%E5%B8%83%E5%BC%8F%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/RocketMQ/RocketMQ-01.html#_4-5-3-消息消费者" class="sidebar-link reco-side-_4-5-3-消息消费者" data-v-b57cc07c>4.5.3 消息消费者</a></li><li class="level-2" data-v-b57cc07c><a href="/Java/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/%E5%88%86%E5%B8%83%E5%BC%8F/%E5%88%86%E5%B8%83%E5%BC%8F%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/RocketMQ/RocketMQ-01.html#_4-6-事务消息" class="sidebar-link reco-side-_4-6-事务消息" data-v-b57cc07c>4.6 事务消息</a></li><li class="level-3" data-v-b57cc07c><a href="/Java/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/%E5%88%86%E5%B8%83%E5%BC%8F/%E5%88%86%E5%B8%83%E5%BC%8F%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/RocketMQ/RocketMQ-01.html#_4-6-2-使用限制" class="sidebar-link reco-side-_4-6-2-使用限制" data-v-b57cc07c>4.6.2 使用限制</a></li></ul></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div><div class="reco-bgm-panel" data-v-b1d3339e><audio id="bgm" src="/bgm/天下.mp3" data-v-b1d3339e></audio> <div class="reco-float-box" style="bottom:200px;z-index:999999;display:none;" data-v-b1d3339e data-v-41bcba48 data-v-b1d3339e><img src="/logo2.png" data-v-b1d3339e></div> <div class="reco-bgm-box" style="left:10px;bottom:10px;z-index:999999;" data-v-b1d3339e data-v-41bcba48 data-v-b1d3339e><div class="reco-bgm-cover" style="background-image:url(/logo2.png);" data-v-b1d3339e><div class="mini-operation" style="display:none;" data-v-b1d3339e><i class="reco-bgm reco-bgm-pause" style="display:none;" data-v-b1d3339e></i> <i class="reco-bgm reco-bgm-play" style="display:none;" data-v-b1d3339e></i></div> <div class="falut-message" style="display:none;" data-v-b1d3339e>
          播放失败
        </div></div> <div class="reco-bgm-info" data-v-b1d3339e data-v-41bcba48 data-v-b1d3339e><div class="info-box" data-v-b1d3339e><i class="reco-bgm reco-bgm-music music" data-v-b1d3339e></i>天下</div> <div class="info-box" data-v-b1d3339e><i class="reco-bgm reco-bgm-artist" data-v-b1d3339e></i>张杰</div> <div class="reco-bgm-progress" data-v-b1d3339e><div class="progress-bar" data-v-b1d3339e><div class="bar" data-v-b1d3339e></div></div></div> <div class="reco-bgm-operation" data-v-b1d3339e><i class="reco-bgm reco-bgm-last last" data-v-b1d3339e></i> <i class="reco-bgm reco-bgm-pause pause" style="display:none;" data-v-b1d3339e></i> <i class="reco-bgm reco-bgm-play play" data-v-b1d3339e></i> <i class="reco-bgm reco-bgm-next next" data-v-b1d3339e></i> <i class="reco-bgm reco-bgm-volume1 volume" data-v-b1d3339e></i> <i class="reco-bgm reco-bgm-mute mute" style="display:none;" data-v-b1d3339e></i> <div class="volume-bar" data-v-b1d3339e><div class="bar" data-v-b1d3339e></div></div></div></div> <div class="reco-bgm-left-box" data-v-b1d3339e data-v-41bcba48 data-v-b1d3339e><i class="reco-bgm reco-bgm-left" data-v-b1d3339e></i></div></div></div><!----></div></div>
    <script src="/assets/js/app.66712d02.js" defer></script><script src="/assets/js/11.42113752.js" defer></script><script src="/assets/js/1.dd01b019.js" defer></script><script src="/assets/js/20.074ba45e.js" defer></script><script src="/assets/js/49.36f82c23.js" defer></script>
  </body>
</html>
