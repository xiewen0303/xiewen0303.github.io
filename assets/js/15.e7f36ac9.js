(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{1226:function(s,a,t){"use strict";t.r(a);var e=t(3),n=Object(e.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"nacos注册中心"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nacos注册中心"}},[s._v("#")]),s._v(" Nacos注册中心")]),s._v(" "),a("h2",{attrs:{id:"_1-认识和安装nacos"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-认识和安装nacos"}},[s._v("#")]),s._v(" 1.认识和安装Nacos")]),s._v(" "),a("p",[a("a",{attrs:{href:"https://nacos.io/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Nacos"),a("OutboundLink")],1),s._v("是阿里巴巴的产品，现在是"),a("a",{attrs:{href:"https://spring.io/projects/spring-cloud",target:"_blank",rel:"noopener noreferrer"}},[s._v("SpringCloud"),a("OutboundLink")],1),s._v("中的一个组件。相比"),a("a",{attrs:{href:"https://github.com/Netflix/eureka",target:"_blank",rel:"noopener noreferrer"}},[s._v("Eureka"),a("OutboundLink")],1),s._v("功能更加丰富，在国内受欢迎程度较高。")]),s._v(" "),a("p",[a("img",{attrs:{src:t(592),alt:"image-20210713230444308"}})]),s._v(" "),a("h2",{attrs:{id:"_2-服务注册到nacos"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-服务注册到nacos"}},[s._v("#")]),s._v(" 2.服务注册到nacos")]),s._v(" "),a("p",[s._v("Nacos是SpringCloudAlibaba的组件，而SpringCloudAlibaba也遵循SpringCloud中定义的服务注册、服务发现规范。因此使用Nacos和使用Eureka对于微服务来说，并没有太大区别。")]),s._v(" "),a("p",[s._v("主要差异在于：")]),s._v(" "),a("ul",[a("li",[s._v("依赖不同")]),s._v(" "),a("li",[s._v("服务地址不同")])]),s._v(" "),a("h3",{attrs:{id:"_1-引入依赖"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-引入依赖"}},[s._v("#")]),s._v(" 1）引入依赖")]),s._v(" "),a("p",[s._v("在cloud-demo父工程的pom文件中的"),a("code",[s._v("<dependencyManagement>")]),s._v("中引入SpringCloudAlibaba的依赖：")]),s._v(" "),a("div",{staticClass:"language-xml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-xml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("dependency")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("groupId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("com.alibaba.cloud"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("groupId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("artifactId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("spring-cloud-alibaba-dependencies"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("artifactId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("2.2.6.RELEASE"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("pom"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("scope")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("import"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("scope")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("dependency")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[s._v("然后在user-service和order-service中的pom文件中引入nacos-discovery依赖：")]),s._v(" "),a("div",{staticClass:"language-xml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-xml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("dependency")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("groupId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("com.alibaba.cloud"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("groupId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("artifactId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("spring-cloud-starter-alibaba-nacos-discovery"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("artifactId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("dependency")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("blockquote",[a("p",[a("strong",[s._v("注意")]),s._v("：不要忘了注释掉eureka的依赖。")])]),s._v(" "),a("h3",{attrs:{id:"_2-配置nacos地址"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-配置nacos地址"}},[s._v("#")]),s._v(" 2）配置nacos地址")]),s._v(" "),a("p",[s._v("在user-service和order-service的application.yml中添加nacos地址：")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spring")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("cloud")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("nacos")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("server-addr")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" localhost"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8848")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("blockquote",[a("p",[a("strong",[s._v("注意")]),s._v("：不要忘了注释掉eureka的地址")])]),s._v(" "),a("h3",{attrs:{id:"_3-重启"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-重启"}},[s._v("#")]),s._v(" 3）重启")]),s._v(" "),a("p",[s._v("重启微服务后，登录nacos管理页面，可以看到微服务信息：")]),s._v(" "),a("p",[a("img",{attrs:{src:t(593),alt:"image-20210713231439607"}})]),s._v(" "),a("h2",{attrs:{id:"_3-服务分级存储模型"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-服务分级存储模型"}},[s._v("#")]),s._v(" 3.服务分级存储模型")]),s._v(" "),a("p",[s._v("一个"),a("strong",[s._v("服务")]),s._v("可以有多个"),a("strong",[s._v("实例")]),s._v("，例如user-service，可以有:")]),s._v(" "),a("ul",[a("li",[s._v("127.0.0.1:8081")]),s._v(" "),a("li",[s._v("127.0.0.1:8082")]),s._v(" "),a("li",[s._v("127.0.0.1:8083")])]),s._v(" "),a("p",[s._v("假如这些实例分布于全国各地的不同机房，例如：")]),s._v(" "),a("ul",[a("li",[s._v("127.0.0.1:8081，在上海机房")]),s._v(" "),a("li",[s._v("127.0.0.1:8082，在上海机房")]),s._v(" "),a("li",[s._v("127.0.0.1:8083，在杭州机房")])]),s._v(" "),a("p",[s._v("Nacos就将同一机房内的实例 划分为一个"),a("strong",[s._v("集群")]),s._v("。")]),s._v(" "),a("p",[s._v("也就是说，user-service是服务，一个服务可以包含多个集群，如杭州、上海，每个集群下可以有多个实例，形成分级模型，如图：")]),s._v(" "),a("p",[a("img",{attrs:{src:t(594),alt:"image-20210713232522531"}})]),s._v(" "),a("p",[s._v("微服务互相访问时，应该尽可能访问同集群实例，因为本地访问速度更快。当本集群内不可用时，才访问其它集群。例如：")]),s._v(" "),a("p",[a("img",{attrs:{src:t(595),alt:"image-20210713232658928"}})]),s._v(" "),a("p",[s._v("杭州机房内的order-service应该优先访问同机房的user-service。")]),s._v(" "),a("h3",{attrs:{id:"_5-3-1-给user-service配置集群"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-3-1-给user-service配置集群"}},[s._v("#")]),s._v(" 5.3.1.给user-service配置集群")]),s._v(" "),a("p",[s._v("修改user-service的application.yml文件，添加集群配置：")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spring")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("cloud")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("nacos")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("server-addr")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" localhost"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8848")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("discovery")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("cluster-name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" HZ "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 集群名称")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("重启两个user-service实例后，我们可以在nacos控制台看到下面结果：")]),s._v(" "),a("p",[a("img",{attrs:{src:t(596),alt:"image-20210713232916215"}})]),s._v(" "),a("p",[s._v("我们再次复制一个user-service启动配置，添加属性：")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-Dserver.port")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8083")]),s._v(" -Dspring.cloud.nacos.discovery.cluster-name"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("SH\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("配置如图所示：")]),s._v(" "),a("p",[a("img",{attrs:{src:t(597),alt:"image-20210713233528982"}})]),s._v(" "),a("p",[s._v("启动UserApplication3后再次查看nacos控制台：")]),s._v(" "),a("p",[a("img",{attrs:{src:t(598),alt:"image-20210713233727923"}})]),s._v(" "),a("h3",{attrs:{id:"_5-3-2-同集群优先的负载均衡"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-3-2-同集群优先的负载均衡"}},[s._v("#")]),s._v(" 5.3.2.同集群优先的负载均衡")]),s._v(" "),a("p",[s._v("默认的"),a("code",[s._v("ZoneAvoidanceRule")]),s._v("并不能实现根据同集群优先来实现负载均衡。")]),s._v(" "),a("p",[s._v("因此Nacos中提供了一个"),a("code",[s._v("NacosRule")]),s._v("的实现，可以优先从同集群中挑选实例。")]),s._v(" "),a("p",[s._v("1）给order-service配置集群信息")]),s._v(" "),a("p",[s._v("修改order-service的application.yml文件，添加集群配置：")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("spring:\n  cloud:\n    nacos:\n      server-addr: localhost:8848\n      discovery:\n        cluster-name: HZ "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 集群名称")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("2）修改负载均衡规则")]),s._v(" "),a("p",[s._v("修改order-service的application.yml文件，修改负载均衡规则：")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("userservice")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ribbon")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("NFLoadBalancerRuleClassName")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" com.alibaba.cloud.nacos.ribbon.NacosRule "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 负载均衡规则 ")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h2",{attrs:{id:"_4-权重配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-权重配置"}},[s._v("#")]),s._v(" 4.权重配置")]),s._v(" "),a("p",[s._v("实际部署中会出现这样的场景：")]),s._v(" "),a("p",[s._v("服务器设备性能有差异，部分实例所在机器性能较好，另一些较差，我们希望性能好的机器承担更多的用户请求。")]),s._v(" "),a("p",[s._v("但默认情况下NacosRule是同集群内随机挑选，不会考虑机器的性能问题。")]),s._v(" "),a("p",[s._v("因此，Nacos提供了权重配置来控制访问频率，权重越大则访问频率越高。")]),s._v(" "),a("p",[s._v("在nacos控制台，找到user-service的实例列表，点击编辑，即可修改权重：")]),s._v(" "),a("p",[a("img",{attrs:{src:t(599),alt:"image-20210713235133225"}})]),s._v(" "),a("p",[s._v("在弹出的编辑窗口，修改权重：")]),s._v(" "),a("p",[a("img",{attrs:{src:t(600),alt:"image-20210713235235219"}})]),s._v(" "),a("blockquote",[a("p",[a("strong",[s._v("注意")]),s._v("：如果权重修改为0，则该实例永远不会被访问")])]),s._v(" "),a("h2",{attrs:{id:"_5-环境隔离"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-环境隔离"}},[s._v("#")]),s._v(" 5.环境隔离")]),s._v(" "),a("p",[s._v("Nacos提供了namespace来实现环境隔离功能。")]),s._v(" "),a("ul",[a("li",[s._v("nacos中可以有多个namespace")]),s._v(" "),a("li",[s._v("namespace下可以有group、service等")]),s._v(" "),a("li",[s._v("不同namespace之间相互隔离，例如不同namespace的服务互相不可见")])]),s._v(" "),a("p",[a("img",{attrs:{src:t(601),alt:"image-20210714000101516"}})]),s._v(" "),a("h3",{attrs:{id:"_5-5-1-创建namespace"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-5-1-创建namespace"}},[s._v("#")]),s._v(" 5.5.1.创建namespace")]),s._v(" "),a("p",[s._v("默认情况下，所有service、data、group都在同一个namespace，名为public：")]),s._v(" "),a("p",[a("img",{attrs:{src:t(602),alt:"image-20210714000414781"}})]),s._v(" "),a("p",[s._v("我们可以点击页面新增按钮，添加一个namespace：")]),s._v(" "),a("p",[a("img",{attrs:{src:t(603),alt:"image-20210714000440143"}})]),s._v(" "),a("p",[s._v("然后，填写表单：")]),s._v(" "),a("p",[a("img",{attrs:{src:t(604),alt:"image-20210714000505928"}})]),s._v(" "),a("p",[s._v("就能在页面看到一个新的namespace：")]),s._v(" "),a("p",[a("img",{attrs:{src:t(605),alt:"image-20210714000522913"}})]),s._v(" "),a("h3",{attrs:{id:"_5-5-2-给微服务配置namespace"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-5-2-给微服务配置namespace"}},[s._v("#")]),s._v(" 5.5.2.给微服务配置namespace")]),s._v(" "),a("p",[s._v("给微服务配置namespace只能通过修改配置来实现。")]),s._v(" "),a("p",[s._v("例如，修改order-service的application.yml文件：")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spring")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("cloud")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("nacos")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("server-addr")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" localhost"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8848")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("discovery")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("cluster-name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" HZ\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("namespace")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 492a7d5d"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("237b"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("46a1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("a99a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("fa8e98e4b0f9 "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 命名空间，填ID")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[s._v("重启order-service后，访问控制台，可以看到下面的结果：")]),s._v(" "),a("p",[a("img",{attrs:{src:t(606),alt:"image-20210714000830703"}})]),s._v(" "),a("p",[a("img",{attrs:{src:t(607),alt:"image-20210714000837140"}})]),s._v(" "),a("p",[s._v("此时访问order-service，因为namespace不同，会导致找不到userservice，控制台会报错：")]),s._v(" "),a("p",[a("img",{attrs:{src:t(608),alt:"image-20210714000941256"}})]),s._v(" "),a("h2",{attrs:{id:"_6-nacos与eureka的区别"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-nacos与eureka的区别"}},[s._v("#")]),s._v(" 6.Nacos与Eureka的区别")]),s._v(" "),a("p",[s._v("Nacos的服务实例分为两种l类型：")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("临时实例：如果实例宕机超过一定时间，会从服务列表剔除，默认的类型。")])]),s._v(" "),a("li",[a("p",[s._v("非临时实例：如果实例宕机，不会从服务列表剔除，也可以叫永久实例。")])])]),s._v(" "),a("p",[s._v("配置一个服务实例为永久实例：")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spring")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("cloud")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("nacos")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("discovery")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ephemeral")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("false")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置为非临时实例")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("Nacos和Eureka整体结构类似，服务注册、服务拉取、心跳等待，但是也存在一些差异：")]),s._v(" "),a("p",[a("img",{attrs:{src:t(609),alt:"image-20210714001728017"}})]),s._v(" "),a("ul",[a("li",[a("p",[s._v("Nacos与eureka的共同点")]),s._v(" "),a("ul",[a("li",[s._v("都支持服务注册和服务拉取")]),s._v(" "),a("li",[s._v("都支持服务提供者心跳方式做健康检测")])])]),s._v(" "),a("li",[a("p",[s._v("Nacos与Eureka的区别")]),s._v(" "),a("ul",[a("li",[s._v("Nacos支持服务端主动检测提供者状态：临时实例采用心跳模式，非临时实例采用主动检测模式")]),s._v(" "),a("li",[s._v("临时实例心跳不正常会被剔除，非临时实例则不会被剔除")]),s._v(" "),a("li",[s._v("Nacos支持服务列表变更的消息推送模式，服务列表更新更及时")]),s._v(" "),a("li",[s._v("Nacos集群默认采用AP方式，当集群中存在非临时实例时，采用CP模式；Eureka采用AP方式")])])])])])}),[],!1,null,null,null);a.default=n.exports},592:function(s,a,t){s.exports=t.p+"assets/img/image-20210713230444308.142c8955.png"},593:function(s,a,t){s.exports=t.p+"assets/img/image-20210713231439607.eafb858e.png"},594:function(s,a,t){s.exports=t.p+"assets/img/image-20210713232522531.0c1c87e7.png"},595:function(s,a,t){s.exports=t.p+"assets/img/image-20210713232658928.9f26138f.png"},596:function(s,a,t){s.exports=t.p+"assets/img/image-20210713232916215.f7fa2928.png"},597:function(s,a,t){s.exports=t.p+"assets/img/image-20210713233528982.26978d78.png"},598:function(s,a,t){s.exports=t.p+"assets/img/image-20210713233727923.74a4c70a.png"},599:function(s,a,t){s.exports=t.p+"assets/img/image-20210713235133225.4dd758c0.png"},600:function(s,a,t){s.exports=t.p+"assets/img/image-20210713235235219.18b215fa.png"},601:function(s,a,t){s.exports=t.p+"assets/img/image-20210714000101516.382dff09.png"},602:function(s,a,t){s.exports=t.p+"assets/img/image-20210714000414781.158a77ed.png"},603:function(s,a,t){s.exports=t.p+"assets/img/image-20210714000440143.696641e9.png"},604:function(s,a,t){s.exports=t.p+"assets/img/image-20210714000505928.95069944.png"},605:function(s,a,t){s.exports=t.p+"assets/img/image-20210714000522913.42c42c38.png"},606:function(s,a,t){s.exports=t.p+"assets/img/image-20210714000830703.e601f03b.png"},607:function(s,a,t){s.exports=t.p+"assets/img/image-20210714000837140.e7783d8d.png"},608:function(s,a,t){s.exports=t.p+"assets/img/image-20210714000941256.1252aee0.png"},609:function(s,a,t){s.exports=t.p+"assets/img/image-20210714001728017.98fc233f.png"}}]);