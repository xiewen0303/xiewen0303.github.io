(window.webpackJsonp=window.webpackJsonp||[]).push([[126],{1280:function(s,n,a){"use strict";a.r(n);var t=a(3),e=Object(t.a)({},(function(){var s=this,n=s._self._c;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h2",{attrs:{id:"一、nginx安装"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#一、nginx安装"}},[s._v("#")]),s._v(" 一、Nginx安装")]),s._v(" "),n("h3",{attrs:{id:"_1、基于apt源安装"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1、基于apt源安装"}},[s._v("#")]),s._v(" 1、基于APT源安装")]),s._v(" "),n("div",{staticClass:"language-csharp line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-csharp"}},[n("code",[s._v("sudo apt"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("get")]),s._v(" install nginx\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("安装好的文件位置：")]),s._v(" "),n("ul",[n("li",[s._v("/usr/sbin/nginx：主程序")]),s._v(" "),n("li",[s._v("/etc/nginx：存放配置文件")]),s._v(" "),n("li",[s._v("/usr/share/nginx：存放静态文件")]),s._v(" "),n("li",[s._v("/var/log/nginx：存放日志")])]),s._v(" "),n("p",[s._v("基于APT安装会自动创建服务，会自动在/etc/init.d/nginx新建服务脚本")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" nginx "),n("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-s")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("start"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("stop"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("restart"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("reload"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("force-reload"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("status"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("configtest"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("rotate"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("upgrade"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("h3",{attrs:{id:"_2、通过源码包编译安装"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2、通过源码包编译安装"}},[s._v("#")]),s._v(" 2、通过源码包编译安装")]),s._v(" "),n("p",[s._v("这种方式可以自定安装指定的模块以及最新的版本，方式更灵活。")]),s._v(" "),n("blockquote",[n("p",[s._v("官方下载页面：http://nginx.org/en/download.html")]),s._v(" "),n("p",[s._v("configure配置文件详解：http://nginx.org/en/docs/configure.html")])]),s._v(" "),n("p",[s._v("安装gcc g++的依赖库")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" build-essential\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" libtool\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("p",[s._v("安装pcre依赖库（http://www.pcre.org/）")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" update\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" libpcre3 libpcre3-dev\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("p",[s._v("安装zlib依赖库（http://www.zlib.net）")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" zlib1g-dev\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("安装SSL依赖库")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" openssl\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("安装Nginx")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#下载最新版本：")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" http://nginx.org/download/nginx-1.13.6.tar.gz\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#解压：")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-zxvf")]),s._v(" nginx-1.13.6.tar.gz\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#进入解压目录：")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" nginx-1.13.6\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#配置：")]),s._v("\n./configure "),n("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--prefix")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/local/nginx \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#编译：")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#安装：")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#启动：")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" /usr/local/nginx/sbin/nginx "),n("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" /usr/local/nginx/conf/nginx.conf\n注意：-c 指定配置文件的路径，不加的话，nginx会自动加载默认路径的配置文件，可以通过-h查看帮助命令。\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看进程：")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-ef")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" nginx\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br")])]),n("p",[s._v("配置软链接")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ln")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-s")]),s._v(" /usr/local/nginx/sbin/nginx /usr/bin/nginx\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("现在就可以不用路径直接输入nginx启动。")]),s._v(" "),n("h2",{attrs:{id:"二、配置开机启动服务"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#二、配置开机启动服务"}},[s._v("#")]),s._v(" 二、配置开机启动服务")]),s._v(" "),n("h3",{attrs:{id:"_1、方法一"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1、方法一"}},[s._v("#")]),s._v(" 1、方法一：")]),s._v(" "),n("p",[s._v("在/etc/init.d/下创建nginx文件，sudo vim /etc/init.d/nginx，内容如下：")]),s._v(" "),n("div",{staticClass:"language-nginx line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-nginx"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#!/bin/sh")]),s._v("\n \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("### BEGIN INIT INFO")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Provides:      nginx")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Required-Start:    $local_fs $remote_fs $network $syslog $named")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Required-Stop:     $local_fs $remote_fs $network $syslog $named")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Default-Start:     2 3 4 5")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Default-Stop:      0 1 6")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Short-Description: starts the nginx web server")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Description:       starts nginx using start-stop-daemon")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("### END INIT INFO")]),s._v("\n \n"),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin")]),s._v("\nDAEMON=/usr/local/nginx/sbin/nginx\nNAME=nginx\nDESC=nginx\n \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Include nginx defaults if available")]),s._v("\nif [ -r /etc/default/nginx ]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n    . /etc/default/nginx\nfi\n \nSTOP_SCHEDULE="),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${STOP_SCHEDULE:-QUIT/5/TERM/5/KILL/5}")]),s._v('"')]),s._v("\n \ntest -x "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$DAEMON")]),s._v(" || exit "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n \n. /lib/init/vars.sh\n. /lib/lsb/init-functions\n \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Try to extract nginx pidfile")]),s._v("\nPID=$(cat /usr/local/nginx/conf/nginx.conf | grep -Ev "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'^\\s*#'")]),s._v(" | awk "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'BEGIN { RS="[;{}]" } { if ('),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),s._v(' == "pid") print '),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$2")]),s._v(" }'")]),s._v(" | head -n1)\nif [ -z "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$PID")]),s._v('"')]),s._v(" ]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n    PID=/run/nginx.pid\nfi\n \nif [ -n "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$ULIMIT")]),s._v('"')]),s._v(" ]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Set ulimit if it is set in /etc/default/nginx")]),s._v("\n    ulimit "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$ULIMIT")]),s._v("\nfi\n \nstart_nginx()")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Start the daemon/service")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Returns:")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   0 if daemon has been started")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   1 if daemon was already running")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   2 if daemon could not be started")]),s._v("\n    start-stop-daemon --start --quiet --pidfile $PID --exec $DAEMON --test > /dev/null \\\n        || return 1\n    start-stop-daemon --start --quiet --pidfile $PID --exec $DAEMON -- \\\n        $DAEMON_OPTS 2>/dev/null \\\n        || return 2\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n \n"),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("test_config()")])]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Test the nginx configuration")]),s._v("\n    $DAEMON -t $DAEMON_OPTS >/dev/null 2>&1\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n \n"),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("stop_nginx()")])]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Stops the daemon/service")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Return")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   0 if daemon has been stopped")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   1 if daemon was already stopped")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   2 if daemon could not be stopped")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   other if a failure occurred")]),s._v('\n    start-stop-daemon --stop --quiet --retry=$STOP_SCHEDULE --pidfile $PID --name $NAME\n    RETVAL="$?"\n    sleep 1\n    return "$RETVAL"\n'),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n \n"),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("reload_nginx()")])]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Function that sends a SIGHUP to the daemon/service")]),s._v("\n    start-stop-daemon --stop --signal HUP --quiet --pidfile $PID --name $NAME\n    return 0\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n \n"),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rotate_logs()")])]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Rotate log files")]),s._v("\n    start-stop-daemon --stop --signal USR1 --quiet --pidfile $PID --name $NAME\n    return 0\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n \n"),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("upgrade_nginx()")])]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Online upgrade nginx executable")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# http://nginx.org/en/docs/control.html")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Return")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   0 if nginx has been successfully upgraded")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   1 if nginx is not running")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   2 if the pid files were not created on time")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   3 if the old master could not be killed")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" start-stop-daemon --stop --signal USR2 --quiet --pidfile "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$PID")]),s._v(" --name "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$NAME")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Wait for both old and new master to write their pid file")]),s._v("\n        while [ ! -s "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${PID}")]),s._v('.oldbin"')]),s._v(" ] || [ ! -s "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${PID}")]),s._v('"')]),s._v(" ]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),s._v("\n            cnt=`expr "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$cnt")]),s._v(" + 1`\n            if [ "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$cnt")]),s._v(" -gt "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" ]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n                return "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n            fi\n            sleep "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n        done\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Everything is ready, gracefully stop the old master")]),s._v("\n        if start-stop-daemon --stop --signal QUIT --quiet --pidfile "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${PID}")]),s._v('.oldbin"')]),s._v(" --name "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$NAME")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" then\n            return 0\n        else\n            return 3\n        fi\n    else\n        return 1\n    fi\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n \n"),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("case")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),s._v('"')]),s._v(" in\n    start)\n        log_daemon_msg "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Starting '),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$DESC")]),s._v('"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$NAME")]),s._v('"')]),s._v("\n        start_nginx\n        case "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"$?"')]),s._v(" in\n            0|1) log_end_msg "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")])]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("2)")]),s._v("   log_end_msg "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")])]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("esac")])]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("stop)")]),s._v("\n        log_daemon_msg "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Stopping '),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$DESC")]),s._v('"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$NAME")]),s._v('"')]),s._v("\n        stop_nginx\n        case "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"$?"')]),s._v(" in\n            0|1) log_end_msg "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")])]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("2)")]),s._v("   log_end_msg "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")])]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("esac")])]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("restart)")]),s._v("\n        log_daemon_msg "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Restarting '),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$DESC")]),s._v('"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$NAME")]),s._v('"')]),s._v("\n \n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Check configuration before stopping nginx")]),s._v("\n        if ! test_config")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n            log_end_msg "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Configuration error")]),s._v("\n            exit $?\n        fi\n \n        stop_nginx\n        case "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"$?"')]),s._v(" in\n            0|1)\n                start_nginx\n                case "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"$?"')]),s._v(" in\n                    0) log_end_msg "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")])]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                    "),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("1)")]),s._v(" log_end_msg "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")])]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Old process is still running")]),s._v("\n                    *) "),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("log_end_msg")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")])]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Failed to start")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("esac")])]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            *)\n                "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Failed to stop")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("log_end_msg")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")])]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("esac")])]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("reload|force-reload)")]),s._v("\n        log_daemon_msg "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Reloading '),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$DESC")]),s._v(' configuration"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$NAME")]),s._v('"')]),s._v("\n \n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Check configuration before stopping nginx")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# This is not entirely correct since the on-disk nginx binary")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# may differ from the in-memory one, but that's not common.")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# We prefer to check the configuration and return an error")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# to the administrator.")]),s._v("\n        if ! test_config")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n            log_end_msg "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Configuration error")]),s._v("\n            exit $?\n        fi\n \n        reload_nginx\n        log_end_msg $?")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("configtest|testconfig)")]),s._v("\n        log_daemon_msg "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Testing '),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$DESC")]),s._v(' configuration"')]),s._v("\n        test_config\n        log_end_msg $?")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("status)")]),s._v("\n        status_of_proc -p "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$PID")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$DAEMON")]),s._v('"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$NAME")]),s._v('"')]),s._v(" && exit "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" || exit $?")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("upgrade)")]),s._v("\n        log_daemon_msg "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Upgrading binary"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$NAME")]),s._v('"')]),s._v("\n        upgrade_nginx\n        log_end_msg $?")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rotate)")]),s._v("\n        log_daemon_msg "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Re-opening '),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$DESC")]),s._v(' log files"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$NAME")]),s._v('"')]),s._v("\n        rotate_logs\n        log_end_msg $?")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    *)\n        "),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Usage: '),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$NAME")]),s._v(' {start|stop|restart|reload|force-reload|status|configtest|rotate|upgrade}"')]),s._v(" >&2\n        exit "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")])]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nesac\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br"),n("span",{staticClass:"line-number"},[s._v("64")]),n("br"),n("span",{staticClass:"line-number"},[s._v("65")]),n("br"),n("span",{staticClass:"line-number"},[s._v("66")]),n("br"),n("span",{staticClass:"line-number"},[s._v("67")]),n("br"),n("span",{staticClass:"line-number"},[s._v("68")]),n("br"),n("span",{staticClass:"line-number"},[s._v("69")]),n("br"),n("span",{staticClass:"line-number"},[s._v("70")]),n("br"),n("span",{staticClass:"line-number"},[s._v("71")]),n("br"),n("span",{staticClass:"line-number"},[s._v("72")]),n("br"),n("span",{staticClass:"line-number"},[s._v("73")]),n("br"),n("span",{staticClass:"line-number"},[s._v("74")]),n("br"),n("span",{staticClass:"line-number"},[s._v("75")]),n("br"),n("span",{staticClass:"line-number"},[s._v("76")]),n("br"),n("span",{staticClass:"line-number"},[s._v("77")]),n("br"),n("span",{staticClass:"line-number"},[s._v("78")]),n("br"),n("span",{staticClass:"line-number"},[s._v("79")]),n("br"),n("span",{staticClass:"line-number"},[s._v("80")]),n("br"),n("span",{staticClass:"line-number"},[s._v("81")]),n("br"),n("span",{staticClass:"line-number"},[s._v("82")]),n("br"),n("span",{staticClass:"line-number"},[s._v("83")]),n("br"),n("span",{staticClass:"line-number"},[s._v("84")]),n("br"),n("span",{staticClass:"line-number"},[s._v("85")]),n("br"),n("span",{staticClass:"line-number"},[s._v("86")]),n("br"),n("span",{staticClass:"line-number"},[s._v("87")]),n("br"),n("span",{staticClass:"line-number"},[s._v("88")]),n("br"),n("span",{staticClass:"line-number"},[s._v("89")]),n("br"),n("span",{staticClass:"line-number"},[s._v("90")]),n("br"),n("span",{staticClass:"line-number"},[s._v("91")]),n("br"),n("span",{staticClass:"line-number"},[s._v("92")]),n("br"),n("span",{staticClass:"line-number"},[s._v("93")]),n("br"),n("span",{staticClass:"line-number"},[s._v("94")]),n("br"),n("span",{staticClass:"line-number"},[s._v("95")]),n("br"),n("span",{staticClass:"line-number"},[s._v("96")]),n("br"),n("span",{staticClass:"line-number"},[s._v("97")]),n("br"),n("span",{staticClass:"line-number"},[s._v("98")]),n("br"),n("span",{staticClass:"line-number"},[s._v("99")]),n("br"),n("span",{staticClass:"line-number"},[s._v("100")]),n("br"),n("span",{staticClass:"line-number"},[s._v("101")]),n("br"),n("span",{staticClass:"line-number"},[s._v("102")]),n("br"),n("span",{staticClass:"line-number"},[s._v("103")]),n("br"),n("span",{staticClass:"line-number"},[s._v("104")]),n("br"),n("span",{staticClass:"line-number"},[s._v("105")]),n("br"),n("span",{staticClass:"line-number"},[s._v("106")]),n("br"),n("span",{staticClass:"line-number"},[s._v("107")]),n("br"),n("span",{staticClass:"line-number"},[s._v("108")]),n("br"),n("span",{staticClass:"line-number"},[s._v("109")]),n("br"),n("span",{staticClass:"line-number"},[s._v("110")]),n("br"),n("span",{staticClass:"line-number"},[s._v("111")]),n("br"),n("span",{staticClass:"line-number"},[s._v("112")]),n("br"),n("span",{staticClass:"line-number"},[s._v("113")]),n("br"),n("span",{staticClass:"line-number"},[s._v("114")]),n("br"),n("span",{staticClass:"line-number"},[s._v("115")]),n("br"),n("span",{staticClass:"line-number"},[s._v("116")]),n("br"),n("span",{staticClass:"line-number"},[s._v("117")]),n("br"),n("span",{staticClass:"line-number"},[s._v("118")]),n("br"),n("span",{staticClass:"line-number"},[s._v("119")]),n("br"),n("span",{staticClass:"line-number"},[s._v("120")]),n("br"),n("span",{staticClass:"line-number"},[s._v("121")]),n("br"),n("span",{staticClass:"line-number"},[s._v("122")]),n("br"),n("span",{staticClass:"line-number"},[s._v("123")]),n("br"),n("span",{staticClass:"line-number"},[s._v("124")]),n("br"),n("span",{staticClass:"line-number"},[s._v("125")]),n("br"),n("span",{staticClass:"line-number"},[s._v("126")]),n("br"),n("span",{staticClass:"line-number"},[s._v("127")]),n("br"),n("span",{staticClass:"line-number"},[s._v("128")]),n("br"),n("span",{staticClass:"line-number"},[s._v("129")]),n("br"),n("span",{staticClass:"line-number"},[s._v("130")]),n("br"),n("span",{staticClass:"line-number"},[s._v("131")]),n("br"),n("span",{staticClass:"line-number"},[s._v("132")]),n("br"),n("span",{staticClass:"line-number"},[s._v("133")]),n("br"),n("span",{staticClass:"line-number"},[s._v("134")]),n("br"),n("span",{staticClass:"line-number"},[s._v("135")]),n("br"),n("span",{staticClass:"line-number"},[s._v("136")]),n("br"),n("span",{staticClass:"line-number"},[s._v("137")]),n("br"),n("span",{staticClass:"line-number"},[s._v("138")]),n("br"),n("span",{staticClass:"line-number"},[s._v("139")]),n("br"),n("span",{staticClass:"line-number"},[s._v("140")]),n("br"),n("span",{staticClass:"line-number"},[s._v("141")]),n("br"),n("span",{staticClass:"line-number"},[s._v("142")]),n("br"),n("span",{staticClass:"line-number"},[s._v("143")]),n("br"),n("span",{staticClass:"line-number"},[s._v("144")]),n("br"),n("span",{staticClass:"line-number"},[s._v("145")]),n("br"),n("span",{staticClass:"line-number"},[s._v("146")]),n("br"),n("span",{staticClass:"line-number"},[s._v("147")]),n("br"),n("span",{staticClass:"line-number"},[s._v("148")]),n("br"),n("span",{staticClass:"line-number"},[s._v("149")]),n("br"),n("span",{staticClass:"line-number"},[s._v("150")]),n("br"),n("span",{staticClass:"line-number"},[s._v("151")]),n("br"),n("span",{staticClass:"line-number"},[s._v("152")]),n("br"),n("span",{staticClass:"line-number"},[s._v("153")]),n("br"),n("span",{staticClass:"line-number"},[s._v("154")]),n("br"),n("span",{staticClass:"line-number"},[s._v("155")]),n("br"),n("span",{staticClass:"line-number"},[s._v("156")]),n("br"),n("span",{staticClass:"line-number"},[s._v("157")]),n("br"),n("span",{staticClass:"line-number"},[s._v("158")]),n("br"),n("span",{staticClass:"line-number"},[s._v("159")]),n("br"),n("span",{staticClass:"line-number"},[s._v("160")]),n("br"),n("span",{staticClass:"line-number"},[s._v("161")]),n("br"),n("span",{staticClass:"line-number"},[s._v("162")]),n("br"),n("span",{staticClass:"line-number"},[s._v("163")]),n("br"),n("span",{staticClass:"line-number"},[s._v("164")]),n("br"),n("span",{staticClass:"line-number"},[s._v("165")]),n("br"),n("span",{staticClass:"line-number"},[s._v("166")]),n("br"),n("span",{staticClass:"line-number"},[s._v("167")]),n("br"),n("span",{staticClass:"line-number"},[s._v("168")]),n("br"),n("span",{staticClass:"line-number"},[s._v("169")]),n("br"),n("span",{staticClass:"line-number"},[s._v("170")]),n("br"),n("span",{staticClass:"line-number"},[s._v("171")]),n("br"),n("span",{staticClass:"line-number"},[s._v("172")]),n("br"),n("span",{staticClass:"line-number"},[s._v("173")]),n("br"),n("span",{staticClass:"line-number"},[s._v("174")]),n("br"),n("span",{staticClass:"line-number"},[s._v("175")]),n("br"),n("span",{staticClass:"line-number"},[s._v("176")]),n("br"),n("span",{staticClass:"line-number"},[s._v("177")]),n("br"),n("span",{staticClass:"line-number"},[s._v("178")]),n("br"),n("span",{staticClass:"line-number"},[s._v("179")]),n("br"),n("span",{staticClass:"line-number"},[s._v("180")]),n("br"),n("span",{staticClass:"line-number"},[s._v("181")]),n("br"),n("span",{staticClass:"line-number"},[s._v("182")]),n("br"),n("span",{staticClass:"line-number"},[s._v("183")]),n("br"),n("span",{staticClass:"line-number"},[s._v("184")]),n("br"),n("span",{staticClass:"line-number"},[s._v("185")]),n("br"),n("span",{staticClass:"line-number"},[s._v("186")]),n("br"),n("span",{staticClass:"line-number"},[s._v("187")]),n("br"),n("span",{staticClass:"line-number"},[s._v("188")]),n("br"),n("span",{staticClass:"line-number"},[s._v("189")]),n("br"),n("span",{staticClass:"line-number"},[s._v("190")]),n("br"),n("span",{staticClass:"line-number"},[s._v("191")]),n("br"),n("span",{staticClass:"line-number"},[s._v("192")]),n("br"),n("span",{staticClass:"line-number"},[s._v("193")]),n("br"),n("span",{staticClass:"line-number"},[s._v("194")]),n("br"),n("span",{staticClass:"line-number"},[s._v("195")]),n("br"),n("span",{staticClass:"line-number"},[s._v("196")]),n("br")])]),n("p",[s._v("设置执行权限")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#设置服务脚本有执行权限")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" +x /etc/init.d/nginx\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#注册服务")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /etc/init.d/\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" update-rc.d nginx defaults\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("h3",{attrs:{id:"_2、方法二"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2、方法二"}},[s._v("#")]),s._v(" 2、方法二：")]),s._v(" "),n("p",[s._v("在/usr/lib/systemd/system目录下新建nginx.service文件，内容如下")]),s._v(" "),n("div",{staticClass:"language-nginx line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-nginx"}},[n("code",[s._v("[Unit]\nDescription=nginx - high performance web server\nAfter=network.target remote-fs.target nss-lookup.target\n \n[Service]\nType=forking\nExecStart=/usr/local/nginx/sbin/nginx -c /usr/local/nginx/conf/nginx.conf\nExecReload=/usr/local/nginx/sbin/nginx -s reload\nExecStop=/usr/local/nginx/sbin/nginx -s stop\n \n[Install]\nWantedBy=multi-user.target\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br")])]),n("p",[s._v("脚本解释：")]),s._v(" "),n("ul",[n("li",[s._v("Unit：服务的启动顺序和依赖关系；")]),s._v(" "),n("li",[s._v("Description：对该服务的描述；")]),s._v(" "),n("li",[s._v("After：在b.target服务组启动后，再启动本服务；")]),s._v(" "),n("li",[s._v("Service:服务具体执行的方式；")]),s._v(" "),n("li",[s._v("ExecStart,ExecStop,ExecReload等：启动命令组，分别是服务启动时，停止时，重启时，启动前，启动后，停止后执行的命令；")]),s._v(" "),n("li",[s._v("Type：服务启动类型。默认simple表示ExecStart为主进程，notify类似于simple，启动结束后会发出通知信号。另外还有forking,oneshot,dbus,idle等类型；")]),s._v(" "),n("li",[s._v("Install：把服务放在哪个服务组；")]),s._v(" "),n("li",[s._v("WantedBy：服务所在的服务组。")])]),s._v(" "),n("blockquote",[n("p",[s._v("Ubuntu：systemd的.service服务文件配置参考：https://blog.csdn.net/qq_41035283/article/details/122793745")])]),s._v(" "),n("p",[n("strong",[s._v("设置开机自启动并启动nginx")])]),s._v(" "),n("p",[s._v("设置开机自启动：")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[s._v("systemctl "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" nginx.service\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("查看是否正确启动：")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[s._v("systemctl list-unit-files "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" nginx\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("看下如下图就成功启动了")]),s._v(" "),n("p",[s._v("启动Nginx：")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[s._v("systemctl start nginx.service\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("其他常用命令：")]),s._v(" "),n("ul",[n("li",[s._v("开启开机自启动：systemctl enable nginx.service")]),s._v(" "),n("li",[s._v("停止开机自启动：systemctl disable nginx.service")]),s._v(" "),n("li",[s._v("启动 nginx 服务：systemctl start nginx.service")]),s._v(" "),n("li",[s._v("停止 nginx 服务：systemctl stop nginx.service")]),s._v(" "),n("li",[s._v("重启 nginx 服务：systemctl restart nginx.service")]),s._v(" "),n("li",[s._v("查看服务当前状态： systemctl status nginx.service")]),s._v(" "),n("li",[s._v("查看所有已启动的服务：systemctl list-units --type=service")])]),s._v(" "),n("h2",{attrs:{id:"问题"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#问题"}},[s._v("#")]),s._v(" 问题")]),s._v(" "),n("p",[s._v('nginx: [error] open() "/usr/local/nginx/logs/nginx.pid" failed (2: No such file or directory)')]),s._v(" "),n("p",[s._v("https://blog.csdn.net/xinxian1768/article/details/131165831")]),s._v(" "),n("h2",{attrs:{id:"参考资料"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#参考资料"}},[s._v("#")]),s._v(" 参考资料")]),s._v(" "),n("p",[s._v("[1]. https://blog.csdn.net/xun527/article/details/131305955")]),s._v(" "),n("p",[s._v("[2]. nginx启动命令详解：https://www.python100.com/html/89170.html")])])}),[],!1,null,null,null);n.default=e.exports}}]);